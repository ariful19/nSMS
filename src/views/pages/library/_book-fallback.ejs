<div class="card">
  <header class="card__header">
    <h1 class="card__title"><%= book.title %></h1>
    <p class="card__subtitle">
      <span>Author: <%= book.author || "Unknown" %></span>
      <% if (book.isbn) { %>
        · <span>ISBN: <%= book.isbn %></span>
      <% } %>
      <% if (book.category) { %>
        · <span>Category: <%= book.category.name %></span>
      <% } %>
    </p>
  </header>
  <div class="card__body">
    <% if (book.summary) { %>
      <p class="text-muted"><%= book.summary %></p>
    <% } %>

    <dl class="definition-list">
      <div class="definition-list__row">
        <dt>Status</dt>
        <dd>
          <%= book.copySummary.available %> available of <%= book.copySummary.total %> copies
        </dd>
      </div>
      <% if (book.publishedYear) { %>
        <div class="definition-list__row">
          <dt>Published</dt>
          <dd><%= book.publishedYear %></dd>
        </div>
      <% } %>
    </dl>
  </div>
</div>

<div class="card">
  <header class="card__header">
    <h2 class="card__title">Copies</h2>
    <p class="card__subtitle">Track barcode inventory and status for this title.</p>
  </header>
  <div class="card__body">
    <% if ((book.copies || []).length) { %>
      <table class="table table--responsive">
        <thead>
          <tr>
            <th scope="col">Barcode</th>
            <th scope="col">Location</th>
            <th scope="col">Status</th>
          </tr>
        </thead>
        <tbody>
          <% book.copies.forEach(function (copy) { %>
            <tr>
              <th scope="row"><%= copy.barcode || copy.id %></th>
              <td><%= copy.location || "—" %></td>
              <td><%= copy.status %></td>
            </tr>
          <% }); %>
        </tbody>
      </table>
    <% } else { %>
      <p class="text-muted">No copies recorded yet.</p>
    <% } %>
  </div>
</div>

<div class="card">
  <header class="card__header">
    <h2 class="card__title">Active loans</h2>
    <p class="card__subtitle">Students currently holding this title.</p>
  </header>
  <div class="card__body">
    <% if ((activeLoans || []).length) { %>
      <ul class="list list--loans">
        <% activeLoans.forEach(function (loan) { %>
          <li class="list__item">
            <div class="list__primary">
              <strong>Copy <%= loan.copy ? loan.copy.barcode || loan.copy.id : "—" %></strong>
              borrowed by <%= loan.student ? loan.student.name : "Unknown" %>
            </div>
            <div class="list__secondary">
              <span>Issued <%= new Date(loan.issuedAt).toLocaleDateString() %></span>
              <% if (loan.dueAt) { %>
                <span>Due <%= new Date(loan.dueAt).toLocaleDateString() %></span>
              <% } %>
            </div>
          </li>
        <% }); %>
      </ul>
    <% } else { %>
      <p class="text-muted">No active loans.</p>
    <% } %>
  </div>
</div>

<div class="card">
  <header class="card__header">
    <h2 class="card__title">Recent activity</h2>
    <p class="card__subtitle">History of the latest check-outs and returns.</p>
  </header>
  <div class="card__body">
    <% if ((recentLoans || []).length) { %>
      <ul class="list list--loans">
        <% recentLoans.forEach(function (loan) { %>
          <li class="list__item">
            <div class="list__primary">
              <strong>Copy <%= loan.copy ? loan.copy.barcode || loan.copy.id : "—" %></strong>
              <span class="text-muted"><%= loan.student ? loan.student.name : "Unknown" %></span>
            </div>
            <div class="list__secondary">
              <span>Issued <%= new Date(loan.issuedAt).toLocaleDateString() %></span>
              <% if (loan.returnedAt) { %>
                <span>Returned <%= new Date(loan.returnedAt).toLocaleDateString() %></span>
              <% } else if (loan.dueAt) { %>
                <span>Due <%= new Date(loan.dueAt).toLocaleDateString() %></span>
              <% } %>
            </div>
          </li>
        <% }); %>
      </ul>
    <% } else { %>
      <p class="text-muted">No recent loan history.</p>
    <% } %>
  </div>
</div>
