<header class="page__header">
  <div>
    <h1 class="page__title">Events</h1>
    <p class="page__subtitle">Track upcoming gatherings, meetings, and celebrations.</p>
  </div>
  <div class="page__actions">
    <form method="get" class="form form--inline" aria-label="Filter events">
      <label class="form__field">
        <span class="form__label">Search</span>
        <input
          type="search"
          name="search"
          value="<%= filters.search || '' %>"
          placeholder="Title or location"
          class="form__input"
        />
      </label>
      <label class="form__field">
        <span class="form__label">Status</span>
        <select name="status">
          <option value="">All statuses</option>
          <% (lookups.statuses || []).forEach((status) => { %>
            <option value="<%= status %>" <%= filters.status === status ? 'selected' : '' %>>
              <%= status %>
            </option>
          <% }) %>
        </select>
      </label>
      <label class="form__field">
        <span class="form__label">Visibility</span>
        <select name="visibility">
          <option value="">All audiences</option>
          <% (lookups.visibilities || []).forEach((visibility) => { %>
            <option value="<%= visibility %>" <%= filters.visibility === visibility ? 'selected' : '' %>>
              <%= visibility %>
            </option>
          <% }) %>
        </select>
      </label>
      <label class="form__field">
        <span class="form__label">From</span>
        <input type="date" name="startAfter" value="<%= filters.startAfter || '' %>" />
      </label>
      <label class="form__field">
        <span class="form__label">To</span>
        <input type="date" name="startBefore" value="<%= filters.startBefore || '' %>" />
      </label>
      <% if (canManage) { %>
        <label class="form__field form__field--checkbox">
          <input type="checkbox" name="includePast" value="true" <%= filters.includePast ? 'checked' : '' %> />
          <span>Include past events</span>
        </label>
      <% } %>
      <label class="form__field">
        <span class="form__label">Audience</span>
        <select name="audienceRoleIds" multiple size="3">
          <% (lookups.roles || []).forEach((role) => { %>
            <option
              value="<%= role.id %>"
              <%= (filters.audienceRoleIds || []).includes(String(role.id)) || (filters.audienceRoleIds || []).includes(role.id) ? 'selected' : '' %>
            >
              <%= role.name %>
            </option>
          <% }) %>
        </select>
      </label>
      <button type="submit" class="btn">Apply</button>
      <a href="/events" class="btn btn--link">Clear</a>
    </form>
    <% if (canManage) { %>
      <a href="/events/create" class="btn btn--primary">New event</a>
    <% } %>
  </div>
</header>

<% if (!events || events.length === 0) { %>
  <p class="page__empty">No events match your filters.</p>
<% } else { %>
  <div class="event-list">
    <% events.forEach((event) => { %>
      <div class="event-list__item">
        <%- include("../../partials/event-card", { event }) %>
        <% if (canManage) { %>
          <div class="event-list__actions">
            <a href="/events/<%= event.id %>/edit" class="btn btn--small">Edit</a>
            <form
              method="post"
              action="/events/<%= event.id %>/delete"
              class="form form--inline"
              onsubmit="return confirm('Delete this event?');"
            >
              <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
              <button type="submit" class="btn btn--small btn--danger">Delete</button>
            </form>
          </div>
        <% } %>
      </div>
    <% }) %>
  </div>
<% } %>
