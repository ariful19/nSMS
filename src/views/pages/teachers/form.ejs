<% const formAction = isEditMode ? `/teachers/${teacherId}/edit` : "/teachers/create"; %>
<section class="page">
  <header class="page__header">
    <h1 class="page__title"><%= isEditMode ? 'Edit teacher or staff member' : 'Add teacher or staff member' %></h1>
    <a href="/teachers" class="btn btn--link">Back to list</a>
  </header>

  <% if (errors && errors.length > 0) { %>
    <div class="alert alert--danger" role="alert">
      <p><strong>We ran into a few issues:</strong></p>
      <ul>
        <% errors.forEach((error) => { %>
          <li><%= error %></li>
        <% }); %>
      </ul>
    </div>
  <% } %>

  <form method="post" action="<%= formAction %>" class="form">
    <input type="hidden" name="_csrf" value="<%= csrfToken %>" />

    <fieldset class="form__fieldset">
      <legend class="form__legend">Personal information</legend>
      <div class="form__grid">
        <label class="form__field">
          <span class="form__label">First name <span aria-hidden="true">*</span></span>
          <input
            type="text"
            name="firstName"
            value="<%= formValues.firstName || '' %>"
            required
            class="form__input"
          />
        </label>
        <label class="form__field">
          <span class="form__label">Middle name</span>
          <input
            type="text"
            name="middleName"
            value="<%= formValues.middleName || '' %>"
            class="form__input"
          />
        </label>
        <label class="form__field">
          <span class="form__label">Last name <span aria-hidden="true">*</span></span>
          <input
            type="text"
            name="lastName"
            value="<%= formValues.lastName || '' %>"
            required
            class="form__input"
          />
        </label>
        <label class="form__field">
          <span class="form__label">Preferred name</span>
          <input
            type="text"
            name="preferredName"
            value="<%= formValues.preferredName || '' %>"
            class="form__input"
          />
        </label>
        <label class="form__field">
          <span class="form__label">Date of birth</span>
          <input
            type="date"
            name="dateOfBirth"
            value="<%= formValues.dateOfBirth || '' %>"
            class="form__input"
          />
        </label>
        <label class="form__field">
          <span class="form__label">Gender</span>
          <select name="genderId" class="form__input">
            <option value="">Select gender</option>
            <% (lookups.genders || []).forEach((gender) => { %>
              <option
                value="<%= gender.id %>"
                <%= String(formValues.genderId || '') === String(gender.id) ? 'selected' : '' %>
              >
                <%= gender.name %>
              </option>
            <% }); %>
          </select>
        </label>
        <label class="form__field">
          <span class="form__label">Primary email</span>
          <input
            type="email"
            name="primaryEmail"
            value="<%= formValues.primaryEmail || '' %>"
            class="form__input"
          />
        </label>
        <label class="form__field">
          <span class="form__label">Mobile phone</span>
          <input
            type="tel"
            name="mobilePhone"
            value="<%= formValues.mobilePhone || '' %>"
            class="form__input"
          />
        </label>
      </div>
    </fieldset>

    <fieldset class="form__fieldset">
      <legend class="form__legend">Employment details</legend>
      <div class="form__grid">
        <label class="form__field">
          <span class="form__label">Staff type <span aria-hidden="true">*</span></span>
          <select name="staffTypeId" class="form__input" required>
            <option value="">Select staff type</option>
            <% (lookups.staffTypes || []).forEach((type) => { %>
              <option
                value="<%= type.id %>"
                <%= String(formValues.staffTypeId || '') === String(type.id) ? 'selected' : '' %>
              >
                <%= type.name %>
              </option>
            <% }); %>
          </select>
        </label>
        <label class="form__field">
          <span class="form__label">Employment status <span aria-hidden="true">*</span></span>
          <select name="employmentStatusId" class="form__input" required>
            <option value="">Select employment status</option>
            <% (lookups.employmentStatuses || []).forEach((status) => { %>
              <option
                value="<%= status.id %>"
                <%= String(formValues.employmentStatusId || '') === String(status.id) ? 'selected' : '' %>
              >
                <%= status.name %>
              </option>
            <% }); %>
          </select>
        </label>
        <label class="form__field">
          <span class="form__label">Employee number</span>
          <input
            type="text"
            name="employeeNumber"
            value="<%= formValues.employeeNumber || '' %>"
            class="form__input"
          />
        </label>
        <label class="form__field">
          <span class="form__label">Hire date</span>
          <input
            type="date"
            name="hireDate"
            value="<%= formValues.hireDate || '' %>"
            class="form__input"
          />
        </label>
        <label class="form__field">
          <span class="form__label">Contract end date</span>
          <input
            type="date"
            name="contractEndDate"
            value="<%= formValues.contractEndDate || '' %>"
            class="form__input"
          />
        </label>
        <label class="form__field">
          <span class="form__label">Primary subject</span>
          <input
            type="text"
            name="primarySubject"
            value="<%= formValues.primarySubject || '' %>"
            class="form__input"
          />
        </label>
      </div>
      <label class="form__field form__field--full">
        <span class="form__label">Notes</span>
        <textarea
          name="notes"
          rows="4"
          class="form__input"
        ><%= formValues.notes || '' %></textarea>
      </label>
    </fieldset>

    <div class="form__actions">
      <button type="submit" class="btn btn--primary">
        <%= isEditMode ? 'Save changes' : 'Create record' %>
      </button>
      <a href="/teachers" class="btn btn--link">Cancel</a>
    </div>
  </form>
</section>
