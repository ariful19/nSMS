import{_ as re,c as o,o as n,a as e,t as r,w as v,v as T,e as ue,j as Z,f,F as j,r as C,d as K,g,i as $,h as w,n as _e,b as de,p as pe}from"./chunks/sq-avatar-badge-CzDjdsqk.js";const he={__name:"ClassManagementApp",props:{classes:{type:Array,default:()=>[]},subjects:{type:Array,default:()=>[]},lookups:{type:Object,default:()=>({gradeLevels:[],teachers:[]})},csrfToken:{type:String,default:""}},setup(I,{expose:s}){var _,y;s();const u=I,t=g([...u.classes]),k=g([...u.subjects]),N=$({gradeLevels:((_=u.lookups)==null?void 0:_.gradeLevels)??[],teachers:((y=u.lookups)==null?void 0:y.teachers)??[]}),a=g(!1),l=g(!1),p=g(""),M=g(""),b=$({name:"",code:"",gradeLevelId:"",homeroomTeacherId:"",startDate:"",endDate:"",description:""}),E=g([]),G=g(null),P=g(!1),x=$({name:"",code:"",description:""}),R=g([]),L=g(null),X=g(!1),V=w(()=>p.value.trim().toLowerCase()),H=w(()=>M.value.trim().toLowerCase()),Y=w(()=>t.value.filter(i=>a.value||!i.isArchived).filter(i=>{var J,ce;return V.value?[i.name,i.code,(J=i.gradeLevel)==null?void 0:J.name,(ce=i.homeroomTeacher)==null?void 0:ce.name].filter(Boolean).join(" ").toLowerCase().includes(V.value):!0})),Q=w(()=>k.value.filter(i=>l.value||!i.isArchived).filter(i=>H.value?[i.name,i.code].filter(Boolean).join(" ").toLowerCase().includes(H.value):!0)),W=w(()=>!!V.value||a.value),z=w(()=>!!H.value||l.value),F=w(()=>t.value.filter(i=>!i.isArchived).length),U=w(()=>t.value.reduce((i,A)=>i+(A.studentCount??0),0)),B=w(()=>k.value.filter(i=>!i.isArchived).length);function q(){b.name="",b.code="",b.gradeLevelId="",b.homeroomTeacherId="",b.startDate="",b.endDate="",b.description="",G.value=null,E.value=[]}function d(){x.name="",x.code="",x.description="",L.value=null,R.value=[]}function m(){p.value="",a.value=!1}function h(){M.value="",l.value=!1}function S(i){b.name=i.name||"",b.code=i.code||"",b.gradeLevelId=i.gradeLevel?String(i.gradeLevel.id):"",b.homeroomTeacherId=i.homeroomTeacher?String(i.homeroomTeacher.id):"",b.startDate=i.startDate?i.startDate.slice(0,10):"",b.endDate=i.endDate?i.endDate.slice(0,10):"",b.description=i.description||"",G.value=i.id,E.value=[]}function D(i){x.name=i.name||"",x.code=i.code||"",x.description=i.description||"",L.value=i.id,R.value=[]}async function O(){const i=await fetch("/classes",{headers:{Accept:"application/json"}});if(!i.ok)throw new Error("Failed to refresh data");const A=await i.json();t.value=A.management.classes||[],k.value=A.management.subjects||[],A.management.lookups&&(N.gradeLevels=A.management.lookups.gradeLevels||N.gradeLevels,N.teachers=A.management.lookups.teachers||N.teachers)}async function te(){if(E.value=[],!b.name){E.value.push("Class name is required.");return}P.value=!0;try{const i=G.value?`/classes/${G.value}/update`:"/classes",A=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":u.csrfToken},body:JSON.stringify(b)}),J=await A.json().catch(()=>({}));if(!A.ok){E.value=J.errors||[J.message||"Unable to save class."];return}await O(),q()}catch(i){E.value=[i.message||"Unexpected error saving class."]}finally{P.value=!1}}async function ie(i){await ee(`/classes/${i.id}/archive`)}async function ae(i){await ee(`/classes/${i.id}/restore`)}async function ee(i){try{const A=await fetch(i,{method:"POST",headers:{Accept:"application/json","X-CSRF-Token":u.csrfToken}});if(!A.ok){const J=await A.json().catch(()=>({}));throw new Error(J.message||"Unable to update class")}await O()}catch(A){E.value=[A.message||"Unable to update class."]}}async function oe(){if(R.value=[],!x.name){R.value.push("Subject name is required.");return}X.value=!0;try{const i=L.value?`/classes/subjects/${L.value}/update`:"/classes/subjects",A=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":u.csrfToken},body:JSON.stringify(x)}),J=await A.json().catch(()=>({}));if(!A.ok){R.value=J.errors||[J.message||"Unable to save subject."];return}await O(),d()}catch(i){R.value=[i.message||"Unexpected error saving subject."]}finally{X.value=!1}}async function ne(i){await se(`/classes/subjects/${i.id}/archive`)}async function le(i){await se(`/classes/subjects/${i.id}/restore`)}async function se(i){try{const A=await fetch(i,{method:"POST",headers:{Accept:"application/json","X-CSRF-Token":u.csrfToken}});if(!A.ok){const J=await A.json().catch(()=>({}));throw new Error(J.message||"Unable to update subject")}await O()}catch(A){R.value=[A.message||"Unable to update subject."]}}const c={props:u,classes:t,subjects:k,lookups:N,showArchivedClasses:a,showArchivedSubjects:l,classSearch:p,subjectSearch:M,classForm:b,classErrors:E,classEditingId:G,isSavingClass:P,subjectForm:x,subjectErrors:R,subjectEditingId:L,isSavingSubject:X,classSearchTerm:V,subjectSearchTerm:H,filteredClasses:Y,visibleSubjects:Q,isClassFilterActive:W,isSubjectFilterActive:z,activeClassCount:F,totalStudents:U,activeSubjectCount:B,resetClassForm:q,resetSubjectForm:d,resetClassFilters:m,resetSubjectFilters:h,beginClassEdit:S,beginSubjectEdit:D,refreshManagementState:O,submitClassForm:te,archiveClass:ie,restoreClass:ae,mutateClass:ee,submitSubjectForm:oe,archiveSubject:ne,restoreSubject:le,mutateSubject:se,computed:w,reactive:$,ref:g};return Object.defineProperty(c,"__isScriptSetup",{enumerable:!1,value:!0}),c}},be={class:"academic-app"},ve={class:"page-hero page-hero--compact"},ge={class:"page-hero__stats"},fe={class:"page-hero__stat"},ye={class:"page-hero__stat"},Se={class:"page-hero__stat"},ke={class:"grid grid--two-column"},je={class:"card card--interactive"},Ce={class:"card__header"},we={class:"card__subtitle"},Ae={class:"card__actions"},Fe={class:"toolbar"},Te={class:"toolbar__search"},Ie={class:"toolbar__actions"},Ue={class:"toggle"},Ee={key:0,class:"alert alert--danger"},De={class:"form__group"},Ne={class:"form__group"},xe={class:"form__group"},Le=["value"],Ve={class:"form__group"},Oe=["value"],Ge={class:"form__row"},Re={class:"form__group"},Pe={class:"form__group"},Me={class:"form__group"},$e={class:"form__actions"},qe=["disabled"],Xe={class:"card__body"},Be={key:0,class:"empty-state"},Je={key:0},He={key:1},ze={key:1,class:"table-responsive"},Ke={class:"table"},Ye={"data-title":"Name"},Qe={class:"table__title"},We=["href"],Ze={class:"table__meta"},es={key:0,class:"pill pill--soft"},ss={key:1,class:"pill pill--soft"},ts={key:2,class:"badge badge--warning"},as={"data-title":"Grade"},os={"data-title":"Students"},ns={"data-title":"Subjects"},ls={class:"table__actions"},rs=["onClick"],is=["href"],ds=["onClick"],cs=["onClick"],us={class:"card card--interactive"},ms={class:"card__header"},_s={class:"card__subtitle"},ps={class:"card__actions"},hs={class:"toolbar"},bs={class:"toolbar__search"},vs={class:"toolbar__actions"},gs={class:"toggle"},fs={key:0,class:"alert alert--danger"},ys={class:"form__group"},Ss={class:"form__group"},ks={class:"form__group"},js={class:"form__actions"},Cs=["disabled"],ws={class:"card__body"},As={key:0,class:"empty-state"},Fs={key:0},Ts={key:1},Is={key:1,class:"list"},Us={class:"list__heading"},Es={key:0,class:"badge badge--neutral"},Ds={key:1,class:"badge badge--warning"},Ns={key:0,class:"list__description"},xs={class:"list__meta"},Ls={class:"list__actions"},Vs=["onClick"],Os=["onClick"],Gs=["onClick"];function Rs(I,s,u,t,k,N){return n(),o("div",be,[e("section",ve,[s[17]||(s[17]=e("div",{class:"page-hero__content"},[e("p",{class:"page-hero__eyebrow"},"Academic planning"),e("h1",{class:"page-hero__title"},"Classes & Subjects"),e("p",{class:"page-hero__subtitle"}," Create calm class rosters and curate your subject catalogue with confident clarity. ")],-1)),e("dl",ge,[e("div",fe,[s[14]||(s[14]=e("dt",null,"Active classes",-1)),e("dd",null,r(t.activeClassCount),1)]),e("div",ye,[s[15]||(s[15]=e("dt",null,"Students managed",-1)),e("dd",null,r(t.totalStudents),1)]),e("div",Se,[s[16]||(s[16]=e("dt",null,"Subjects available",-1)),e("dd",null,r(t.activeSubjectCount),1)])])]),e("section",ke,[e("article",je,[e("header",Ce,[e("div",null,[s[18]||(s[18]=e("h2",{class:"card__title"},"Classes",-1)),e("p",we,r(t.filteredClasses.length)+" of "+r(t.classes.length)+" class"+r(t.classes.length===1?"":"es")+" in view ",1)]),e("div",Ae,[e("div",Fe,[e("div",Te,[v(e("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>t.classSearch=a),type:"search",class:"form__control",placeholder:"Search by name, code, grade or homeroom teacher"},null,512),[[T,t.classSearch]])]),e("div",Ie,[e("label",Ue,[v(e("input",{type:"checkbox","onUpdate:modelValue":s[1]||(s[1]=a=>t.showArchivedClasses=a)},null,512),[[ue,t.showArchivedClasses]]),s[19]||(s[19]=e("span",null,"Show archived",-1))])])])])]),e("form",{class:"form",onSubmit:Z(t.submitClassForm,["prevent"]),novalidate:""},[t.classErrors.length?(n(),o("div",Ee,[s[20]||(s[20]=e("p",null,"Unable to save the class:",-1)),e("ul",null,[(n(!0),o(j,null,C(t.classErrors,a=>(n(),o("li",{key:a},r(a),1))),128))])])):f("",!0),e("label",De,[s[21]||(s[21]=e("span",null,"Name",-1)),v(e("input",{"onUpdate:modelValue":s[2]||(s[2]=a=>t.classForm.name=a),type:"text",required:"",class:"form__control",placeholder:"eg. Grade 5 - Maple"},null,512),[[T,t.classForm.name,void 0,{trim:!0}]])]),e("label",Ne,[s[22]||(s[22]=e("span",null,"Code",-1)),v(e("input",{"onUpdate:modelValue":s[3]||(s[3]=a=>t.classForm.code=a),type:"text",class:"form__control",placeholder:"Optional short code"},null,512),[[T,t.classForm.code,void 0,{trim:!0}]])]),e("label",xe,[s[24]||(s[24]=e("span",null,"Grade level",-1)),v(e("select",{"onUpdate:modelValue":s[4]||(s[4]=a=>t.classForm.gradeLevelId=a),class:"form__control"},[s[23]||(s[23]=e("option",{value:""},"Select grade",-1)),(n(!0),o(j,null,C(t.lookups.gradeLevels,a=>(n(),o("option",{key:a.id,value:String(a.id)},r(a.name),9,Le))),128))],512),[[K,t.classForm.gradeLevelId]])]),e("label",Ve,[s[26]||(s[26]=e("span",null,"Homeroom teacher",-1)),v(e("select",{"onUpdate:modelValue":s[5]||(s[5]=a=>t.classForm.homeroomTeacherId=a),class:"form__control"},[s[25]||(s[25]=e("option",{value:""},"Unassigned",-1)),(n(!0),o(j,null,C(t.lookups.teachers,a=>(n(),o("option",{key:a.id,value:String(a.id)},r(a.name),9,Oe))),128))],512),[[K,t.classForm.homeroomTeacherId]])]),e("div",Ge,[e("label",Re,[s[27]||(s[27]=e("span",null,"Start date",-1)),v(e("input",{"onUpdate:modelValue":s[6]||(s[6]=a=>t.classForm.startDate=a),type:"date",class:"form__control"},null,512),[[T,t.classForm.startDate]])]),e("label",Pe,[s[28]||(s[28]=e("span",null,"End date",-1)),v(e("input",{"onUpdate:modelValue":s[7]||(s[7]=a=>t.classForm.endDate=a),type:"date",class:"form__control"},null,512),[[T,t.classForm.endDate]])])]),e("label",Me,[s[29]||(s[29]=e("span",null,"Description",-1)),v(e("textarea",{"onUpdate:modelValue":s[8]||(s[8]=a=>t.classForm.description=a),rows:"2",class:"form__control",placeholder:"Share the class focus or schedule"},null,512),[[T,t.classForm.description,void 0,{trim:!0}]])]),e("div",$e,[e("button",{type:"submit",class:"btn",disabled:t.isSavingClass},r(t.classEditingId?"Update class":"Create class"),9,qe),t.classEditingId?(n(),o("button",{key:0,type:"button",class:"btn btn--ghost",onClick:t.resetClassForm}," Cancel edit ")):f("",!0),t.isClassFilterActive?(n(),o("button",{key:1,type:"button",class:"btn btn--ghost btn--small",onClick:t.resetClassFilters}," Clear filters ")):f("",!0)])],32),e("div",Xe,[t.filteredClasses.length?(n(),o("div",ze,[e("table",Ke,[s[31]||(s[31]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"Name"),e("th",{scope:"col"},"Grade"),e("th",{scope:"col"},"Students"),e("th",{scope:"col"},"Subjects"),e("th",{scope:"col"},"Actions")])],-1)),e("tbody",null,[(n(!0),o(j,null,C(t.filteredClasses,a=>{var l;return n(),o("tr",{key:a.id},[e("td",Ye,[e("div",Qe,[e("a",{href:`/classes/${a.id}`},r(a.name),9,We)]),e("div",Ze,[a.homeroomTeacher?(n(),o("span",es," Homeroom • "+r(a.homeroomTeacher.name),1)):f("",!0),a.code?(n(),o("span",ss,"Code • "+r(a.code),1)):f("",!0),a.isArchived?(n(),o("span",ts,"Archived")):f("",!0)])]),e("td",as,r(((l=a.gradeLevel)==null?void 0:l.name)??"—"),1),e("td",os,r(a.studentCount),1),e("td",ns,r(a.subjectCount),1),e("td",ls,[e("button",{type:"button",class:"btn btn--small btn--ghost",onClick:p=>t.beginClassEdit(a)}," Edit ",8,rs),e("a",{class:"btn btn--small",href:`/classes/${a.id}`},"Open",8,is),a.isArchived?(n(),o("button",{key:1,type:"button",class:"btn btn--small",onClick:p=>t.restoreClass(a)}," Restore ",8,cs)):(n(),o("button",{key:0,type:"button",class:"btn btn--small btn--danger",onClick:p=>t.archiveClass(a)}," Archive ",8,ds))])])}),128))])])])):(n(),o("div",Be,[s[30]||(s[30]=e("p",{class:"empty-state__title"},"No classes match this view",-1)),t.isClassFilterActive?(n(),o("p",Je," Adjust the search or show archived records to discover more classes. ")):(n(),o("p",He,"Add your first class to begin organising enrollments."))]))])]),e("article",us,[e("header",ms,[e("div",null,[s[32]||(s[32]=e("h2",{class:"card__title"},"Subjects",-1)),e("p",_s,r(t.visibleSubjects.length)+" of "+r(t.subjects.length)+" subject"+r(t.subjects.length===1?"":"s")+" in view ",1)]),e("div",ps,[e("div",hs,[e("div",bs,[v(e("input",{"onUpdate:modelValue":s[9]||(s[9]=a=>t.subjectSearch=a),type:"search",class:"form__control",placeholder:"Search subjects by name or code"},null,512),[[T,t.subjectSearch]])]),e("div",vs,[e("label",gs,[v(e("input",{type:"checkbox","onUpdate:modelValue":s[10]||(s[10]=a=>t.showArchivedSubjects=a)},null,512),[[ue,t.showArchivedSubjects]]),s[33]||(s[33]=e("span",null,"Show archived",-1))])])])])]),e("form",{class:"form",onSubmit:Z(t.submitSubjectForm,["prevent"]),novalidate:""},[t.subjectErrors.length?(n(),o("div",fs,[s[34]||(s[34]=e("p",null,"Unable to save the subject:",-1)),e("ul",null,[(n(!0),o(j,null,C(t.subjectErrors,a=>(n(),o("li",{key:a},r(a),1))),128))])])):f("",!0),e("label",ys,[s[35]||(s[35]=e("span",null,"Name",-1)),v(e("input",{"onUpdate:modelValue":s[11]||(s[11]=a=>t.subjectForm.name=a),type:"text",required:"",class:"form__control",placeholder:"eg. Mathematics"},null,512),[[T,t.subjectForm.name,void 0,{trim:!0}]])]),e("label",Ss,[s[36]||(s[36]=e("span",null,"Code",-1)),v(e("input",{"onUpdate:modelValue":s[12]||(s[12]=a=>t.subjectForm.code=a),type:"text",class:"form__control",placeholder:"Optional short code"},null,512),[[T,t.subjectForm.code,void 0,{trim:!0}]])]),e("label",ks,[s[37]||(s[37]=e("span",null,"Description",-1)),v(e("textarea",{"onUpdate:modelValue":s[13]||(s[13]=a=>t.subjectForm.description=a),rows:"2",class:"form__control",placeholder:"Add context or curriculum notes"},null,512),[[T,t.subjectForm.description,void 0,{trim:!0}]])]),e("div",js,[e("button",{type:"submit",class:"btn",disabled:t.isSavingSubject},r(t.subjectEditingId?"Update subject":"Create subject"),9,Cs),t.subjectEditingId?(n(),o("button",{key:0,type:"button",class:"btn btn--ghost",onClick:t.resetSubjectForm}," Cancel edit ")):f("",!0),t.isSubjectFilterActive?(n(),o("button",{key:1,type:"button",class:"btn btn--ghost btn--small",onClick:t.resetSubjectFilters}," Clear filters ")):f("",!0)])],32),e("div",ws,[t.visibleSubjects.length?(n(),o("ul",Is,[(n(!0),o(j,null,C(t.visibleSubjects,a=>(n(),o("li",{key:a.id},[e("div",Us,[e("strong",null,r(a.name),1),a.code?(n(),o("span",Es,r(a.code),1)):f("",!0),a.isArchived?(n(),o("span",Ds,"Archived")):f("",!0)]),a.description?(n(),o("p",Ns,r(a.description),1)):f("",!0),e("div",xs,[e("span",null,"Linked classes: "+r(a.classCount),1)]),e("div",Ls,[e("button",{type:"button",class:"btn btn--small btn--ghost",onClick:l=>t.beginSubjectEdit(a)}," Edit ",8,Vs),a.isArchived?(n(),o("button",{key:1,type:"button",class:"btn btn--small",onClick:l=>t.restoreSubject(a)}," Restore ",8,Gs)):(n(),o("button",{key:0,type:"button",class:"btn btn--small btn--danger",onClick:l=>t.archiveSubject(a)}," Archive ",8,Os))])]))),128))])):(n(),o("div",As,[s[38]||(s[38]=e("p",{class:"empty-state__title"},"No subjects match this view",-1)),t.isSubjectFilterActive?(n(),o("p",Fs," Refine your search or reveal archived subjects to broaden the catalogue. ")):(n(),o("p",Ts,"Capture your first subject to build the curriculum."))]))])])])])}const Ps=re(he,[["render",Rs],["__file","/workspace/nSMS/src/client/academic/components/ClassManagementApp.vue"]]),Ms={__name:"ClassDetailApp",props:{detail:{type:Object,default:()=>({})},csrfToken:{type:String,default:""}},setup(I,{expose:s}){var ee,oe,ne,le,se;s();const u=I,t=$({...((ee=u.detail)==null?void 0:ee.classroom)??{}}),k=g([...((oe=u.detail)==null?void 0:oe.subjects)??[]]),N=$({teachers:((ne=u.detail)==null?void 0:ne.teachers)??[],gradeLevels:((le=u.detail)==null?void 0:le.gradeLevels)??[]}),a=g([...((se=u.detail)==null?void 0:se.assessmentTypes)??[]]),l=$({name:t.name||"",code:t.code||"",gradeLevelId:t.gradeLevel?String(t.gradeLevel.id):"",homeroomTeacherId:t.homeroomTeacher?String(t.homeroomTeacher.id):"",startDate:t.startDate?t.startDate.slice(0,10):"",endDate:t.endDate?t.endDate.slice(0,10):"",description:t.description||""}),p=g([]),M=g(!1),b=g([]),E=$({subjectId:"",teacherId:"",schedule:""}),G=g(!1),P=g(""),x=g([]),R=g(!1),L=g([]);let X;const V=w(()=>t.id),H=w(()=>{var c;return((c=t.subjects)==null?void 0:c.length)??0}),Y=w(()=>{var c;return((c=t.enrollments)==null?void 0:c.length)??0}),Q=w(()=>{var c;return((c=t.gradeLevel)==null?void 0:c.name)??"Unassigned"}),W=w(()=>{var c;return((c=t.homeroomTeacher)==null?void 0:c.name)??"No homeroom assigned"});function z(c){if(!c)return null;const _=new Date(c);return Number.isNaN(_.getTime())?null:_.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}const F=w(()=>{const c=z(t.startDate),_=z(t.endDate);return c&&_?`${c} → ${_}`:c?`Starts ${c}`:_?`Ends ${_}`:"Flexible schedule"});async function U(){const c=await fetch(`/classes/${V.value}`,{headers:{Accept:"application/json"}});if(!c.ok)throw new Error("Failed to refresh class");const y=(await c.json()).detail;Object.assign(t,y.classroom),k.value=y.subjects,Array.isArray(y.teachers)&&(N.teachers=y.teachers),Array.isArray(y.gradeLevels)&&(N.gradeLevels=y.gradeLevels),y.classroom.gradeLevel?l.gradeLevelId=String(y.classroom.gradeLevel.id):l.gradeLevelId="",l.name=y.classroom.name||"",l.code=y.classroom.code||"",l.homeroomTeacherId=y.classroom.homeroomTeacher?String(y.classroom.homeroomTeacher.id):"",l.startDate=y.classroom.startDate?y.classroom.startDate.slice(0,10):"",l.endDate=y.classroom.endDate?y.classroom.endDate.slice(0,10):"",l.description=y.classroom.description||"",Array.isArray(y.assessmentTypes)&&(a.value=y.assessmentTypes)}async function B(){if(p.value=[],!l.name){p.value.push("Class name is required.");return}M.value=!0;try{const c=await fetch(`/classes/${V.value}/update`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":u.csrfToken},body:JSON.stringify(l)}),_=await c.json().catch(()=>({}));if(!c.ok){p.value=_.errors||[_.message||"Unable to update class."];return}await U()}catch(c){p.value=[c.message||"Unexpected error updating class."]}finally{M.value=!1}}async function q(){await m(`/classes/${V.value}/archive`)}async function d(){await m(`/classes/${V.value}/restore`)}async function m(c){p.value=[];try{const _=await fetch(c,{method:"POST",headers:{Accept:"application/json","X-CSRF-Token":u.csrfToken}});if(!_.ok){const y=await _.json().catch(()=>({}));throw new Error(y.message||"Unable to update class")}await U()}catch(_){p.value=[_.message||"Unable to update class."]}}async function h(){if(b.value=[],!E.subjectId){b.value.push("Subject is required.");return}G.value=!0;try{const c=await fetch(`/classes/${V.value}/subjects`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":u.csrfToken},body:JSON.stringify(E)}),_=await c.json().catch(()=>({}));if(!c.ok){b.value=_.errors||[_.message||"Unable to assign subject."];return}E.subjectId="",E.teacherId="",E.schedule="",await U()}catch(c){b.value=[c.message||"Unable to assign subject."]}finally{G.value=!1}}async function S(c){b.value=[];try{const _=await fetch(`/classes/${V.value}/subjects/${c.id}/delete`,{method:"POST",headers:{Accept:"application/json","X-CSRF-Token":u.csrfToken}});if(!_.ok){const y=await _.json().catch(()=>({}));throw new Error(y.message||"Unable to remove subject.")}await U()}catch(_){b.value=[_.message||"Unable to remove subject."]}}function D(){if(clearTimeout(X),!P.value){x.value=[];return}X=setTimeout(O,250)}async function O(){R.value=!0;try{const c=new URLSearchParams({search:P.value}),_=await fetch(`/classes/${V.value}/enrollment/search?${c.toString()}`,{headers:{Accept:"application/json"}});if(!_.ok)throw new Error("Search failed");const y=await _.json();x.value=y.students||[]}catch{x.value=[]}finally{R.value=!1}}async function te(c){L.value=[];try{const _=await fetch(`/classes/${V.value}/enrollments`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":u.csrfToken},body:JSON.stringify({studentId:c.id})}),y=await _.json().catch(()=>({}));if(!_.ok)throw new Error(y.message||"Unable to add student");P.value="",x.value=[],await U()}catch(_){L.value=[_.message||"Unable to add student."]}}async function ie(c){L.value=[];try{const _=await fetch(`/classes/${V.value}/enrollments/${c.id}/delete`,{method:"POST",headers:{Accept:"application/json","X-CSRF-Token":u.csrfToken}});if(!_.ok){const y=await _.json().catch(()=>({}));throw new Error(y.message||"Unable to remove student")}await U()}catch(_){L.value=[_.message||"Unable to remove student."]}}const ae={props:u,classroom:t,subjects:k,lookups:N,assessmentTypes:a,classForm:l,classErrors:p,isSavingClass:M,subjectErrors:b,subjectForm:E,isSavingSubject:G,studentSearch:P,searchResults:x,isSearching:R,enrollmentErrors:L,get searchTimeout(){return X},set searchTimeout(c){X=c},classroomId:V,subjectCount:H,enrollmentCount:Y,gradeDisplay:Q,homeroomDisplay:W,formatDate:z,scheduleSummary:F,refreshDetail:U,saveClassroom:B,archiveClass:q,restoreClass:d,mutateClass:m,assignSubject:h,removeSubject:S,queueStudentSearch:D,runStudentSearch:O,addEnrollment:te,removeEnrollment:ie,computed:w,reactive:$,ref:g};return Object.defineProperty(ae,"__isScriptSetup",{enumerable:!1,value:!0}),ae}},$s={class:"academic-app"},qs={class:"page-hero page-hero--subtle"},Xs={class:"page-hero__content"},Bs={class:"page-hero__title"},Js={class:"page-hero__stats"},Hs={class:"page-hero__stat"},zs={class:"page-hero__stat"},Ks={class:"page-hero__stat"},Ys={class:"insight-row"},Qs={class:"insight-card"},Ws={class:"insight-card__value"},Zs={class:"insight-card"},et={class:"insight-card__value"},st={class:"insight-card"},tt={class:"insight-card__value"},at={class:"card card--interactive"},ot={class:"card__header"},nt={class:"card__actions"},lt={key:0,class:"badge badge--warning"},rt={key:0,class:"alert alert--danger"},it={class:"grid grid--two-column"},dt={class:"form__group"},ct={class:"form__group"},ut={class:"grid grid--two-column"},mt={class:"form__group"},_t=["value"],pt={class:"form__group"},ht=["value"],bt={class:"grid grid--two-column"},vt={class:"form__group"},gt={class:"form__group"},ft={class:"form__group"},yt={class:"form__actions"},St=["disabled"],kt={class:"card card--interactive"},jt={key:0,class:"alert alert--danger"},Ct={class:"grid grid--two-column"},wt={class:"form__group"},At=["value"],Ft={class:"form__group"},Tt=["value"],It={class:"form__group"},Ut={class:"form__actions"},Et=["disabled"],Dt={class:"card__body"},Nt={key:0,class:"empty-state"},xt={key:1,class:"table-responsive"},Lt={class:"table"},Vt={"data-title":"Subject"},Ot={"data-title":"Teacher"},Gt={"data-title":"Schedule"},Rt={class:"table__actions"},Pt=["href"],Mt=["onClick"],$t={class:"card card--interactive"},qt={class:"card__body"},Xt={class:"form__group"},Bt={key:0,class:"alert alert--danger"},Jt={key:1,class:"muted"},Ht={key:2,class:"muted"},zt={key:3,class:"list list--compact"},Kt={key:0,class:"badge badge--neutral"},Yt=["onClick"],Qt={class:"card__body"},Wt={key:0,class:"empty-state"},Zt={key:1,class:"table-responsive"},ea={class:"table"},sa={"data-title":"Student"},ta={key:0,class:"badge badge--neutral"},aa={"data-title":"Grade"},oa={"data-title":"Status"},na={class:"table__actions"},la=["onClick"];function ra(I,s,u,t,k,N){return n(),o("div",$s,[e("section",qs,[e("div",Xs,[s[11]||(s[11]=e("p",{class:"page-hero__eyebrow"},"Class overview",-1)),e("h1",Bs,r(t.classroom.name),1),s[12]||(s[12]=e("p",{class:"page-hero__subtitle"}," Manage enrollments, subject coverage, and day-to-day notes for a comfortable, informed classroom. ",-1))]),e("dl",Js,[e("div",Hs,[s[13]||(s[13]=e("dt",null,"Subjects assigned",-1)),e("dd",null,r(t.subjectCount),1)]),e("div",zs,[s[14]||(s[14]=e("dt",null,"Students enrolled",-1)),e("dd",null,r(t.enrollmentCount),1)]),e("div",Ks,[s[15]||(s[15]=e("dt",null,"Grade level",-1)),e("dd",null,r(t.gradeDisplay),1)])])]),e("div",Ys,[e("article",Qs,[s[16]||(s[16]=e("p",{class:"insight-card__label"},"Homeroom teacher",-1)),e("p",Ws,r(t.homeroomDisplay),1),s[17]||(s[17]=e("p",{class:"insight-card__hint"}," Keep staff assignments current so guardians always see the right point of contact. ",-1))]),e("article",Zs,[s[18]||(s[18]=e("p",{class:"insight-card__label"},"Schedule",-1)),e("p",et,r(t.scheduleSummary),1),s[19]||(s[19]=e("p",{class:"insight-card__hint"},"Use start and end dates to coordinate year planning and reporting windows.",-1))]),e("article",st,[s[20]||(s[20]=e("p",{class:"insight-card__label"},"Status",-1)),e("p",tt,[e("span",{class:_e(["pill",{"pill--soft":!t.classroom.isArchived,"pill--success":!t.classroom.isArchived}])},r(t.classroom.isArchived?"Archived":"Active"),3)]),s[21]||(s[21]=e("p",{class:"insight-card__hint"},"Archived classes remain read-only while keeping historical data in reports.",-1))])]),e("section",at,[e("header",ot,[s[22]||(s[22]=e("div",null,[e("h2",{class:"card__title"},"Class information"),e("p",{class:"card__subtitle"},"Update high-level details to keep schedules and reporting aligned.")],-1)),e("div",nt,[t.classroom.isArchived?(n(),o("span",lt,"Archived")):f("",!0)])]),e("form",{class:"form",onSubmit:Z(t.saveClassroom,["prevent"]),novalidate:""},[t.classErrors.length?(n(),o("div",rt,[s[23]||(s[23]=e("p",null,"Unable to update class:",-1)),e("ul",null,[(n(!0),o(j,null,C(t.classErrors,a=>(n(),o("li",{key:a},r(a),1))),128))])])):f("",!0),e("div",it,[e("label",dt,[s[24]||(s[24]=e("span",null,"Name",-1)),v(e("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>t.classForm.name=a),type:"text",required:"",class:"form__control",placeholder:"eg. Grade 5 - Maple"},null,512),[[T,t.classForm.name,void 0,{trim:!0}]])]),e("label",ct,[s[25]||(s[25]=e("span",null,"Code",-1)),v(e("input",{"onUpdate:modelValue":s[1]||(s[1]=a=>t.classForm.code=a),type:"text",class:"form__control",placeholder:"Optional short code"},null,512),[[T,t.classForm.code,void 0,{trim:!0}]])])]),e("div",ut,[e("label",mt,[s[27]||(s[27]=e("span",null,"Grade level",-1)),v(e("select",{"onUpdate:modelValue":s[2]||(s[2]=a=>t.classForm.gradeLevelId=a),class:"form__control"},[s[26]||(s[26]=e("option",{value:""},"Select grade",-1)),(n(!0),o(j,null,C(t.lookups.gradeLevels,a=>(n(),o("option",{key:a.id,value:String(a.id)},r(a.name),9,_t))),128))],512),[[K,t.classForm.gradeLevelId]])]),e("label",pt,[s[29]||(s[29]=e("span",null,"Homeroom teacher",-1)),v(e("select",{"onUpdate:modelValue":s[3]||(s[3]=a=>t.classForm.homeroomTeacherId=a),class:"form__control"},[s[28]||(s[28]=e("option",{value:""},"Unassigned",-1)),(n(!0),o(j,null,C(t.lookups.teachers,a=>(n(),o("option",{key:a.id,value:String(a.id)},r(a.name),9,ht))),128))],512),[[K,t.classForm.homeroomTeacherId]])])]),e("div",bt,[e("label",vt,[s[30]||(s[30]=e("span",null,"Start date",-1)),v(e("input",{"onUpdate:modelValue":s[4]||(s[4]=a=>t.classForm.startDate=a),type:"date",class:"form__control"},null,512),[[T,t.classForm.startDate]])]),e("label",gt,[s[31]||(s[31]=e("span",null,"End date",-1)),v(e("input",{"onUpdate:modelValue":s[5]||(s[5]=a=>t.classForm.endDate=a),type:"date",class:"form__control"},null,512),[[T,t.classForm.endDate]])])]),e("label",ft,[s[32]||(s[32]=e("span",null,"Description",-1)),v(e("textarea",{"onUpdate:modelValue":s[6]||(s[6]=a=>t.classForm.description=a),rows:"2",class:"form__control",placeholder:"Share classroom notes, planning highlights, or scheduling nuances"},null,512),[[T,t.classForm.description,void 0,{trim:!0}]])]),e("div",yt,[e("button",{type:"submit",class:"btn",disabled:t.isSavingClass},"Save changes",8,St),t.classroom.isArchived?(n(),o("button",{key:0,type:"button",class:"btn btn--ghost",onClick:t.restoreClass}," Restore class ")):(n(),o("button",{key:1,type:"button",class:"btn btn--danger",onClick:t.archiveClass}," Archive class "))])],32)]),e("section",kt,[s[41]||(s[41]=e("header",{class:"card__header"},[e("div",null,[e("h2",{class:"card__title"},"Subject assignments"),e("p",{class:"card__subtitle"},"Pair subjects with teachers to create a smooth, predictable timetable.")])],-1)),e("form",{class:"form",onSubmit:Z(t.assignSubject,["prevent"]),novalidate:""},[t.subjectErrors.length?(n(),o("div",jt,[s[33]||(s[33]=e("p",null,"Unable to assign subject:",-1)),e("ul",null,[(n(!0),o(j,null,C(t.subjectErrors,a=>(n(),o("li",{key:a},r(a),1))),128))])])):f("",!0),e("div",Ct,[e("label",wt,[s[35]||(s[35]=e("span",null,"Subject",-1)),v(e("select",{"onUpdate:modelValue":s[7]||(s[7]=a=>t.subjectForm.subjectId=a),required:"",class:"form__control"},[s[34]||(s[34]=e("option",{value:""},"Select subject",-1)),(n(!0),o(j,null,C(t.subjects,a=>(n(),o("option",{key:a.id,value:String(a.id)},r(a.name),9,At))),128))],512),[[K,t.subjectForm.subjectId]])]),e("label",Ft,[s[37]||(s[37]=e("span",null,"Teacher",-1)),v(e("select",{"onUpdate:modelValue":s[8]||(s[8]=a=>t.subjectForm.teacherId=a),class:"form__control"},[s[36]||(s[36]=e("option",{value:""},"Unassigned",-1)),(n(!0),o(j,null,C(t.lookups.teachers,a=>(n(),o("option",{key:a.id,value:String(a.id)},r(a.name),9,Tt))),128))],512),[[K,t.subjectForm.teacherId]])])]),e("label",It,[s[38]||(s[38]=e("span",null,"Schedule notes",-1)),v(e("input",{"onUpdate:modelValue":s[9]||(s[9]=a=>t.subjectForm.schedule=a),type:"text",class:"form__control",placeholder:"eg. Tue & Thu • 10:30"},null,512),[[T,t.subjectForm.schedule,void 0,{trim:!0}]])]),e("div",Ut,[e("button",{type:"submit",class:"btn",disabled:t.isSavingSubject},"Save assignment",8,Et)])],32),e("div",Dt,[t.classroom.subjects.length?(n(),o("div",xt,[e("table",Lt,[s[40]||(s[40]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"Subject"),e("th",{scope:"col"},"Teacher"),e("th",{scope:"col"},"Schedule"),e("th",{scope:"col"},"Actions")])],-1)),e("tbody",null,[(n(!0),o(j,null,C(t.classroom.subjects,a=>(n(),o("tr",{key:a.id},[e("td",Vt,r(a.subjectName),1),e("td",Ot,r(a.teacherName??"Unassigned"),1),e("td",Gt,r(a.schedule??"—"),1),e("td",Rt,[e("a",{class:"btn btn--small btn--ghost",href:`/classes/${t.classroom.id}/subjects/${a.id}/grades`}," Grade entry ",8,Pt),e("button",{type:"button",class:"btn btn--small btn--danger",onClick:l=>t.removeSubject(a)}," Remove ",8,Mt)])]))),128))])])])):(n(),o("div",Nt,[...s[39]||(s[39]=[e("p",{class:"empty-state__title"},"No subjects assigned yet",-1),e("p",null,"Add a subject above to begin mapping the learning plan for this class.",-1)])]))])]),e("section",$t,[s[46]||(s[46]=e("header",{class:"card__header"},[e("div",null,[e("h2",{class:"card__title"},"Enrollments"),e("p",{class:"card__subtitle"},"Search for students and welcome them into this class roster.")])],-1)),e("div",qt,[e("label",Xt,[s[42]||(s[42]=e("span",null,"Search students",-1)),v(e("input",{"onUpdate:modelValue":s[10]||(s[10]=a=>t.studentSearch=a),type:"search",class:"form__control",placeholder:"Type a name or student number",onInput:t.queueStudentSearch},null,544),[[T,t.studentSearch,void 0,{trim:!0}]])]),t.enrollmentErrors.length?(n(),o("div",Bt,[s[43]||(s[43]=e("p",null,"Unable to update enrollments:",-1)),e("ul",null,[(n(!0),o(j,null,C(t.enrollmentErrors,a=>(n(),o("li",{key:a},r(a),1))),128))])])):f("",!0),t.isSearching?(n(),o("p",Jt,"Searching students…")):f("",!0),t.studentSearch&&!t.isSearching&&t.searchResults.length===0?(n(),o("p",Ht," No students match your search or they are already enrolled. ")):f("",!0),t.searchResults.length?(n(),o("ul",zt,[(n(!0),o(j,null,C(t.searchResults,a=>(n(),o("li",{key:a.id,class:"list__option"},[e("div",null,[e("strong",null,r(a.name),1),a.studentNumber?(n(),o("span",Kt,r(a.studentNumber),1)):f("",!0)]),e("button",{type:"button",class:"btn btn--small",onClick:l=>t.addEnrollment(a)}," Add to class ",8,Yt)]))),128))])):f("",!0)]),e("div",Qt,[t.classroom.enrollments.length?(n(),o("div",Zt,[e("table",ea,[s[45]||(s[45]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"Student"),e("th",{scope:"col"},"Grade"),e("th",{scope:"col"},"Status"),e("th",{scope:"col"},"Actions")])],-1)),e("tbody",null,[(n(!0),o(j,null,C(t.classroom.enrollments,a=>(n(),o("tr",{key:a.id},[e("td",sa,[de(r(a.name)+" ",1),a.studentNumber?(n(),o("span",ta,r(a.studentNumber),1)):f("",!0)]),e("td",aa,r(a.gradeLevel??"—"),1),e("td",oa,r(a.status??"Active"),1),e("td",na,[e("button",{type:"button",class:"btn btn--small btn--danger",onClick:l=>t.removeEnrollment(a)}," Remove ",8,la)])]))),128))])])])):(n(),o("div",Wt,[...s[44]||(s[44]=[e("p",{class:"empty-state__title"},"No students enrolled yet",-1),e("p",null,"Invite students above to build the roster and unlock grade entry.",-1)])]))])])])}const ia=re(Ms,[["render",ra],["__file","/workspace/nSMS/src/client/academic/components/ClassDetailApp.vue"]]),da={__name:"GradeEntryApp",props:{classSubject:{type:Object,default:()=>({})},enrollments:{type:Array,default:()=>[]},assessmentTypes:{type:Array,default:()=>[]},csrfToken:{type:String,default:""}},setup(I,{expose:s}){var B,q;s();const u=I,t=$({...u.classSubject??{}});Array.isArray(t.assessments)||(t.assessments=[]);const k=g([...u.enrollments??[]]),N=g([...u.assessmentTypes??[]]),a=g((q=(B=t.assessments)==null?void 0:B[0])!=null&&q.id?String(t.assessments[0].id):""),l=$({title:"",assessmentTypeId:"",dueDate:"",maxScore:"",description:""}),p=g([]),M=g(!1),b=g([]),E=g(!1),G=$({}),P=w(()=>{var d;return a.value&&((d=t.assessments)==null?void 0:d.find(m=>String(m.id)===String(a.value)))||null}),x=w(()=>{var d;return((d=t.teacher)==null?void 0:d.name)??"Unassigned teacher"});function R(d){var m;return G[d]||(G[d]={score:"",maxScore:((m=P.value)==null?void 0:m.maxScore)??"",percentage:null,letter:null,comments:""}),G[d]}function L(){k.value.forEach(d=>{var S,D,O;const m=R(d.studentId),h=(D=(S=P.value)==null?void 0:S.grades)==null?void 0:D.find(te=>te.studentId===d.studentId);m.score=(h==null?void 0:h.score)??"",m.maxScore=(h==null?void 0:h.maxScore)??((O=P.value)==null?void 0:O.maxScore)??"",m.percentage=(h==null?void 0:h.percentage)??null,m.letter=(h==null?void 0:h.letterGrade)??null,m.comments=(h==null?void 0:h.comments)??""})}function X(d,m){if(d==null||d===""||m===null||m===void 0||m==="")return{percentage:null,letter:null};const h=Number(d),S=Number(m);if(!Number.isFinite(h)||!Number.isFinite(S)||S<=0)return{percentage:null,letter:null};const D=Number((Math.max(0,h)/S*100).toFixed(2));let O=null;return D>=90?O="A":D>=80?O="B":D>=70?O="C":D>=60?O="D":O="F",{percentage:D,letter:O}}function V(d){const m=R(d),h=X(m.score,m.maxScore);m.percentage=h.percentage,m.letter=h.letter}function H(d){return d==null||Number.isNaN(d)?"—":`${Number(d).toFixed(2)}%`}function Y(d){if(!d)return"Not scheduled";const m=new Date(d);return Number.isNaN(m.getTime())?"Not scheduled":m.toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric",year:"numeric"})}function Q(){L()}L();async function W(){var d,m,h;if(p.value=[],l.title||p.value.push("Title is required."),l.assessmentTypeId||p.value.push("Assessment type is required."),!p.value.length){M.value=!0;try{const S=await fetch(`/classes/${t.classroomId}/subjects/${t.id}/assessments`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":u.csrfToken},body:JSON.stringify(l)}),D=await S.json().catch(()=>({}));if(!S.ok){p.value=D.errors||[D.message||"Unable to create assessment."];return}if(F(D.context),(h=(m=(d=D.context)==null?void 0:d.classSubject)==null?void 0:m.assessments)!=null&&h.length){const O=D.context.classSubject.assessments.at(-1);a.value=String(O.id),L()}l.title="",l.assessmentTypeId="",l.dueDate="",l.maxScore="",l.description=""}catch(S){p.value=[S.message||"Unable to create assessment."]}finally{M.value=!1}}}async function z(){if(b.value=[],!P.value){b.value.push("Select an assessment before saving.");return}E.value=!0;try{const d={assessmentId:P.value.id,entries:k.value.map(S=>({enrollmentId:S.id,studentId:S.studentId,score:G[S.studentId].score,maxScore:G[S.studentId].maxScore,comments:G[S.studentId].comments}))},m=await fetch(`/classes/${t.classroomId}/subjects/${t.id}/grades`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":u.csrfToken},body:JSON.stringify(d)}),h=await m.json().catch(()=>({}));if(!m.ok){b.value=h.errors||[h.message||"Unable to save grades."];return}F(h.context),L()}catch(d){b.value=[d.message||"Unable to save grades."]}finally{E.value=!1}}function F(d){d&&(Object.assign(t,d.classSubject??{}),k.value=d.enrollments??k.value,Array.isArray(d.assessmentTypes)&&(N.value=d.assessmentTypes))}const U={props:u,classSubject:t,enrollments:k,assessmentTypes:N,selectedAssessmentId:a,assessmentForm:l,assessmentErrors:p,isCreatingAssessment:M,gradeErrors:b,isSavingGrades:E,gradeEntries:G,selectedAssessment:P,teacherDisplay:x,ensureEntry:R,hydrateEntries:L,calculateMetrics:X,recalculate:V,formatPercentage:H,formatDueDate:Y,applySelectedAssessment:Q,createAssessment:W,saveGrades:z,updateContext:F,computed:w,reactive:$,ref:g};return Object.defineProperty(U,"__isScriptSetup",{enumerable:!1,value:!0}),U}},ca={class:"academic-app"},ua={class:"page-hero page-hero--subtle"},ma={class:"page-hero__content"},_a={class:"page-hero__title"},pa={class:"page-hero__stats"},ha={class:"page-hero__stat"},ba={class:"page-hero__stat"},va={class:"page-hero__stat"},ga={class:"card card--interactive"},fa={class:"card__body"},ya={class:"toolbar"},Sa={class:"toolbar__search"},ka={class:"form__group"},ja={key:0,value:""},Ca=["value"],wa={class:"toolbar__actions"},Aa={key:0,class:"pill pill--soft"},Fa={key:0,class:"insight-row"},Ta={class:"insight-card"},Ia={class:"insight-card__value"},Ua={class:"insight-card"},Ea={class:"insight-card__value"},Da={class:"insight-card"},Na={class:"insight-card__value"},xa={key:0,class:"alert alert--danger"},La={class:"grid grid--three-column"},Va={class:"form__group"},Oa={class:"form__group"},Ga=["value"],Ra={class:"form__group"},Pa={class:"grid grid--two-column"},Ma={class:"form__group"},$a={class:"form__group"},qa={class:"form__actions"},Xa=["disabled"],Ba={class:"card card--interactive"},Ja={class:"card__body"},Ha={key:0,class:"empty-state"},za={key:0,class:"alert alert--danger"},Ka={class:"table-responsive"},Ya={class:"table"},Qa={"data-title":"Student"},Wa={key:0,class:"badge badge--neutral"},Za={"data-title":"Score"},eo=["onUpdate:modelValue","onInput"],so={"data-title":"Max"},to=["onUpdate:modelValue","onInput"],ao={"data-title":"Percentage"},oo={"data-title":"Letter"},no={"data-title":"Comments"},lo=["onUpdate:modelValue"],ro={class:"form__actions"},io=["disabled"];function co(I,s,u,t,k,N){var a;return n(),o("div",ca,[e("section",ua,[e("div",ma,[s[6]||(s[6]=e("p",{class:"page-hero__eyebrow"},"Grade workspace",-1)),e("h1",_a,r(t.classSubject.classroom.name)+" • "+r(t.classSubject.subject.name),1),s[7]||(s[7]=e("p",{class:"page-hero__subtitle"}," Capture grades with clarity, track assessment progress, and keep every student supported. ",-1))]),e("dl",pa,[e("div",ha,[s[8]||(s[8]=e("dt",null,"Enrolled students",-1)),e("dd",null,r(t.enrollments.length),1)]),e("div",ba,[s[9]||(s[9]=e("dt",null,"Assessments",-1)),e("dd",null,r(t.classSubject.assessments.length),1)]),e("div",va,[s[10]||(s[10]=e("dt",null,"Instructor",-1)),e("dd",null,r(t.teacherDisplay),1)])])]),e("section",ga,[s[26]||(s[26]=e("header",{class:"card__header"},[e("div",null,[e("h2",{class:"card__title"},"Assessments"),e("p",{class:"card__subtitle"},"Choose an assessment to review or add a new experience below.")])],-1)),e("div",fa,[e("div",ya,[e("div",Sa,[e("label",ka,[s[11]||(s[11]=e("span",null,"Assessment",-1)),v(e("select",{"onUpdate:modelValue":s[0]||(s[0]=l=>t.selectedAssessmentId=l),class:"form__control",onChange:t.applySelectedAssessment},[t.classSubject.assessments.length===0?(n(),o("option",ja," Create an assessment to begin ")):f("",!0),(n(!0),o(j,null,C(t.classSubject.assessments,l=>(n(),o("option",{key:l.id,value:String(l.id)},r(l.title),9,Ca))),128))],544),[[K,t.selectedAssessmentId]])])]),e("div",wa,[t.classSubject.schedule?(n(),o("span",Aa,r(t.classSubject.schedule),1)):f("",!0)])]),t.selectedAssessment?(n(),o("div",Fa,[e("article",Ta,[s[12]||(s[12]=e("p",{class:"insight-card__label"},"Assessment type",-1)),e("p",Ia,r(((a=t.selectedAssessment.assessmentType)==null?void 0:a.name)??"Not set"),1),s[13]||(s[13]=e("p",{class:"insight-card__hint"},"Consistent types keep reporting balanced.",-1))]),e("article",Ua,[s[14]||(s[14]=e("p",{class:"insight-card__label"},"Due date",-1)),e("p",Ea,r(t.formatDueDate(t.selectedAssessment.dueDate)),1),s[15]||(s[15]=e("p",{class:"insight-card__hint"},"Schedule clearly signals expectations to students.",-1))]),e("article",Da,[s[16]||(s[16]=e("p",{class:"insight-card__label"},"Default max score",-1)),e("p",Na,r(t.selectedAssessment.maxScore!=null?t.selectedAssessment.maxScore:"Flexible"),1),s[17]||(s[17]=e("p",{class:"insight-card__hint"},"You can customise per student in the grid below.",-1))])])):f("",!0)]),e("form",{class:"form form--inline",onSubmit:Z(t.createAssessment,["prevent"]),novalidate:""},[e("fieldset",null,[s[25]||(s[25]=e("legend",null,"Add assessment",-1)),t.assessmentErrors.length?(n(),o("div",xa,[s[18]||(s[18]=e("p",null,"Unable to create assessment:",-1)),e("ul",null,[(n(!0),o(j,null,C(t.assessmentErrors,l=>(n(),o("li",{key:l},r(l),1))),128))])])):f("",!0),e("div",La,[e("label",Va,[s[19]||(s[19]=e("span",null,"Title",-1)),v(e("input",{"onUpdate:modelValue":s[1]||(s[1]=l=>t.assessmentForm.title=l),type:"text",required:"",class:"form__control",placeholder:"eg. Module reflection"},null,512),[[T,t.assessmentForm.title,void 0,{trim:!0}]])]),e("label",Oa,[s[21]||(s[21]=e("span",null,"Type",-1)),v(e("select",{"onUpdate:modelValue":s[2]||(s[2]=l=>t.assessmentForm.assessmentTypeId=l),required:"",class:"form__control"},[s[20]||(s[20]=e("option",{value:""},"Select type",-1)),(n(!0),o(j,null,C(t.assessmentTypes,l=>(n(),o("option",{key:l.id,value:String(l.id)},r(l.name),9,Ga))),128))],512),[[K,t.assessmentForm.assessmentTypeId]])]),e("label",Ra,[s[22]||(s[22]=e("span",null,"Due date",-1)),v(e("input",{"onUpdate:modelValue":s[3]||(s[3]=l=>t.assessmentForm.dueDate=l),type:"date",class:"form__control"},null,512),[[T,t.assessmentForm.dueDate]])])]),e("div",Pa,[e("label",Ma,[s[23]||(s[23]=e("span",null,"Max score",-1)),v(e("input",{"onUpdate:modelValue":s[4]||(s[4]=l=>t.assessmentForm.maxScore=l),type:"number",step:"0.01",class:"form__control"},null,512),[[T,t.assessmentForm.maxScore]])]),e("label",$a,[s[24]||(s[24]=e("span",null,"Description",-1)),v(e("input",{"onUpdate:modelValue":s[5]||(s[5]=l=>t.assessmentForm.description=l),type:"text",class:"form__control",placeholder:"Optional context"},null,512),[[T,t.assessmentForm.description,void 0,{trim:!0}]])])]),e("div",qa,[e("button",{type:"submit",class:"btn",disabled:t.isCreatingAssessment},"Add assessment",8,Xa)])])],32)]),e("section",Ba,[s[30]||(s[30]=e("header",{class:"card__header"},[e("div",null,[e("h2",{class:"card__title"},"Grade entry"),e("p",{class:"card__subtitle"}," Enter scores, adjust maximums, and leave caring comments for each learner. ")])],-1)),e("div",Ja,[t.selectedAssessment?(n(),o("form",{key:1,class:"stack",onSubmit:Z(t.saveGrades,["prevent"]),novalidate:""},[t.gradeErrors.length?(n(),o("div",za,[s[28]||(s[28]=e("p",null,"Unable to save grades:",-1)),e("ul",null,[(n(!0),o(j,null,C(t.gradeErrors,l=>(n(),o("li",{key:l},r(l),1))),128))])])):f("",!0),e("div",Ka,[e("table",Ya,[s[29]||(s[29]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"Student"),e("th",{scope:"col"},"Score"),e("th",{scope:"col"},"Max"),e("th",{scope:"col"},"Percentage"),e("th",{scope:"col"},"Letter"),e("th",{scope:"col"},"Comments")])],-1)),e("tbody",null,[(n(!0),o(j,null,C(t.enrollments,l=>(n(),o("tr",{key:l.id},[e("td",Qa,[e("strong",null,r(l.name),1),l.studentNumber?(n(),o("span",Wa,r(l.studentNumber),1)):f("",!0)]),e("td",Za,[v(e("input",{"onUpdate:modelValue":p=>t.gradeEntries[l.studentId].score=p,type:"number",step:"0.01",class:"form__control",onInput:p=>t.recalculate(l.studentId)},null,40,eo),[[T,t.gradeEntries[l.studentId].score,void 0,{number:!0}]])]),e("td",so,[v(e("input",{"onUpdate:modelValue":p=>t.gradeEntries[l.studentId].maxScore=p,type:"number",step:"0.01",class:"form__control",onInput:p=>t.recalculate(l.studentId)},null,40,to),[[T,t.gradeEntries[l.studentId].maxScore,void 0,{number:!0}]])]),e("td",ao,r(t.formatPercentage(t.gradeEntries[l.studentId].percentage)),1),e("td",oo,r(t.gradeEntries[l.studentId].letter||"—"),1),e("td",no,[v(e("input",{"onUpdate:modelValue":p=>t.gradeEntries[l.studentId].comments=p,type:"text",class:"form__control",placeholder:"Encouragement or feedback"},null,8,lo),[[T,t.gradeEntries[l.studentId].comments,void 0,{trim:!0}]])])]))),128))])])]),e("div",ro,[e("button",{type:"submit",class:"btn",disabled:t.isSavingGrades},"Save grades",8,io)])],32)):(n(),o("div",Ha,[...s[27]||(s[27]=[e("p",{class:"empty-state__title"},"No assessment selected",-1),e("p",null,"Create an assessment above or choose one to begin recording grades.",-1)])]))])])])}const uo=re(da,[["render",co],["__file","/workspace/nSMS/src/client/academic/components/GradeEntryApp.vue"]]),mo={__name:"GradeReportApp",props:{report:{type:Object,default:()=>({summaries:[],filters:{classes:[],students:[]}})}},setup(I,{expose:s}){var R,L,X,V,H,Y,Q,W,z;s();const u=I,t=$({summaries:((R=u.report)==null?void 0:R.summaries)??[],filters:{classes:((X=(L=u.report)==null?void 0:L.filters)==null?void 0:X.classes)??[],students:((H=(V=u.report)==null?void 0:V.filters)==null?void 0:H.students)??[]}}),k=$({classId:(Q=(Y=u.report)==null?void 0:Y.filters)!=null&&Q.classId?String(u.report.filters.classId):"",studentId:(z=(W=u.report)==null?void 0:W.filters)!=null&&z.studentId?String(u.report.filters.studentId):""}),N=g(!1),a=w(()=>{var F;return((F=t.summaries)==null?void 0:F.length)??0}),l=w(()=>{var U;const F=new Set;return(U=t.summaries)==null||U.forEach(B=>{var q;(q=B.students)==null||q.forEach(d=>F.add(d.studentId))}),F.size}),p=w(()=>{var B;let F=0,U=0;return(B=t.summaries)==null||B.forEach(q=>{var d;(d=q.students)==null||d.forEach(m=>{var h,S;if(((h=m.overall)==null?void 0:h.percentage)!==null&&((S=m.overall)==null?void 0:S.percentage)!==void 0){const D=Number(m.overall.percentage);Number.isNaN(D)||(F+=D,U+=1)}})}),U===0?null:Number((F/U).toFixed(2))}),M=w(()=>p.value===null?"—":`${p.value.toFixed(2)}%`),b=w(()=>!!(k.classId||k.studentId));function E(F){return F==null||Number.isNaN(F)?"—":`${Number(F).toFixed(2)}%`}function G(){k.classId="",k.studentId="",P()}async function P(){var F,U,B,q,d;N.value=!0;try{const m=new URLSearchParams;k.classId&&m.set("classId",k.classId),k.studentId&&m.set("studentId",k.studentId);const h=await fetch(`/reports/grades/data?${m.toString()}`);if(!h.ok)throw new Error("Failed to load report");const S=await h.json();t.summaries=((F=S.report)==null?void 0:F.summaries)??[],t.filters.classes=((B=(U=S.report)==null?void 0:U.filters)==null?void 0:B.classes)??t.filters.classes,t.filters.students=((d=(q=S.report)==null?void 0:q.filters)==null?void 0:d.students)??t.filters.students}catch(m){console.error(m)}finally{N.value=!1}}const x={props:u,report:t,filters:k,isLoading:N,classCount:a,studentCount:l,overallAverage:p,overallAverageLabel:M,filtersApplied:b,formatPercentage:E,resetFilters:G,applyFilters:P,computed:w,reactive:$,ref:g};return Object.defineProperty(x,"__isScriptSetup",{enumerable:!1,value:!0}),x}},_o={class:"academic-app"},po={class:"page-hero page-hero--compact"},ho={class:"page-hero__stats"},bo={class:"page-hero__stat"},vo={class:"page-hero__stat"},go={class:"page-hero__stat"},fo={class:"card card--interactive"},yo={class:"grid grid--three-column"},So={class:"form__group"},ko=["value"],jo={class:"form__group"},Co=["value"],wo={class:"form__actions align-end"},Ao=["disabled"],Fo=["disabled"],To={class:"card__body"},Io={key:0,class:"muted"},Uo={key:1,class:"empty-state"},Eo={key:0,class:"stack"},Do={class:"report-section__header"},No={key:0,class:"muted"},xo={class:"pill pill--soft"},Lo={class:"table-responsive"},Vo={class:"table"},Oo={"data-title":"Student"},Go={key:0,class:"badge badge--neutral"},Ro={key:0,class:"badge"},Po={"data-title":"Overall"},Mo={key:0,class:"badge badge--success"};function $o(I,s,u,t,k,N){return n(),o("div",_o,[e("section",po,[s[5]||(s[5]=e("div",{class:"page-hero__content"},[e("p",{class:"page-hero__eyebrow"},"Progress analytics"),e("h1",{class:"page-hero__title"},"Grade reports"),e("p",{class:"page-hero__subtitle"}," Explore class performance, celebrate wins, and spot support opportunities with calm, clear visuals. ")],-1)),e("dl",ho,[e("div",bo,[s[2]||(s[2]=e("dt",null,"Classes tracked",-1)),e("dd",null,r(t.classCount),1)]),e("div",vo,[s[3]||(s[3]=e("dt",null,"Students represented",-1)),e("dd",null,r(t.studentCount),1)]),e("div",go,[s[4]||(s[4]=e("dt",null,"Average overall",-1)),e("dd",null,r(t.overallAverageLabel),1)])])]),e("section",fo,[s[13]||(s[13]=e("header",{class:"card__header"},[e("div",null,[e("h2",{class:"card__title"},"Filters"),e("p",{class:"card__subtitle"},"Focus on a specific class or learner to tailor the insights you need.")])],-1)),e("form",{class:"form",onSubmit:Z(t.applyFilters,["prevent"])},[e("div",yo,[e("label",So,[s[7]||(s[7]=e("span",null,"Class",-1)),v(e("select",{"onUpdate:modelValue":s[0]||(s[0]=a=>t.filters.classId=a),class:"form__control"},[s[6]||(s[6]=e("option",{value:""},"All classes",-1)),(n(!0),o(j,null,C(t.report.filters.classes,a=>(n(),o("option",{key:a.id,value:String(a.id)},r(a.name),9,ko))),128))],512),[[K,t.filters.classId]])]),e("label",jo,[s[9]||(s[9]=e("span",null,"Student",-1)),v(e("select",{"onUpdate:modelValue":s[1]||(s[1]=a=>t.filters.studentId=a),class:"form__control"},[s[8]||(s[8]=e("option",{value:""},"All students",-1)),(n(!0),o(j,null,C(t.report.filters.students,a=>(n(),o("option",{key:a.id,value:String(a.id)},r(a.name),9,Co))),128))],512),[[K,t.filters.studentId]])]),e("div",wo,[e("button",{type:"submit",class:"btn",disabled:t.isLoading},"Apply filters",8,Ao),e("button",{type:"button",class:"btn btn--ghost btn--small",disabled:!t.filtersApplied,onClick:t.resetFilters}," Reset ",8,Fo)])])],32),e("div",To,[t.isLoading?(n(),o("p",Io,"Loading report…")):t.report.summaries.length?f("",!0):(n(),o("div",Uo,[...s[10]||(s[10]=[e("p",{class:"empty-state__title"},"No grade data yet",-1),e("p",null,"Record assessments for your classes to populate this space with insights.",-1)])]))]),!t.isLoading&&t.report.summaries.length?(n(),o("div",Eo,[(n(!0),o(j,null,C(t.report.summaries,a=>(n(),o("section",{key:a.classId,class:"report-section"},[e("header",Do,[e("div",null,[e("h2",null,r(a.className),1),a.gradeLevel?(n(),o("p",No,"Grade level: "+r(a.gradeLevel),1)):f("",!0)]),e("div",xo,r(a.subjects.length)+" subject"+r(a.subjects.length===1?"":"s"),1)]),e("div",Lo,[e("table",Vo,[e("thead",null,[e("tr",null,[s[11]||(s[11]=e("th",{scope:"col"},"Student",-1)),(n(!0),o(j,null,C(a.subjects,l=>(n(),o("th",{key:l.classSubjectId,scope:"col"},r(l.name),1))),128)),s[12]||(s[12]=e("th",{scope:"col"},"Overall",-1))])]),e("tbody",null,[(n(!0),o(j,null,C(a.students,l=>(n(),o("tr",{key:l.studentId},[e("td",Oo,[e("strong",null,r(l.name),1),l.studentNumber?(n(),o("span",Go,r(l.studentNumber),1)):f("",!0)]),(n(!0),o(j,null,C(a.subjects,p=>{var M,b;return n(),o("td",{key:p.classSubjectId,"data-title":"Subject"},[de(r(t.formatPercentage((M=l.subjectGrades[String(p.classSubjectId)])==null?void 0:M.percentage))+" ",1),(b=l.subjectGrades[String(p.classSubjectId)])!=null&&b.letterGrade?(n(),o("span",Ro,r(l.subjectGrades[String(p.classSubjectId)].letterGrade),1)):f("",!0)])}),128)),e("td",Po,[de(r(t.formatPercentage(l.overall.percentage))+" ",1),l.overall.letterGrade?(n(),o("span",Mo,r(l.overall.letterGrade),1)):f("",!0)])]))),128))])])])]))),128))])):f("",!0)])])}const qo=re(mo,[["render",$o],["__file","/workspace/nSMS/src/client/academic/components/GradeReportApp.vue"]]),me={ClassManagementApp:Ps,ClassDetailApp:ia,GradeEntryApp:uo,GradeReportApp:qo};function Xo(I){if(!I)return{};const s=document.getElementById(I);if(!s)return{};try{return JSON.parse(s.textContent||"{}")}catch(u){return console.warn(`Unable to parse state for ${I}`,u),{}}}function Bo(I){const s=I.dataset.vueApp,u=me[s];if(!u)return;const t=Xo(I.dataset.stateId);pe(u,t).mount(I)}document.querySelectorAll("[data-vue-app]").forEach(I=>{me[I.dataset.vueApp]&&Bo(I)});
//# sourceMappingURL=academic.js.map
