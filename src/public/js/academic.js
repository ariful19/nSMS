import{r as k,j as X,c as E,a as s,o as a,b as e,t as i,w as y,v as L,g as de,i as Z,h as $,F as I,f as U,e as K,n as ue,d as re,p as pe}from"./chunks/sq-avatar-badge-iwxELXVT.js";const _e={class:"academic-app"},me={class:"page-hero page-hero--compact"},ve={class:"page-hero__stats"},he={class:"page-hero__stat"},be={class:"page-hero__stat"},ge={class:"page-hero__stat"},fe={class:"grid grid--two-column"},ye={class:"card card--interactive"},$e={class:"card__header"},Se={class:"card__subtitle"},ke={class:"card__actions"},je={class:"toolbar"},we={class:"toolbar__search"},Ce={class:"toolbar__actions"},Te={class:"toggle"},Ae={key:0,class:"alert alert--danger"},Ie={class:"form__group"},Ue={class:"form__group"},Ne={class:"form__group"},De=["value"],xe={class:"form__group"},Le=["value"],Ee={class:"form__row"},Fe={class:"form__group"},Ve={class:"form__group"},Oe={class:"form__group"},Ge={class:"form__actions"},Re=["disabled"],Pe={class:"card__body"},Me={key:0,class:"empty-state"},qe={key:0},Xe={key:1},Be={key:1,class:"table-responsive"},Je={class:"table"},He={"data-title":"Name"},ze={class:"table__title"},Ke=["href"],Ye={class:"table__meta"},Qe={key:0,class:"pill pill--soft"},We={key:1,class:"pill pill--soft"},Ze={key:2,class:"badge badge--warning"},et={"data-title":"Grade"},tt={"data-title":"Students"},st={"data-title":"Subjects"},at={class:"table__actions"},ot=["onClick"],lt=["href"],nt=["onClick"],rt=["onClick"],it={class:"card card--interactive"},dt={class:"card__header"},ct={class:"card__subtitle"},ut={class:"card__actions"},pt={class:"toolbar"},_t={class:"toolbar__search"},mt={class:"toolbar__actions"},vt={class:"toggle"},ht={key:0,class:"alert alert--danger"},bt={class:"form__group"},gt={class:"form__group"},ft={class:"form__group"},yt={class:"form__actions"},$t=["disabled"],St={class:"card__body"},kt={key:0,class:"empty-state"},jt={key:0},wt={key:1},Ct={key:1,class:"list"},Tt={class:"list__heading"},At={key:0,class:"badge badge--neutral"},It={key:1,class:"badge badge--warning"},Ut={key:0,class:"list__description"},Nt={class:"list__meta"},Dt={class:"list__actions"},xt=["onClick"],Lt=["onClick"],Et=["onClick"],Ft={__name:"ClassManagementApp",props:{classes:{type:Array,default:()=>[]},subjects:{type:Array,default:()=>[]},lookups:{type:Object,default:()=>({gradeLevels:[],teachers:[]})},csrfToken:{type:String,default:""}},setup(R){var t,n;const f=R,d=k([...f.classes]),S=k([...f.subjects]),F=X({gradeLevels:((t=f.lookups)==null?void 0:t.gradeLevels)??[],teachers:((n=f.lookups)==null?void 0:n.teachers)??[]}),P=k(!1),_=k(!1),N=k(""),q=k(""),m=X({name:"",code:"",gradeLevelId:"",homeroomTeacherId:"",startDate:"",endDate:"",description:""}),w=k([]),T=k(null),D=k(!1),A=X({name:"",code:"",description:""}),O=k([]),V=k(null),B=k(!1),G=E(()=>N.value.trim().toLowerCase()),J=E(()=>q.value.trim().toLowerCase()),H=E(()=>d.value.filter(u=>P.value||!u.isArchived).filter(u=>{var r,W;return G.value?[u.name,u.code,(r=u.gradeLevel)==null?void 0:r.name,(W=u.homeroomTeacher)==null?void 0:W.name].filter(Boolean).join(" ").toLowerCase().includes(G.value):!0})),z=E(()=>S.value.filter(u=>_.value||!u.isArchived).filter(u=>J.value?[u.name,u.code].filter(Boolean).join(" ").toLowerCase().includes(J.value):!0)),Y=E(()=>!!G.value||P.value),x=E(()=>!!J.value||_.value),h=E(()=>d.value.filter(u=>!u.isArchived).length),g=E(()=>d.value.reduce((u,l)=>u+(l.studentCount??0),0)),C=E(()=>S.value.filter(u=>!u.isArchived).length);function p(){m.name="",m.code="",m.gradeLevelId="",m.homeroomTeacherId="",m.startDate="",m.endDate="",m.description="",T.value=null,w.value=[]}function o(){A.name="",A.code="",A.description="",V.value=null,O.value=[]}function b(){N.value="",P.value=!1}function c(){q.value="",_.value=!1}function j(u){m.name=u.name||"",m.code=u.code||"",m.gradeLevelId=u.gradeLevel?String(u.gradeLevel.id):"",m.homeroomTeacherId=u.homeroomTeacher?String(u.homeroomTeacher.id):"",m.startDate=u.startDate?u.startDate.slice(0,10):"",m.endDate=u.endDate?u.endDate.slice(0,10):"",m.description=u.description||"",T.value=u.id,w.value=[]}function M(u){A.name=u.name||"",A.code=u.code||"",A.description=u.description||"",V.value=u.id,O.value=[]}async function Q(){const u=await fetch("/classes",{headers:{Accept:"application/json"}});if(!u.ok)throw new Error("Failed to refresh data");const l=await u.json();d.value=l.management.classes||[],S.value=l.management.subjects||[],l.management.lookups&&(F.gradeLevels=l.management.lookups.gradeLevels||F.gradeLevels,F.teachers=l.management.lookups.teachers||F.teachers)}async function le(){if(w.value=[],!m.name){w.value.push("Class name is required.");return}D.value=!0;try{const u=T.value?`/classes/${T.value}/update`:"/classes",l=await fetch(u,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":f.csrfToken},body:JSON.stringify(m)}),r=await l.json().catch(()=>({}));if(!l.ok){w.value=r.errors||[r.message||"Unable to save class."];return}await Q(),p()}catch(u){w.value=[u.message||"Unexpected error saving class."]}finally{D.value=!1}}async function ne(u){await ee(`/classes/${u.id}/archive`)}async function te(u){await ee(`/classes/${u.id}/restore`)}async function ee(u){try{const l=await fetch(u,{method:"POST",headers:{Accept:"application/json","X-CSRF-Token":f.csrfToken}});if(!l.ok){const r=await l.json().catch(()=>({}));throw new Error(r.message||"Unable to update class")}await Q()}catch(l){w.value=[l.message||"Unable to update class."]}}async function se(){if(O.value=[],!A.name){O.value.push("Subject name is required.");return}B.value=!0;try{const u=V.value?`/classes/subjects/${V.value}/update`:"/classes/subjects",l=await fetch(u,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":f.csrfToken},body:JSON.stringify(A)}),r=await l.json().catch(()=>({}));if(!l.ok){O.value=r.errors||[r.message||"Unable to save subject."];return}await Q(),o()}catch(u){O.value=[u.message||"Unexpected error saving subject."]}finally{B.value=!1}}async function ae(u){await v(`/classes/subjects/${u.id}/archive`)}async function oe(u){await v(`/classes/subjects/${u.id}/restore`)}async function v(u){try{const l=await fetch(u,{method:"POST",headers:{Accept:"application/json","X-CSRF-Token":f.csrfToken}});if(!l.ok){const r=await l.json().catch(()=>({}));throw new Error(r.message||"Unable to update subject")}await Q()}catch(l){O.value=[l.message||"Unable to update subject."]}}return(u,l)=>(a(),s("div",_e,[e("section",me,[l[17]||(l[17]=e("div",{class:"page-hero__content"},[e("p",{class:"page-hero__eyebrow"},"Academic planning"),e("h1",{class:"page-hero__title"},"Classes & Subjects"),e("p",{class:"page-hero__subtitle"}," Create calm class rosters and curate your subject catalogue with confident clarity. ")],-1)),e("dl",ve,[e("div",he,[l[14]||(l[14]=e("dt",null,"Active classes",-1)),e("dd",null,i(h.value),1)]),e("div",be,[l[15]||(l[15]=e("dt",null,"Students managed",-1)),e("dd",null,i(g.value),1)]),e("div",ge,[l[16]||(l[16]=e("dt",null,"Subjects available",-1)),e("dd",null,i(C.value),1)])])]),e("section",fe,[e("article",ye,[e("header",$e,[e("div",null,[l[18]||(l[18]=e("h2",{class:"card__title"},"Classes",-1)),e("p",Se,i(H.value.length)+" of "+i(d.value.length)+" class"+i(d.value.length===1?"":"es")+" in view ",1)]),e("div",ke,[e("div",je,[e("div",we,[y(e("input",{"onUpdate:modelValue":l[0]||(l[0]=r=>N.value=r),type:"search",class:"form__control",placeholder:"Search by name, code, grade or homeroom teacher"},null,512),[[L,N.value]])]),e("div",Ce,[e("label",Te,[y(e("input",{type:"checkbox","onUpdate:modelValue":l[1]||(l[1]=r=>P.value=r)},null,512),[[de,P.value]]),l[19]||(l[19]=e("span",null,"Show archived",-1))])])])])]),e("form",{class:"form",onSubmit:Z(le,["prevent"]),novalidate:""},[w.value.length?(a(),s("div",Ae,[l[20]||(l[20]=e("p",null,"Unable to save the class:",-1)),e("ul",null,[(a(!0),s(I,null,U(w.value,r=>(a(),s("li",{key:r},i(r),1))),128))])])):$("",!0),e("label",Ie,[l[21]||(l[21]=e("span",null,"Name",-1)),y(e("input",{"onUpdate:modelValue":l[2]||(l[2]=r=>m.name=r),type:"text",required:"",class:"form__control",placeholder:"eg. Grade 5 - Maple"},null,512),[[L,m.name,void 0,{trim:!0}]])]),e("label",Ue,[l[22]||(l[22]=e("span",null,"Code",-1)),y(e("input",{"onUpdate:modelValue":l[3]||(l[3]=r=>m.code=r),type:"text",class:"form__control",placeholder:"Optional short code"},null,512),[[L,m.code,void 0,{trim:!0}]])]),e("label",Ne,[l[24]||(l[24]=e("span",null,"Grade level",-1)),y(e("select",{"onUpdate:modelValue":l[4]||(l[4]=r=>m.gradeLevelId=r),class:"form__control"},[l[23]||(l[23]=e("option",{value:""},"Select grade",-1)),(a(!0),s(I,null,U(F.gradeLevels,r=>(a(),s("option",{key:r.id,value:String(r.id)},i(r.name),9,De))),128))],512),[[K,m.gradeLevelId]])]),e("label",xe,[l[26]||(l[26]=e("span",null,"Homeroom teacher",-1)),y(e("select",{"onUpdate:modelValue":l[5]||(l[5]=r=>m.homeroomTeacherId=r),class:"form__control"},[l[25]||(l[25]=e("option",{value:""},"Unassigned",-1)),(a(!0),s(I,null,U(F.teachers,r=>(a(),s("option",{key:r.id,value:String(r.id)},i(r.name),9,Le))),128))],512),[[K,m.homeroomTeacherId]])]),e("div",Ee,[e("label",Fe,[l[27]||(l[27]=e("span",null,"Start date",-1)),y(e("input",{"onUpdate:modelValue":l[6]||(l[6]=r=>m.startDate=r),type:"date",class:"form__control"},null,512),[[L,m.startDate]])]),e("label",Ve,[l[28]||(l[28]=e("span",null,"End date",-1)),y(e("input",{"onUpdate:modelValue":l[7]||(l[7]=r=>m.endDate=r),type:"date",class:"form__control"},null,512),[[L,m.endDate]])])]),e("label",Oe,[l[29]||(l[29]=e("span",null,"Description",-1)),y(e("textarea",{"onUpdate:modelValue":l[8]||(l[8]=r=>m.description=r),rows:"2",class:"form__control",placeholder:"Share the class focus or schedule"},null,512),[[L,m.description,void 0,{trim:!0}]])]),e("div",Ge,[e("button",{type:"submit",class:"btn",disabled:D.value},i(T.value?"Update class":"Create class"),9,Re),T.value?(a(),s("button",{key:0,type:"button",class:"btn btn--ghost",onClick:p}," Cancel edit ")):$("",!0),Y.value?(a(),s("button",{key:1,type:"button",class:"btn btn--ghost btn--small",onClick:b}," Clear filters ")):$("",!0)])],32),e("div",Pe,[H.value.length?(a(),s("div",Be,[e("table",Je,[l[31]||(l[31]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"Name"),e("th",{scope:"col"},"Grade"),e("th",{scope:"col"},"Students"),e("th",{scope:"col"},"Subjects"),e("th",{scope:"col"},"Actions")])],-1)),e("tbody",null,[(a(!0),s(I,null,U(H.value,r=>{var W;return a(),s("tr",{key:r.id},[e("td",He,[e("div",ze,[e("a",{href:`/classes/${r.id}`},i(r.name),9,Ke)]),e("div",Ye,[r.homeroomTeacher?(a(),s("span",Qe," Homeroom • "+i(r.homeroomTeacher.name),1)):$("",!0),r.code?(a(),s("span",We,"Code • "+i(r.code),1)):$("",!0),r.isArchived?(a(),s("span",Ze,"Archived")):$("",!0)])]),e("td",et,i(((W=r.gradeLevel)==null?void 0:W.name)??"—"),1),e("td",tt,i(r.studentCount),1),e("td",st,i(r.subjectCount),1),e("td",at,[e("button",{type:"button",class:"btn btn--small btn--ghost",onClick:ie=>j(r)}," Edit ",8,ot),e("a",{class:"btn btn--small",href:`/classes/${r.id}`},"Open",8,lt),r.isArchived?(a(),s("button",{key:1,type:"button",class:"btn btn--small",onClick:ie=>te(r)}," Restore ",8,rt)):(a(),s("button",{key:0,type:"button",class:"btn btn--small btn--danger",onClick:ie=>ne(r)}," Archive ",8,nt))])])}),128))])])])):(a(),s("div",Me,[l[30]||(l[30]=e("p",{class:"empty-state__title"},"No classes match this view",-1)),Y.value?(a(),s("p",qe," Adjust the search or show archived records to discover more classes. ")):(a(),s("p",Xe,"Add your first class to begin organising enrollments."))]))])]),e("article",it,[e("header",dt,[e("div",null,[l[32]||(l[32]=e("h2",{class:"card__title"},"Subjects",-1)),e("p",ct,i(z.value.length)+" of "+i(S.value.length)+" subject"+i(S.value.length===1?"":"s")+" in view ",1)]),e("div",ut,[e("div",pt,[e("div",_t,[y(e("input",{"onUpdate:modelValue":l[9]||(l[9]=r=>q.value=r),type:"search",class:"form__control",placeholder:"Search subjects by name or code"},null,512),[[L,q.value]])]),e("div",mt,[e("label",vt,[y(e("input",{type:"checkbox","onUpdate:modelValue":l[10]||(l[10]=r=>_.value=r)},null,512),[[de,_.value]]),l[33]||(l[33]=e("span",null,"Show archived",-1))])])])])]),e("form",{class:"form",onSubmit:Z(se,["prevent"]),novalidate:""},[O.value.length?(a(),s("div",ht,[l[34]||(l[34]=e("p",null,"Unable to save the subject:",-1)),e("ul",null,[(a(!0),s(I,null,U(O.value,r=>(a(),s("li",{key:r},i(r),1))),128))])])):$("",!0),e("label",bt,[l[35]||(l[35]=e("span",null,"Name",-1)),y(e("input",{"onUpdate:modelValue":l[11]||(l[11]=r=>A.name=r),type:"text",required:"",class:"form__control",placeholder:"eg. Mathematics"},null,512),[[L,A.name,void 0,{trim:!0}]])]),e("label",gt,[l[36]||(l[36]=e("span",null,"Code",-1)),y(e("input",{"onUpdate:modelValue":l[12]||(l[12]=r=>A.code=r),type:"text",class:"form__control",placeholder:"Optional short code"},null,512),[[L,A.code,void 0,{trim:!0}]])]),e("label",ft,[l[37]||(l[37]=e("span",null,"Description",-1)),y(e("textarea",{"onUpdate:modelValue":l[13]||(l[13]=r=>A.description=r),rows:"2",class:"form__control",placeholder:"Add context or curriculum notes"},null,512),[[L,A.description,void 0,{trim:!0}]])]),e("div",yt,[e("button",{type:"submit",class:"btn",disabled:B.value},i(V.value?"Update subject":"Create subject"),9,$t),V.value?(a(),s("button",{key:0,type:"button",class:"btn btn--ghost",onClick:o}," Cancel edit ")):$("",!0),x.value?(a(),s("button",{key:1,type:"button",class:"btn btn--ghost btn--small",onClick:c}," Clear filters ")):$("",!0)])],32),e("div",St,[z.value.length?(a(),s("ul",Ct,[(a(!0),s(I,null,U(z.value,r=>(a(),s("li",{key:r.id},[e("div",Tt,[e("strong",null,i(r.name),1),r.code?(a(),s("span",At,i(r.code),1)):$("",!0),r.isArchived?(a(),s("span",It,"Archived")):$("",!0)]),r.description?(a(),s("p",Ut,i(r.description),1)):$("",!0),e("div",Nt,[e("span",null,"Linked classes: "+i(r.classCount),1)]),e("div",Dt,[e("button",{type:"button",class:"btn btn--small btn--ghost",onClick:W=>M(r)}," Edit ",8,xt),r.isArchived?(a(),s("button",{key:1,type:"button",class:"btn btn--small",onClick:W=>oe(r)}," Restore ",8,Et)):(a(),s("button",{key:0,type:"button",class:"btn btn--small btn--danger",onClick:W=>ae(r)}," Archive ",8,Lt))])]))),128))])):(a(),s("div",kt,[l[38]||(l[38]=e("p",{class:"empty-state__title"},"No subjects match this view",-1)),x.value?(a(),s("p",jt," Refine your search or reveal archived subjects to broaden the catalogue. ")):(a(),s("p",wt,"Capture your first subject to build the curriculum."))]))])])])]))}},Vt={class:"academic-app"},Ot={class:"page-hero page-hero--subtle"},Gt={class:"page-hero__content"},Rt={class:"page-hero__title"},Pt={class:"page-hero__stats"},Mt={class:"page-hero__stat"},qt={class:"page-hero__stat"},Xt={class:"page-hero__stat"},Bt={class:"insight-row"},Jt={class:"insight-card"},Ht={class:"insight-card__value"},zt={class:"insight-card"},Kt={class:"insight-card__value"},Yt={class:"insight-card"},Qt={class:"insight-card__value"},Wt={class:"card card--interactive"},Zt={class:"card__header"},es={class:"card__actions"},ts={key:0,class:"badge badge--warning"},ss={key:0,class:"alert alert--danger"},as={class:"grid grid--two-column"},os={class:"form__group"},ls={class:"form__group"},ns={class:"grid grid--two-column"},rs={class:"form__group"},is=["value"],ds={class:"form__group"},cs=["value"],us={class:"grid grid--two-column"},ps={class:"form__group"},_s={class:"form__group"},ms={class:"form__group"},vs={class:"form__actions"},hs=["disabled"],bs={class:"card card--interactive"},gs={key:0,class:"alert alert--danger"},fs={class:"grid grid--two-column"},ys={class:"form__group"},$s=["value"],Ss={class:"form__group"},ks=["value"],js={class:"form__group"},ws={class:"form__actions"},Cs=["disabled"],Ts={class:"card__body"},As={key:0,class:"empty-state"},Is={key:1,class:"table-responsive"},Us={class:"table"},Ns={"data-title":"Subject"},Ds={"data-title":"Teacher"},xs={"data-title":"Schedule"},Ls={class:"table__actions"},Es=["href"],Fs=["onClick"],Vs={class:"card card--interactive"},Os={class:"card__body"},Gs={class:"form__group"},Rs={key:0,class:"alert alert--danger"},Ps={key:1,class:"muted"},Ms={key:2,class:"muted"},qs={key:3,class:"list list--compact"},Xs={key:0,class:"badge badge--neutral"},Bs=["onClick"],Js={class:"card__body"},Hs={key:0,class:"empty-state"},zs={key:1,class:"table-responsive"},Ks={class:"table"},Ys={"data-title":"Student"},Qs={key:0,class:"badge badge--neutral"},Ws={"data-title":"Grade"},Zs={"data-title":"Status"},ea={class:"table__actions"},ta=["onClick"],sa={__name:"ClassDetailApp",props:{detail:{type:Object,default:()=>({})},csrfToken:{type:String,default:""}},setup(R){var te,ee,se,ae,oe;const f=R,d=X({...((te=f.detail)==null?void 0:te.classroom)??{}}),S=k([...((ee=f.detail)==null?void 0:ee.subjects)??[]]),F=X({teachers:((se=f.detail)==null?void 0:se.teachers)??[],gradeLevels:((ae=f.detail)==null?void 0:ae.gradeLevels)??[]}),P=k([...((oe=f.detail)==null?void 0:oe.assessmentTypes)??[]]),_=X({name:d.name||"",code:d.code||"",gradeLevelId:d.gradeLevel?String(d.gradeLevel.id):"",homeroomTeacherId:d.homeroomTeacher?String(d.homeroomTeacher.id):"",startDate:d.startDate?d.startDate.slice(0,10):"",endDate:d.endDate?d.endDate.slice(0,10):"",description:d.description||""}),N=k([]),q=k(!1),m=k([]),w=X({subjectId:"",teacherId:"",schedule:""}),T=k(!1),D=k(""),A=k([]),O=k(!1),V=k([]);let B;const G=E(()=>d.id),J=E(()=>{var v;return((v=d.subjects)==null?void 0:v.length)??0}),H=E(()=>{var v;return((v=d.enrollments)==null?void 0:v.length)??0}),z=E(()=>{var v;return((v=d.gradeLevel)==null?void 0:v.name)??"Unassigned"}),Y=E(()=>{var v;return((v=d.homeroomTeacher)==null?void 0:v.name)??"No homeroom assigned"});function x(v){if(!v)return null;const t=new Date(v);return Number.isNaN(t.getTime())?null:t.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}const h=E(()=>{const v=x(d.startDate),t=x(d.endDate);return v&&t?`${v} → ${t}`:v?`Starts ${v}`:t?`Ends ${t}`:"Flexible schedule"});async function g(){const v=await fetch(`/classes/${G.value}`,{headers:{Accept:"application/json"}});if(!v.ok)throw new Error("Failed to refresh class");const n=(await v.json()).detail;Object.assign(d,n.classroom),S.value=n.subjects,Array.isArray(n.teachers)&&(F.teachers=n.teachers),Array.isArray(n.gradeLevels)&&(F.gradeLevels=n.gradeLevels),n.classroom.gradeLevel?_.gradeLevelId=String(n.classroom.gradeLevel.id):_.gradeLevelId="",_.name=n.classroom.name||"",_.code=n.classroom.code||"",_.homeroomTeacherId=n.classroom.homeroomTeacher?String(n.classroom.homeroomTeacher.id):"",_.startDate=n.classroom.startDate?n.classroom.startDate.slice(0,10):"",_.endDate=n.classroom.endDate?n.classroom.endDate.slice(0,10):"",_.description=n.classroom.description||"",Array.isArray(n.assessmentTypes)&&(P.value=n.assessmentTypes)}async function C(){if(N.value=[],!_.name){N.value.push("Class name is required.");return}q.value=!0;try{const v=await fetch(`/classes/${G.value}/update`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":f.csrfToken},body:JSON.stringify(_)}),t=await v.json().catch(()=>({}));if(!v.ok){N.value=t.errors||[t.message||"Unable to update class."];return}await g()}catch(v){N.value=[v.message||"Unexpected error updating class."]}finally{q.value=!1}}async function p(){await b(`/classes/${G.value}/archive`)}async function o(){await b(`/classes/${G.value}/restore`)}async function b(v){N.value=[];try{const t=await fetch(v,{method:"POST",headers:{Accept:"application/json","X-CSRF-Token":f.csrfToken}});if(!t.ok){const n=await t.json().catch(()=>({}));throw new Error(n.message||"Unable to update class")}await g()}catch(t){N.value=[t.message||"Unable to update class."]}}async function c(){if(m.value=[],!w.subjectId){m.value.push("Subject is required.");return}T.value=!0;try{const v=await fetch(`/classes/${G.value}/subjects`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":f.csrfToken},body:JSON.stringify(w)}),t=await v.json().catch(()=>({}));if(!v.ok){m.value=t.errors||[t.message||"Unable to assign subject."];return}w.subjectId="",w.teacherId="",w.schedule="",await g()}catch(v){m.value=[v.message||"Unable to assign subject."]}finally{T.value=!1}}async function j(v){m.value=[];try{const t=await fetch(`/classes/${G.value}/subjects/${v.id}/delete`,{method:"POST",headers:{Accept:"application/json","X-CSRF-Token":f.csrfToken}});if(!t.ok){const n=await t.json().catch(()=>({}));throw new Error(n.message||"Unable to remove subject.")}await g()}catch(t){m.value=[t.message||"Unable to remove subject."]}}function M(){if(clearTimeout(B),!D.value){A.value=[];return}B=setTimeout(Q,250)}async function Q(){O.value=!0;try{const v=new URLSearchParams({search:D.value}),t=await fetch(`/classes/${G.value}/enrollment/search?${v.toString()}`,{headers:{Accept:"application/json"}});if(!t.ok)throw new Error("Search failed");const n=await t.json();A.value=n.students||[]}catch{A.value=[]}finally{O.value=!1}}async function le(v){V.value=[];try{const t=await fetch(`/classes/${G.value}/enrollments`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":f.csrfToken},body:JSON.stringify({studentId:v.id})}),n=await t.json().catch(()=>({}));if(!t.ok)throw new Error(n.message||"Unable to add student");D.value="",A.value=[],await g()}catch(t){V.value=[t.message||"Unable to add student."]}}async function ne(v){V.value=[];try{const t=await fetch(`/classes/${G.value}/enrollments/${v.id}/delete`,{method:"POST",headers:{Accept:"application/json","X-CSRF-Token":f.csrfToken}});if(!t.ok){const n=await t.json().catch(()=>({}));throw new Error(n.message||"Unable to remove student")}await g()}catch(t){V.value=[t.message||"Unable to remove student."]}}return(v,t)=>(a(),s("div",Vt,[e("section",Ot,[e("div",Gt,[t[11]||(t[11]=e("p",{class:"page-hero__eyebrow"},"Class overview",-1)),e("h1",Rt,i(d.name),1),t[12]||(t[12]=e("p",{class:"page-hero__subtitle"}," Manage enrollments, subject coverage, and day-to-day notes for a comfortable, informed classroom. ",-1))]),e("dl",Pt,[e("div",Mt,[t[13]||(t[13]=e("dt",null,"Subjects assigned",-1)),e("dd",null,i(J.value),1)]),e("div",qt,[t[14]||(t[14]=e("dt",null,"Students enrolled",-1)),e("dd",null,i(H.value),1)]),e("div",Xt,[t[15]||(t[15]=e("dt",null,"Grade level",-1)),e("dd",null,i(z.value),1)])])]),e("div",Bt,[e("article",Jt,[t[16]||(t[16]=e("p",{class:"insight-card__label"},"Homeroom teacher",-1)),e("p",Ht,i(Y.value),1),t[17]||(t[17]=e("p",{class:"insight-card__hint"}," Keep staff assignments current so guardians always see the right point of contact. ",-1))]),e("article",zt,[t[18]||(t[18]=e("p",{class:"insight-card__label"},"Schedule",-1)),e("p",Kt,i(h.value),1),t[19]||(t[19]=e("p",{class:"insight-card__hint"},"Use start and end dates to coordinate year planning and reporting windows.",-1))]),e("article",Yt,[t[20]||(t[20]=e("p",{class:"insight-card__label"},"Status",-1)),e("p",Qt,[e("span",{class:ue(["pill",{"pill--soft":!d.isArchived,"pill--success":!d.isArchived}])},i(d.isArchived?"Archived":"Active"),3)]),t[21]||(t[21]=e("p",{class:"insight-card__hint"},"Archived classes remain read-only while keeping historical data in reports.",-1))])]),e("section",Wt,[e("header",Zt,[t[22]||(t[22]=e("div",null,[e("h2",{class:"card__title"},"Class information"),e("p",{class:"card__subtitle"},"Update high-level details to keep schedules and reporting aligned.")],-1)),e("div",es,[d.isArchived?(a(),s("span",ts,"Archived")):$("",!0)])]),e("form",{class:"form",onSubmit:Z(C,["prevent"]),novalidate:""},[N.value.length?(a(),s("div",ss,[t[23]||(t[23]=e("p",null,"Unable to update class:",-1)),e("ul",null,[(a(!0),s(I,null,U(N.value,n=>(a(),s("li",{key:n},i(n),1))),128))])])):$("",!0),e("div",as,[e("label",os,[t[24]||(t[24]=e("span",null,"Name",-1)),y(e("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>_.name=n),type:"text",required:"",class:"form__control",placeholder:"eg. Grade 5 - Maple"},null,512),[[L,_.name,void 0,{trim:!0}]])]),e("label",ls,[t[25]||(t[25]=e("span",null,"Code",-1)),y(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>_.code=n),type:"text",class:"form__control",placeholder:"Optional short code"},null,512),[[L,_.code,void 0,{trim:!0}]])])]),e("div",ns,[e("label",rs,[t[27]||(t[27]=e("span",null,"Grade level",-1)),y(e("select",{"onUpdate:modelValue":t[2]||(t[2]=n=>_.gradeLevelId=n),class:"form__control"},[t[26]||(t[26]=e("option",{value:""},"Select grade",-1)),(a(!0),s(I,null,U(F.gradeLevels,n=>(a(),s("option",{key:n.id,value:String(n.id)},i(n.name),9,is))),128))],512),[[K,_.gradeLevelId]])]),e("label",ds,[t[29]||(t[29]=e("span",null,"Homeroom teacher",-1)),y(e("select",{"onUpdate:modelValue":t[3]||(t[3]=n=>_.homeroomTeacherId=n),class:"form__control"},[t[28]||(t[28]=e("option",{value:""},"Unassigned",-1)),(a(!0),s(I,null,U(F.teachers,n=>(a(),s("option",{key:n.id,value:String(n.id)},i(n.name),9,cs))),128))],512),[[K,_.homeroomTeacherId]])])]),e("div",us,[e("label",ps,[t[30]||(t[30]=e("span",null,"Start date",-1)),y(e("input",{"onUpdate:modelValue":t[4]||(t[4]=n=>_.startDate=n),type:"date",class:"form__control"},null,512),[[L,_.startDate]])]),e("label",_s,[t[31]||(t[31]=e("span",null,"End date",-1)),y(e("input",{"onUpdate:modelValue":t[5]||(t[5]=n=>_.endDate=n),type:"date",class:"form__control"},null,512),[[L,_.endDate]])])]),e("label",ms,[t[32]||(t[32]=e("span",null,"Description",-1)),y(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=n=>_.description=n),rows:"2",class:"form__control",placeholder:"Share classroom notes, planning highlights, or scheduling nuances"},null,512),[[L,_.description,void 0,{trim:!0}]])]),e("div",vs,[e("button",{type:"submit",class:"btn",disabled:q.value},"Save changes",8,hs),d.isArchived?(a(),s("button",{key:0,type:"button",class:"btn btn--ghost",onClick:o}," Restore class ")):(a(),s("button",{key:1,type:"button",class:"btn btn--danger",onClick:p}," Archive class "))])],32)]),e("section",bs,[t[41]||(t[41]=e("header",{class:"card__header"},[e("div",null,[e("h2",{class:"card__title"},"Subject assignments"),e("p",{class:"card__subtitle"},"Pair subjects with teachers to create a smooth, predictable timetable.")])],-1)),e("form",{class:"form",onSubmit:Z(c,["prevent"]),novalidate:""},[m.value.length?(a(),s("div",gs,[t[33]||(t[33]=e("p",null,"Unable to assign subject:",-1)),e("ul",null,[(a(!0),s(I,null,U(m.value,n=>(a(),s("li",{key:n},i(n),1))),128))])])):$("",!0),e("div",fs,[e("label",ys,[t[35]||(t[35]=e("span",null,"Subject",-1)),y(e("select",{"onUpdate:modelValue":t[7]||(t[7]=n=>w.subjectId=n),required:"",class:"form__control"},[t[34]||(t[34]=e("option",{value:""},"Select subject",-1)),(a(!0),s(I,null,U(S.value,n=>(a(),s("option",{key:n.id,value:String(n.id)},i(n.name),9,$s))),128))],512),[[K,w.subjectId]])]),e("label",Ss,[t[37]||(t[37]=e("span",null,"Teacher",-1)),y(e("select",{"onUpdate:modelValue":t[8]||(t[8]=n=>w.teacherId=n),class:"form__control"},[t[36]||(t[36]=e("option",{value:""},"Unassigned",-1)),(a(!0),s(I,null,U(F.teachers,n=>(a(),s("option",{key:n.id,value:String(n.id)},i(n.name),9,ks))),128))],512),[[K,w.teacherId]])])]),e("label",js,[t[38]||(t[38]=e("span",null,"Schedule notes",-1)),y(e("input",{"onUpdate:modelValue":t[9]||(t[9]=n=>w.schedule=n),type:"text",class:"form__control",placeholder:"eg. Tue & Thu • 10:30"},null,512),[[L,w.schedule,void 0,{trim:!0}]])]),e("div",ws,[e("button",{type:"submit",class:"btn",disabled:T.value},"Save assignment",8,Cs)])],32),e("div",Ts,[d.subjects.length?(a(),s("div",Is,[e("table",Us,[t[40]||(t[40]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"Subject"),e("th",{scope:"col"},"Teacher"),e("th",{scope:"col"},"Schedule"),e("th",{scope:"col"},"Actions")])],-1)),e("tbody",null,[(a(!0),s(I,null,U(d.subjects,n=>(a(),s("tr",{key:n.id},[e("td",Ns,i(n.subjectName),1),e("td",Ds,i(n.teacherName??"Unassigned"),1),e("td",xs,i(n.schedule??"—"),1),e("td",Ls,[e("a",{class:"btn btn--small btn--ghost",href:`/classes/${d.id}/subjects/${n.id}/grades`}," Grade entry ",8,Es),e("button",{type:"button",class:"btn btn--small btn--danger",onClick:u=>j(n)}," Remove ",8,Fs)])]))),128))])])])):(a(),s("div",As,[...t[39]||(t[39]=[e("p",{class:"empty-state__title"},"No subjects assigned yet",-1),e("p",null,"Add a subject above to begin mapping the learning plan for this class.",-1)])]))])]),e("section",Vs,[t[46]||(t[46]=e("header",{class:"card__header"},[e("div",null,[e("h2",{class:"card__title"},"Enrollments"),e("p",{class:"card__subtitle"},"Search for students and welcome them into this class roster.")])],-1)),e("div",Os,[e("label",Gs,[t[42]||(t[42]=e("span",null,"Search students",-1)),y(e("input",{"onUpdate:modelValue":t[10]||(t[10]=n=>D.value=n),type:"search",class:"form__control",placeholder:"Type a name or student number",onInput:M},null,544),[[L,D.value,void 0,{trim:!0}]])]),V.value.length?(a(),s("div",Rs,[t[43]||(t[43]=e("p",null,"Unable to update enrollments:",-1)),e("ul",null,[(a(!0),s(I,null,U(V.value,n=>(a(),s("li",{key:n},i(n),1))),128))])])):$("",!0),O.value?(a(),s("p",Ps,"Searching students…")):$("",!0),D.value&&!O.value&&A.value.length===0?(a(),s("p",Ms," No students match your search or they are already enrolled. ")):$("",!0),A.value.length?(a(),s("ul",qs,[(a(!0),s(I,null,U(A.value,n=>(a(),s("li",{key:n.id,class:"list__option"},[e("div",null,[e("strong",null,i(n.name),1),n.studentNumber?(a(),s("span",Xs,i(n.studentNumber),1)):$("",!0)]),e("button",{type:"button",class:"btn btn--small",onClick:u=>le(n)}," Add to class ",8,Bs)]))),128))])):$("",!0)]),e("div",Js,[d.enrollments.length?(a(),s("div",zs,[e("table",Ks,[t[45]||(t[45]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"Student"),e("th",{scope:"col"},"Grade"),e("th",{scope:"col"},"Status"),e("th",{scope:"col"},"Actions")])],-1)),e("tbody",null,[(a(!0),s(I,null,U(d.enrollments,n=>(a(),s("tr",{key:n.id},[e("td",Ys,[re(i(n.name)+" ",1),n.studentNumber?(a(),s("span",Qs,i(n.studentNumber),1)):$("",!0)]),e("td",Ws,i(n.gradeLevel??"—"),1),e("td",Zs,i(n.status??"Active"),1),e("td",ea,[e("button",{type:"button",class:"btn btn--small btn--danger",onClick:u=>ne(n)}," Remove ",8,ta)])]))),128))])])])):(a(),s("div",Hs,[...t[44]||(t[44]=[e("p",{class:"empty-state__title"},"No students enrolled yet",-1),e("p",null,"Invite students above to build the roster and unlock grade entry.",-1)])]))])])]))}},aa={class:"academic-app"},oa={class:"page-hero page-hero--subtle"},la={class:"page-hero__content"},na={class:"page-hero__title"},ra={class:"page-hero__stats"},ia={class:"page-hero__stat"},da={class:"page-hero__stat"},ca={class:"page-hero__stat"},ua={class:"card card--interactive"},pa={class:"card__body"},_a={class:"toolbar"},ma={class:"toolbar__search"},va={class:"form__group"},ha={key:0,value:""},ba=["value"],ga={class:"toolbar__actions"},fa={key:0,class:"pill pill--soft"},ya={key:0,class:"insight-row"},$a={class:"insight-card"},Sa={class:"insight-card__value"},ka={class:"insight-card"},ja={class:"insight-card__value"},wa={class:"insight-card"},Ca={class:"insight-card__value"},Ta={key:0,class:"alert alert--danger"},Aa={class:"grid grid--three-column"},Ia={class:"form__group"},Ua={class:"form__group"},Na=["value"],Da={class:"form__group"},xa={class:"grid grid--two-column"},La={class:"form__group"},Ea={class:"form__group"},Fa={class:"form__actions"},Va=["disabled"],Oa={class:"card card--interactive"},Ga={class:"card__body"},Ra={key:0,class:"empty-state"},Pa={key:0,class:"alert alert--danger"},Ma={class:"table-responsive"},qa={class:"table"},Xa={"data-title":"Student"},Ba={key:0,class:"badge badge--neutral"},Ja={"data-title":"Score"},Ha=["onUpdate:modelValue","onInput"],za={"data-title":"Max"},Ka=["onUpdate:modelValue","onInput"],Ya={"data-title":"Percentage"},Qa={"data-title":"Letter"},Wa={"data-title":"Comments"},Za=["onUpdate:modelValue"],eo={class:"form__actions"},to=["disabled"],so={__name:"GradeEntryApp",props:{classSubject:{type:Object,default:()=>({})},enrollments:{type:Array,default:()=>[]},assessmentTypes:{type:Array,default:()=>[]},csrfToken:{type:String,default:""}},setup(R){var g,C;const f=R,d=X({...f.classSubject??{}});Array.isArray(d.assessments)||(d.assessments=[]);const S=k([...f.enrollments??[]]),F=k([...f.assessmentTypes??[]]),P=k((C=(g=d.assessments)==null?void 0:g[0])!=null&&C.id?String(d.assessments[0].id):""),_=X({title:"",assessmentTypeId:"",dueDate:"",maxScore:"",description:""}),N=k([]),q=k(!1),m=k([]),w=k(!1),T=X({}),D=E(()=>{var p;return P.value&&((p=d.assessments)==null?void 0:p.find(o=>String(o.id)===String(P.value)))||null}),A=E(()=>{var p;return((p=d.teacher)==null?void 0:p.name)??"Unassigned teacher"});function O(p){var o;return T[p]||(T[p]={score:"",maxScore:((o=D.value)==null?void 0:o.maxScore)??"",percentage:null,letter:null,comments:""}),T[p]}function V(){S.value.forEach(p=>{var c,j,M;const o=O(p.studentId),b=(j=(c=D.value)==null?void 0:c.grades)==null?void 0:j.find(Q=>Q.studentId===p.studentId);o.score=(b==null?void 0:b.score)??"",o.maxScore=(b==null?void 0:b.maxScore)??((M=D.value)==null?void 0:M.maxScore)??"",o.percentage=(b==null?void 0:b.percentage)??null,o.letter=(b==null?void 0:b.letterGrade)??null,o.comments=(b==null?void 0:b.comments)??""})}function B(p,o){if(p==null||p===""||o===null||o===void 0||o==="")return{percentage:null,letter:null};const b=Number(p),c=Number(o);if(!Number.isFinite(b)||!Number.isFinite(c)||c<=0)return{percentage:null,letter:null};const j=Number((Math.max(0,b)/c*100).toFixed(2));let M=null;return j>=90?M="A":j>=80?M="B":j>=70?M="C":j>=60?M="D":M="F",{percentage:j,letter:M}}function G(p){const o=O(p),b=B(o.score,o.maxScore);o.percentage=b.percentage,o.letter=b.letter}function J(p){return p==null||Number.isNaN(p)?"—":`${Number(p).toFixed(2)}%`}function H(p){if(!p)return"Not scheduled";const o=new Date(p);return Number.isNaN(o.getTime())?"Not scheduled":o.toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric",year:"numeric"})}function z(){V()}V();async function Y(){var p,o,b;if(N.value=[],_.title||N.value.push("Title is required."),_.assessmentTypeId||N.value.push("Assessment type is required."),!N.value.length){q.value=!0;try{const c=await fetch(`/classes/${d.classroomId}/subjects/${d.id}/assessments`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":f.csrfToken},body:JSON.stringify(_)}),j=await c.json().catch(()=>({}));if(!c.ok){N.value=j.errors||[j.message||"Unable to create assessment."];return}if(h(j.context),(b=(o=(p=j.context)==null?void 0:p.classSubject)==null?void 0:o.assessments)!=null&&b.length){const M=j.context.classSubject.assessments.at(-1);P.value=String(M.id),V()}_.title="",_.assessmentTypeId="",_.dueDate="",_.maxScore="",_.description=""}catch(c){N.value=[c.message||"Unable to create assessment."]}finally{q.value=!1}}}async function x(){if(m.value=[],!D.value){m.value.push("Select an assessment before saving.");return}w.value=!0;try{const p={assessmentId:D.value.id,entries:S.value.map(c=>({enrollmentId:c.id,studentId:c.studentId,score:T[c.studentId].score,maxScore:T[c.studentId].maxScore,comments:T[c.studentId].comments}))},o=await fetch(`/classes/${d.classroomId}/subjects/${d.id}/grades`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":f.csrfToken},body:JSON.stringify(p)}),b=await o.json().catch(()=>({}));if(!o.ok){m.value=b.errors||[b.message||"Unable to save grades."];return}h(b.context),V()}catch(p){m.value=[p.message||"Unable to save grades."]}finally{w.value=!1}}function h(p){p&&(Object.assign(d,p.classSubject??{}),S.value=p.enrollments??S.value,Array.isArray(p.assessmentTypes)&&(F.value=p.assessmentTypes))}return(p,o)=>{var b;return a(),s("div",aa,[e("section",oa,[e("div",la,[o[6]||(o[6]=e("p",{class:"page-hero__eyebrow"},"Grade workspace",-1)),e("h1",na,i(d.classroom.name)+" • "+i(d.subject.name),1),o[7]||(o[7]=e("p",{class:"page-hero__subtitle"}," Capture grades with clarity, track assessment progress, and keep every student supported. ",-1))]),e("dl",ra,[e("div",ia,[o[8]||(o[8]=e("dt",null,"Enrolled students",-1)),e("dd",null,i(S.value.length),1)]),e("div",da,[o[9]||(o[9]=e("dt",null,"Assessments",-1)),e("dd",null,i(d.assessments.length),1)]),e("div",ca,[o[10]||(o[10]=e("dt",null,"Instructor",-1)),e("dd",null,i(A.value),1)])])]),e("section",ua,[o[26]||(o[26]=e("header",{class:"card__header"},[e("div",null,[e("h2",{class:"card__title"},"Assessments"),e("p",{class:"card__subtitle"},"Choose an assessment to review or add a new experience below.")])],-1)),e("div",pa,[e("div",_a,[e("div",ma,[e("label",va,[o[11]||(o[11]=e("span",null,"Assessment",-1)),y(e("select",{"onUpdate:modelValue":o[0]||(o[0]=c=>P.value=c),class:"form__control",onChange:z},[d.assessments.length===0?(a(),s("option",ha," Create an assessment to begin ")):$("",!0),(a(!0),s(I,null,U(d.assessments,c=>(a(),s("option",{key:c.id,value:String(c.id)},i(c.title),9,ba))),128))],544),[[K,P.value]])])]),e("div",ga,[d.schedule?(a(),s("span",fa,i(d.schedule),1)):$("",!0)])]),D.value?(a(),s("div",ya,[e("article",$a,[o[12]||(o[12]=e("p",{class:"insight-card__label"},"Assessment type",-1)),e("p",Sa,i(((b=D.value.assessmentType)==null?void 0:b.name)??"Not set"),1),o[13]||(o[13]=e("p",{class:"insight-card__hint"},"Consistent types keep reporting balanced.",-1))]),e("article",ka,[o[14]||(o[14]=e("p",{class:"insight-card__label"},"Due date",-1)),e("p",ja,i(H(D.value.dueDate)),1),o[15]||(o[15]=e("p",{class:"insight-card__hint"},"Schedule clearly signals expectations to students.",-1))]),e("article",wa,[o[16]||(o[16]=e("p",{class:"insight-card__label"},"Default max score",-1)),e("p",Ca,i(D.value.maxScore!=null?D.value.maxScore:"Flexible"),1),o[17]||(o[17]=e("p",{class:"insight-card__hint"},"You can customise per student in the grid below.",-1))])])):$("",!0)]),e("form",{class:"form form--inline",onSubmit:Z(Y,["prevent"]),novalidate:""},[e("fieldset",null,[o[25]||(o[25]=e("legend",null,"Add assessment",-1)),N.value.length?(a(),s("div",Ta,[o[18]||(o[18]=e("p",null,"Unable to create assessment:",-1)),e("ul",null,[(a(!0),s(I,null,U(N.value,c=>(a(),s("li",{key:c},i(c),1))),128))])])):$("",!0),e("div",Aa,[e("label",Ia,[o[19]||(o[19]=e("span",null,"Title",-1)),y(e("input",{"onUpdate:modelValue":o[1]||(o[1]=c=>_.title=c),type:"text",required:"",class:"form__control",placeholder:"eg. Module reflection"},null,512),[[L,_.title,void 0,{trim:!0}]])]),e("label",Ua,[o[21]||(o[21]=e("span",null,"Type",-1)),y(e("select",{"onUpdate:modelValue":o[2]||(o[2]=c=>_.assessmentTypeId=c),required:"",class:"form__control"},[o[20]||(o[20]=e("option",{value:""},"Select type",-1)),(a(!0),s(I,null,U(F.value,c=>(a(),s("option",{key:c.id,value:String(c.id)},i(c.name),9,Na))),128))],512),[[K,_.assessmentTypeId]])]),e("label",Da,[o[22]||(o[22]=e("span",null,"Due date",-1)),y(e("input",{"onUpdate:modelValue":o[3]||(o[3]=c=>_.dueDate=c),type:"date",class:"form__control"},null,512),[[L,_.dueDate]])])]),e("div",xa,[e("label",La,[o[23]||(o[23]=e("span",null,"Max score",-1)),y(e("input",{"onUpdate:modelValue":o[4]||(o[4]=c=>_.maxScore=c),type:"number",step:"0.01",class:"form__control"},null,512),[[L,_.maxScore]])]),e("label",Ea,[o[24]||(o[24]=e("span",null,"Description",-1)),y(e("input",{"onUpdate:modelValue":o[5]||(o[5]=c=>_.description=c),type:"text",class:"form__control",placeholder:"Optional context"},null,512),[[L,_.description,void 0,{trim:!0}]])])]),e("div",Fa,[e("button",{type:"submit",class:"btn",disabled:q.value},"Add assessment",8,Va)])])],32)]),e("section",Oa,[o[30]||(o[30]=e("header",{class:"card__header"},[e("div",null,[e("h2",{class:"card__title"},"Grade entry"),e("p",{class:"card__subtitle"}," Enter scores, adjust maximums, and leave caring comments for each learner. ")])],-1)),e("div",Ga,[D.value?(a(),s("form",{key:1,class:"stack",onSubmit:Z(x,["prevent"]),novalidate:""},[m.value.length?(a(),s("div",Pa,[o[28]||(o[28]=e("p",null,"Unable to save grades:",-1)),e("ul",null,[(a(!0),s(I,null,U(m.value,c=>(a(),s("li",{key:c},i(c),1))),128))])])):$("",!0),e("div",Ma,[e("table",qa,[o[29]||(o[29]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"Student"),e("th",{scope:"col"},"Score"),e("th",{scope:"col"},"Max"),e("th",{scope:"col"},"Percentage"),e("th",{scope:"col"},"Letter"),e("th",{scope:"col"},"Comments")])],-1)),e("tbody",null,[(a(!0),s(I,null,U(S.value,c=>(a(),s("tr",{key:c.id},[e("td",Xa,[e("strong",null,i(c.name),1),c.studentNumber?(a(),s("span",Ba,i(c.studentNumber),1)):$("",!0)]),e("td",Ja,[y(e("input",{"onUpdate:modelValue":j=>T[c.studentId].score=j,type:"number",step:"0.01",class:"form__control",onInput:j=>G(c.studentId)},null,40,Ha),[[L,T[c.studentId].score,void 0,{number:!0}]])]),e("td",za,[y(e("input",{"onUpdate:modelValue":j=>T[c.studentId].maxScore=j,type:"number",step:"0.01",class:"form__control",onInput:j=>G(c.studentId)},null,40,Ka),[[L,T[c.studentId].maxScore,void 0,{number:!0}]])]),e("td",Ya,i(J(T[c.studentId].percentage)),1),e("td",Qa,i(T[c.studentId].letter||"—"),1),e("td",Wa,[y(e("input",{"onUpdate:modelValue":j=>T[c.studentId].comments=j,type:"text",class:"form__control",placeholder:"Encouragement or feedback"},null,8,Za),[[L,T[c.studentId].comments,void 0,{trim:!0}]])])]))),128))])])]),e("div",eo,[e("button",{type:"submit",class:"btn",disabled:w.value},"Save grades",8,to)])],32)):(a(),s("div",Ra,[...o[27]||(o[27]=[e("p",{class:"empty-state__title"},"No assessment selected",-1),e("p",null,"Create an assessment above or choose one to begin recording grades.",-1)])]))])])])}}},ao={class:"academic-app"},oo={class:"page-hero page-hero--compact"},lo={class:"page-hero__stats"},no={class:"page-hero__stat"},ro={class:"page-hero__stat"},io={class:"page-hero__stat"},co={class:"card card--interactive"},uo={class:"grid grid--three-column"},po={class:"form__group"},_o=["value"],mo={class:"form__group"},vo=["value"],ho={class:"form__actions align-end"},bo=["disabled"],go=["disabled"],fo={class:"card__body"},yo={key:0,class:"muted"},$o={key:1,class:"empty-state"},So={key:0,class:"stack"},ko={class:"report-section__header"},jo={key:0,class:"muted"},wo={class:"pill pill--soft"},Co={class:"table-responsive"},To={class:"table"},Ao={"data-title":"Student"},Io={key:0,class:"badge badge--neutral"},Uo={key:0,class:"badge"},No={"data-title":"Overall"},Do={key:0,class:"badge badge--success"},xo={__name:"GradeReportApp",props:{report:{type:Object,default:()=>({summaries:[],filters:{classes:[],students:[]}})}},setup(R){var A,O,V,B,G,J,H,z,Y;const f=R,d=X({summaries:((A=f.report)==null?void 0:A.summaries)??[],filters:{classes:((V=(O=f.report)==null?void 0:O.filters)==null?void 0:V.classes)??[],students:((G=(B=f.report)==null?void 0:B.filters)==null?void 0:G.students)??[]}}),S=X({classId:(H=(J=f.report)==null?void 0:J.filters)!=null&&H.classId?String(f.report.filters.classId):"",studentId:(Y=(z=f.report)==null?void 0:z.filters)!=null&&Y.studentId?String(f.report.filters.studentId):""}),F=k(!1),P=E(()=>{var x;return((x=d.summaries)==null?void 0:x.length)??0}),_=E(()=>{var h;const x=new Set;return(h=d.summaries)==null||h.forEach(g=>{var C;(C=g.students)==null||C.forEach(p=>x.add(p.studentId))}),x.size}),N=E(()=>{var g;let x=0,h=0;return(g=d.summaries)==null||g.forEach(C=>{var p;(p=C.students)==null||p.forEach(o=>{var b,c;if(((b=o.overall)==null?void 0:b.percentage)!==null&&((c=o.overall)==null?void 0:c.percentage)!==void 0){const j=Number(o.overall.percentage);Number.isNaN(j)||(x+=j,h+=1)}})}),h===0?null:Number((x/h).toFixed(2))}),q=E(()=>N.value===null?"—":`${N.value.toFixed(2)}%`),m=E(()=>!!(S.classId||S.studentId));function w(x){return x==null||Number.isNaN(x)?"—":`${Number(x).toFixed(2)}%`}function T(){S.classId="",S.studentId="",D()}async function D(){var x,h,g,C,p;F.value=!0;try{const o=new URLSearchParams;S.classId&&o.set("classId",S.classId),S.studentId&&o.set("studentId",S.studentId);const b=await fetch(`/reports/grades/data?${o.toString()}`);if(!b.ok)throw new Error("Failed to load report");const c=await b.json();d.summaries=((x=c.report)==null?void 0:x.summaries)??[],d.filters.classes=((g=(h=c.report)==null?void 0:h.filters)==null?void 0:g.classes)??d.filters.classes,d.filters.students=((p=(C=c.report)==null?void 0:C.filters)==null?void 0:p.students)??d.filters.students}catch(o){console.error(o)}finally{F.value=!1}}return(x,h)=>(a(),s("div",ao,[e("section",oo,[h[5]||(h[5]=e("div",{class:"page-hero__content"},[e("p",{class:"page-hero__eyebrow"},"Progress analytics"),e("h1",{class:"page-hero__title"},"Grade reports"),e("p",{class:"page-hero__subtitle"}," Explore class performance, celebrate wins, and spot support opportunities with calm, clear visuals. ")],-1)),e("dl",lo,[e("div",no,[h[2]||(h[2]=e("dt",null,"Classes tracked",-1)),e("dd",null,i(P.value),1)]),e("div",ro,[h[3]||(h[3]=e("dt",null,"Students represented",-1)),e("dd",null,i(_.value),1)]),e("div",io,[h[4]||(h[4]=e("dt",null,"Average overall",-1)),e("dd",null,i(q.value),1)])])]),e("section",co,[h[13]||(h[13]=e("header",{class:"card__header"},[e("div",null,[e("h2",{class:"card__title"},"Filters"),e("p",{class:"card__subtitle"},"Focus on a specific class or learner to tailor the insights you need.")])],-1)),e("form",{class:"form",onSubmit:Z(D,["prevent"])},[e("div",uo,[e("label",po,[h[7]||(h[7]=e("span",null,"Class",-1)),y(e("select",{"onUpdate:modelValue":h[0]||(h[0]=g=>S.classId=g),class:"form__control"},[h[6]||(h[6]=e("option",{value:""},"All classes",-1)),(a(!0),s(I,null,U(d.filters.classes,g=>(a(),s("option",{key:g.id,value:String(g.id)},i(g.name),9,_o))),128))],512),[[K,S.classId]])]),e("label",mo,[h[9]||(h[9]=e("span",null,"Student",-1)),y(e("select",{"onUpdate:modelValue":h[1]||(h[1]=g=>S.studentId=g),class:"form__control"},[h[8]||(h[8]=e("option",{value:""},"All students",-1)),(a(!0),s(I,null,U(d.filters.students,g=>(a(),s("option",{key:g.id,value:String(g.id)},i(g.name),9,vo))),128))],512),[[K,S.studentId]])]),e("div",ho,[e("button",{type:"submit",class:"btn",disabled:F.value},"Apply filters",8,bo),e("button",{type:"button",class:"btn btn--ghost btn--small",disabled:!m.value,onClick:T}," Reset ",8,go)])])],32),e("div",fo,[F.value?(a(),s("p",yo,"Loading report…")):d.summaries.length?$("",!0):(a(),s("div",$o,[...h[10]||(h[10]=[e("p",{class:"empty-state__title"},"No grade data yet",-1),e("p",null,"Record assessments for your classes to populate this space with insights.",-1)])]))]),!F.value&&d.summaries.length?(a(),s("div",So,[(a(!0),s(I,null,U(d.summaries,g=>(a(),s("section",{key:g.classId,class:"report-section"},[e("header",ko,[e("div",null,[e("h2",null,i(g.className),1),g.gradeLevel?(a(),s("p",jo,"Grade level: "+i(g.gradeLevel),1)):$("",!0)]),e("div",wo,i(g.subjects.length)+" subject"+i(g.subjects.length===1?"":"s"),1)]),e("div",Co,[e("table",To,[e("thead",null,[e("tr",null,[h[11]||(h[11]=e("th",{scope:"col"},"Student",-1)),(a(!0),s(I,null,U(g.subjects,C=>(a(),s("th",{key:C.classSubjectId,scope:"col"},i(C.name),1))),128)),h[12]||(h[12]=e("th",{scope:"col"},"Overall",-1))])]),e("tbody",null,[(a(!0),s(I,null,U(g.students,C=>(a(),s("tr",{key:C.studentId},[e("td",Ao,[e("strong",null,i(C.name),1),C.studentNumber?(a(),s("span",Io,i(C.studentNumber),1)):$("",!0)]),(a(!0),s(I,null,U(g.subjects,p=>{var o,b;return a(),s("td",{key:p.classSubjectId,"data-title":"Subject"},[re(i(w((o=C.subjectGrades[String(p.classSubjectId)])==null?void 0:o.percentage))+" ",1),(b=C.subjectGrades[String(p.classSubjectId)])!=null&&b.letterGrade?(a(),s("span",Uo,i(C.subjectGrades[String(p.classSubjectId)].letterGrade),1)):$("",!0)])}),128)),e("td",No,[re(i(w(C.overall.percentage))+" ",1),C.overall.letterGrade?(a(),s("span",Do,i(C.overall.letterGrade),1)):$("",!0)])]))),128))])])])]))),128))])):$("",!0)])]))}},ce={ClassManagementApp:Ft,ClassDetailApp:sa,GradeEntryApp:so,GradeReportApp:xo};function Lo(R){if(!R)return{};const f=document.getElementById(R);if(!f)return{};try{return JSON.parse(f.textContent||"{}")}catch(d){return console.warn(`Unable to parse state for ${R}`,d),{}}}function Eo(R){const f=R.dataset.vueApp,d=ce[f];if(!d)return;const S=Lo(R.dataset.stateId);pe(d,S).mount(R)}document.querySelectorAll("[data-vue-app]").forEach(R=>{ce[R.dataset.vueApp]&&Eo(R)});
//# sourceMappingURL=academic.js.map
