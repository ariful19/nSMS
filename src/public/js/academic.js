import{r as k,j as B,c as W,a,o as n,b as e,t as i,w as f,g as te,i as K,h as $,F as w,f as T,v as D,e as H,d as Y,p as ae}from"./chunks/sq-avatar-badge-D6ocPc-L.js";const ne={class:"grid grid--two-column"},oe={class:"card card--interactive"},le={class:"card__header"},re={class:"card__subtitle"},de={class:"card__actions"},ie={class:"toggle"},ue={key:0,class:"alert alert--danger"},ce={class:"form__group"},pe={class:"form__group"},me={class:"form__group"},ve=["value"],_e={class:"form__group"},be=["value"],he={class:"form__row"},fe={class:"form__group"},ge={class:"form__group"},ye={class:"form__group"},Se={class:"form__actions"},$e=["disabled"],ke={class:"table-responsive"},je={class:"table"},we={"data-title":"Name"},Te={class:"table__title"},Ce=["href"],Ie={class:"table__meta"},Ue={key:0},Ae={key:1,class:"badge badge--warning"},xe={"data-title":"Grade"},De={"data-title":"Students"},Ne={"data-title":"Subjects"},Le={class:"table__actions"},Ve=["onClick"],Ee=["href"],Fe=["onClick"],Oe=["onClick"],Ge={class:"card card--interactive"},Re={class:"card__header"},Pe={class:"card__subtitle"},qe={class:"card__actions"},Me={class:"toggle"},Xe={key:0,class:"alert alert--danger"},Je={class:"form__group"},Be={class:"form__group"},He={class:"form__group"},ze={class:"form__actions"},Ke=["disabled"],Qe={class:"list"},We={class:"list__heading"},Ye={key:0,class:"badge badge--neutral"},Ze={key:1,class:"badge badge--warning"},et={key:0,class:"list__description"},tt={class:"list__meta"},st={class:"list__actions"},at=["onClick"],nt=["onClick"],ot=["onClick"],lt={__name:"ClassManagementApp",props:{classes:{type:Array,default:()=>[]},subjects:{type:Array,default:()=>[]},lookups:{type:Object,default:()=>({gradeLevels:[],teachers:[]})},csrfToken:{type:String,default:""}},setup(E){var z,Q;const _=E,u=k([..._.classes]),j=k([..._.subjects]),N=B({gradeLevels:((z=_.lookups)==null?void 0:z.gradeLevels)??[],teachers:((Q=_.lookups)==null?void 0:Q.teachers)??[]}),M=k(!1),p=k(!1),c=B({name:"",code:"",gradeLevelId:"",homeroomTeacherId:"",startDate:"",endDate:"",description:""}),L=k([]),I=k(null),U=k(!1),b=B({name:"",code:"",description:""}),C=k([]),V=k(null),P=k(!1),q=W(()=>M.value?u.value:u.value.filter(m=>!m.isArchived)),X=W(()=>p.value?j.value:j.value.filter(m=>!m.isArchived));function A(){c.name="",c.code="",c.gradeLevelId="",c.homeroomTeacherId="",c.startDate="",c.endDate="",c.description="",I.value=null,L.value=[]}function g(m){c.name=m.name||"",c.code=m.code||"",c.gradeLevelId=m.gradeLevel?String(m.gradeLevel.id):"",c.homeroomTeacherId=m.homeroomTeacher?String(m.homeroomTeacher.id):"",c.startDate=m.startDate?m.startDate.slice(0,10):"",c.endDate=m.endDate?m.endDate.slice(0,10):"",c.description=m.description||"",I.value=m.id,L.value=[]}function y(){b.name="",b.code="",b.description="",V.value=null,C.value=[]}function x(m){b.name=m.name||"",b.code=m.code||"",b.description=m.description||"",V.value=m.id,C.value=[]}async function O(){const m=await fetch("/classes",{headers:{Accept:"application/json"}});if(!m.ok)throw new Error("Failed to refresh data");const o=await m.json();u.value=o.management.classes||[],j.value=o.management.subjects||[],o.management.lookups&&(N.gradeLevels=o.management.lookups.gradeLevels||N.gradeLevels,N.teachers=o.management.lookups.teachers||N.teachers)}async function R(){if(L.value=[],!c.name){L.value.push("Class name is required.");return}U.value=!0;try{const m=I.value?`/classes/${I.value}/update`:"/classes",o=await fetch(m,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":_.csrfToken},body:JSON.stringify(c)}),s=await o.json().catch(()=>({}));if(!o.ok){L.value=s.errors||[s.message||"Unable to save class."];return}await O(),A()}catch(m){L.value=[m.message||"Unexpected error saving class."]}finally{U.value=!1}}async function J(m){await r(`/classes/${m.id}/archive`)}async function v(m){await r(`/classes/${m.id}/restore`)}async function r(m){try{const o=await fetch(m,{method:"POST",headers:{Accept:"application/json","X-CSRF-Token":_.csrfToken}});if(!o.ok){const s=await o.json().catch(()=>({}));throw new Error(s.message||"Unable to update class")}await O()}catch(o){L.value=[o.message||"Unable to update class."]}}async function l(){if(C.value=[],!b.name){C.value.push("Subject name is required.");return}P.value=!0;try{const m=V.value?`/classes/subjects/${V.value}/update`:"/classes/subjects",o=await fetch(m,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":_.csrfToken},body:JSON.stringify(b)}),s=await o.json().catch(()=>({}));if(!o.ok){C.value=s.errors||[s.message||"Unable to save subject."];return}await O(),y()}catch(m){C.value=[m.message||"Unexpected error saving subject."]}finally{P.value=!1}}async function S(m){await G(`/classes/subjects/${m.id}/archive`)}async function F(m){await G(`/classes/subjects/${m.id}/restore`)}async function G(m){try{const o=await fetch(m,{method:"POST",headers:{Accept:"application/json","X-CSRF-Token":_.csrfToken}});if(!o.ok){const s=await o.json().catch(()=>({}));throw new Error(s.message||"Unable to update subject")}await O()}catch(o){C.value=[o.message||"Unable to update subject."]}}return(m,o)=>(n(),a("section",ne,[e("article",oe,[e("header",le,[e("div",null,[o[12]||(o[12]=e("h1",{class:"card__title"},"Classes",-1)),e("p",re,i(q.value.length)+" class"+i(q.value.length===1?"":"es")+" visible ",1)]),e("div",de,[e("label",ie,[f(e("input",{type:"checkbox","onUpdate:modelValue":o[0]||(o[0]=s=>M.value=s)},null,512),[[te,M.value]]),o[13]||(o[13]=e("span",null,"Show archived",-1))])])]),e("form",{class:"form",onSubmit:K(R,["prevent"]),novalidate:""},[L.value.length?(n(),a("div",ue,[o[14]||(o[14]=e("p",null,"Unable to save the class:",-1)),e("ul",null,[(n(!0),a(w,null,T(L.value,s=>(n(),a("li",{key:s},i(s),1))),128))])])):$("",!0),e("label",ce,[o[15]||(o[15]=e("span",null,"Name",-1)),f(e("input",{"onUpdate:modelValue":o[1]||(o[1]=s=>c.name=s),type:"text",required:""},null,512),[[D,c.name,void 0,{trim:!0}]])]),e("label",pe,[o[16]||(o[16]=e("span",null,"Code",-1)),f(e("input",{"onUpdate:modelValue":o[2]||(o[2]=s=>c.code=s),type:"text"},null,512),[[D,c.code,void 0,{trim:!0}]])]),e("label",me,[o[18]||(o[18]=e("span",null,"Grade level",-1)),f(e("select",{"onUpdate:modelValue":o[3]||(o[3]=s=>c.gradeLevelId=s)},[o[17]||(o[17]=e("option",{value:""},"Select grade",-1)),(n(!0),a(w,null,T(N.gradeLevels,s=>(n(),a("option",{key:s.id,value:String(s.id)},i(s.name),9,ve))),128))],512),[[H,c.gradeLevelId]])]),e("label",_e,[o[20]||(o[20]=e("span",null,"Homeroom teacher",-1)),f(e("select",{"onUpdate:modelValue":o[4]||(o[4]=s=>c.homeroomTeacherId=s)},[o[19]||(o[19]=e("option",{value:""},"Unassigned",-1)),(n(!0),a(w,null,T(N.teachers,s=>(n(),a("option",{key:s.id,value:String(s.id)},i(s.name),9,be))),128))],512),[[H,c.homeroomTeacherId]])]),e("div",he,[e("label",fe,[o[21]||(o[21]=e("span",null,"Start date",-1)),f(e("input",{"onUpdate:modelValue":o[5]||(o[5]=s=>c.startDate=s),type:"date"},null,512),[[D,c.startDate]])]),e("label",ge,[o[22]||(o[22]=e("span",null,"End date",-1)),f(e("input",{"onUpdate:modelValue":o[6]||(o[6]=s=>c.endDate=s),type:"date"},null,512),[[D,c.endDate]])])]),e("label",ye,[o[23]||(o[23]=e("span",null,"Description",-1)),f(e("textarea",{"onUpdate:modelValue":o[7]||(o[7]=s=>c.description=s),rows:"2"},null,512),[[D,c.description,void 0,{trim:!0}]])]),e("div",Se,[e("button",{type:"submit",class:"btn",disabled:U.value},i(I.value?"Update class":"Create class"),9,$e),I.value?(n(),a("button",{key:0,type:"button",class:"btn btn--ghost",onClick:A}," Cancel edit ")):$("",!0)])],32),e("div",ke,[e("table",je,[o[24]||(o[24]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"Name"),e("th",{scope:"col"},"Grade"),e("th",{scope:"col"},"Students"),e("th",{scope:"col"},"Subjects"),e("th",{scope:"col"},"Actions")])],-1)),e("tbody",null,[(n(!0),a(w,null,T(q.value,s=>{var t;return n(),a("tr",{key:s.id},[e("td",we,[e("div",Te,[e("a",{href:`/classes/${s.id}`},i(s.name),9,Ce)]),e("div",Ie,[s.homeroomTeacher?(n(),a("span",Ue," Homeroom: "+i(s.homeroomTeacher.name),1)):$("",!0),s.isArchived?(n(),a("span",Ae," Archived ")):$("",!0)])]),e("td",xe,i(((t=s.gradeLevel)==null?void 0:t.name)??"â€”"),1),e("td",De,i(s.studentCount),1),e("td",Ne,i(s.subjectCount),1),e("td",Le,[e("button",{type:"button",class:"btn btn--small",onClick:h=>g(s)}," Edit ",8,Ve),e("a",{class:"btn btn--small btn--ghost",href:`/classes/${s.id}`}," Open ",8,Ee),s.isArchived?(n(),a("button",{key:1,type:"button",class:"btn btn--small",onClick:h=>v(s)}," Restore ",8,Oe)):(n(),a("button",{key:0,type:"button",class:"btn btn--small btn--danger",onClick:h=>J(s)}," Archive ",8,Fe))])])}),128))])])])]),e("article",Ge,[e("header",Re,[e("div",null,[o[25]||(o[25]=e("h2",{class:"card__title"},"Subjects",-1)),e("p",Pe,i(X.value.length)+" subject"+i(X.value.length===1?"":"s")+" in catalogue ",1)]),e("div",qe,[e("label",Me,[f(e("input",{type:"checkbox","onUpdate:modelValue":o[8]||(o[8]=s=>p.value=s)},null,512),[[te,p.value]]),o[26]||(o[26]=e("span",null,"Show archived",-1))])])]),e("form",{class:"form",onSubmit:K(l,["prevent"]),novalidate:""},[C.value.length?(n(),a("div",Xe,[o[27]||(o[27]=e("p",null,"Unable to save the subject:",-1)),e("ul",null,[(n(!0),a(w,null,T(C.value,s=>(n(),a("li",{key:s},i(s),1))),128))])])):$("",!0),e("label",Je,[o[28]||(o[28]=e("span",null,"Name",-1)),f(e("input",{"onUpdate:modelValue":o[9]||(o[9]=s=>b.name=s),type:"text",required:""},null,512),[[D,b.name,void 0,{trim:!0}]])]),e("label",Be,[o[29]||(o[29]=e("span",null,"Code",-1)),f(e("input",{"onUpdate:modelValue":o[10]||(o[10]=s=>b.code=s),type:"text"},null,512),[[D,b.code,void 0,{trim:!0}]])]),e("label",He,[o[30]||(o[30]=e("span",null,"Description",-1)),f(e("textarea",{"onUpdate:modelValue":o[11]||(o[11]=s=>b.description=s),rows:"2"},null,512),[[D,b.description,void 0,{trim:!0}]])]),e("div",ze,[e("button",{type:"submit",class:"btn",disabled:P.value},i(V.value?"Update subject":"Create subject"),9,Ke),V.value?(n(),a("button",{key:0,type:"button",class:"btn btn--ghost",onClick:y}," Cancel edit ")):$("",!0)])],32),e("ul",Qe,[(n(!0),a(w,null,T(X.value,s=>(n(),a("li",{key:s.id},[e("div",We,[e("strong",null,i(s.name),1),s.code?(n(),a("span",Ye,i(s.code),1)):$("",!0),s.isArchived?(n(),a("span",Ze,"Archived")):$("",!0)]),s.description?(n(),a("p",et,i(s.description),1)):$("",!0),e("div",tt,[e("span",null,"Linked classes: "+i(s.classCount),1)]),e("div",st,[e("button",{type:"button",class:"btn btn--small",onClick:t=>x(s)}," Edit ",8,at),s.isArchived?(n(),a("button",{key:1,type:"button",class:"btn btn--small",onClick:t=>F(s)}," Restore ",8,ot)):(n(),a("button",{key:0,type:"button",class:"btn btn--small btn--danger",onClick:t=>S(s)}," Archive ",8,nt))])]))),128))])])]))}},rt={class:"stack"},dt={class:"card card--interactive"},it={class:"card__header"},ut={class:"card__title"},ct={class:"card__subtitle"},pt={class:"card__actions"},mt={key:0,class:"badge badge--warning"},vt={key:0,class:"alert alert--danger"},_t={class:"grid grid--two-column"},bt={class:"form__group"},ht={class:"form__group"},ft={class:"grid grid--two-column"},gt={class:"form__group"},yt=["value"],St={class:"form__group"},$t=["value"],kt={class:"grid grid--two-column"},jt={class:"form__group"},wt={class:"form__group"},Tt={class:"form__group"},Ct={class:"form__actions"},It=["disabled"],Ut={class:"card card--interactive"},At={key:0,class:"alert alert--danger"},xt={class:"grid grid--two-column"},Dt={class:"form__group"},Nt=["value"],Lt={class:"form__group"},Vt=["value"],Et={class:"form__group"},Ft={class:"form__actions"},Ot=["disabled"],Gt={class:"table-responsive"},Rt={class:"table"},Pt={"data-title":"Subject"},qt={"data-title":"Teacher"},Mt={"data-title":"Schedule"},Xt={class:"table__actions"},Jt=["href"],Bt=["onClick"],Ht={key:0},zt={class:"card card--interactive"},Kt={class:"card__body"},Qt={class:"form__group"},Wt={key:0,class:"alert alert--danger"},Yt={key:1,class:"muted"},Zt={key:2,class:"list list--compact"},es={key:0,class:"badge badge--neutral"},ts=["onClick"],ss={class:"table-responsive"},as={class:"table"},ns={"data-title":"Student"},os={key:0,class:"badge badge--neutral"},ls={"data-title":"Grade"},rs={"data-title":"Status"},ds={class:"table__actions"},is=["onClick"],us={key:0},cs={__name:"ClassDetailApp",props:{detail:{type:Object,default:()=>({})},csrfToken:{type:String,default:""}},setup(E){var G,z,Q,m,o;const _=E,u=B({...((G=_.detail)==null?void 0:G.classroom)??{}}),j=k([...((z=_.detail)==null?void 0:z.subjects)??[]]),N=B({teachers:((Q=_.detail)==null?void 0:Q.teachers)??[],gradeLevels:((m=_.detail)==null?void 0:m.gradeLevels)??[]}),M=k([...((o=_.detail)==null?void 0:o.assessmentTypes)??[]]),p=B({name:u.name||"",code:u.code||"",gradeLevelId:u.gradeLevel?String(u.gradeLevel.id):"",homeroomTeacherId:u.homeroomTeacher?String(u.homeroomTeacher.id):"",startDate:u.startDate?u.startDate.slice(0,10):"",endDate:u.endDate?u.endDate.slice(0,10):"",description:u.description||""}),c=k([]),L=k(!1),I=k([]),U=B({subjectId:"",teacherId:"",schedule:""}),b=k(!1),C=k(""),V=k([]),P=k(!1),q=k([]);let X;const A=W(()=>u.id);async function g(){const s=await fetch(`/classes/${A.value}`,{headers:{Accept:"application/json"}});if(!s.ok)throw new Error("Failed to refresh class");const h=(await s.json()).detail;Object.assign(u,h.classroom),j.value=h.subjects,Array.isArray(h.teachers)&&(N.teachers=h.teachers),Array.isArray(h.gradeLevels)&&(N.gradeLevels=h.gradeLevels),h.classroom.gradeLevel&&(p.gradeLevelId=String(h.classroom.gradeLevel.id)),p.name=h.classroom.name||"",p.code=h.classroom.code||"",p.homeroomTeacherId=h.classroom.homeroomTeacher?String(h.classroom.homeroomTeacher.id):"",p.startDate=h.classroom.startDate?h.classroom.startDate.slice(0,10):"",p.endDate=h.classroom.endDate?h.classroom.endDate.slice(0,10):"",p.description=h.classroom.description||"",Array.isArray(h.assessmentTypes)&&(M.value=h.assessmentTypes)}async function y(){if(c.value=[],!p.name){c.value.push("Class name is required.");return}L.value=!0;try{const s=await fetch(`/classes/${A.value}/update`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":_.csrfToken},body:JSON.stringify(p)}),t=await s.json().catch(()=>({}));if(!s.ok){c.value=t.errors||[t.message||"Unable to update class."];return}await g()}catch(s){c.value=[s.message||"Unexpected error updating class."]}finally{L.value=!1}}async function x(){await R(`/classes/${A.value}/archive`)}async function O(){await R(`/classes/${A.value}/restore`)}async function R(s){c.value=[];try{const t=await fetch(s,{method:"POST",headers:{Accept:"application/json","X-CSRF-Token":_.csrfToken}});if(!t.ok){const h=await t.json().catch(()=>({}));throw new Error(h.message||"Unable to update class")}await g()}catch(t){c.value=[t.message||"Unable to update class."]}}async function J(){if(I.value=[],!U.subjectId){I.value.push("Subject is required.");return}b.value=!0;try{const s=await fetch(`/classes/${A.value}/subjects`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":_.csrfToken},body:JSON.stringify(U)}),t=await s.json().catch(()=>({}));if(!s.ok){I.value=t.errors||[t.message||"Unable to assign subject."];return}U.subjectId="",U.teacherId="",U.schedule="",await g()}catch(s){I.value=[s.message||"Unable to assign subject."]}finally{b.value=!1}}async function v(s){I.value=[];try{const t=await fetch(`/classes/${A.value}/subjects/${s.id}/delete`,{method:"POST",headers:{Accept:"application/json","X-CSRF-Token":_.csrfToken}});if(!t.ok){const h=await t.json().catch(()=>({}));throw new Error(h.message||"Unable to remove subject.")}await g()}catch(t){I.value=[t.message||"Unable to remove subject."]}}function r(){if(clearTimeout(X),!C.value){V.value=[];return}X=setTimeout(l,250)}async function l(){P.value=!0;try{const s=new URLSearchParams({search:C.value}),t=await fetch(`/classes/${A.value}/enrollment/search?${s.toString()}`,{headers:{Accept:"application/json"}});if(!t.ok)throw new Error("Search failed");const h=await t.json();V.value=h.students||[]}catch{V.value=[]}finally{P.value=!1}}async function S(s){q.value=[];try{const t=await fetch(`/classes/${A.value}/enrollments`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":_.csrfToken},body:JSON.stringify({studentId:s.id})}),h=await t.json().catch(()=>({}));if(!t.ok)throw new Error(h.message||"Unable to add student");C.value="",V.value=[],await g()}catch(t){q.value=[t.message||"Unable to add student."]}}async function F(s){q.value=[];try{const t=await fetch(`/classes/${A.value}/enrollments/${s.id}/delete`,{method:"POST",headers:{Accept:"application/json","X-CSRF-Token":_.csrfToken}});if(!t.ok){const h=await t.json().catch(()=>({}));throw new Error(h.message||"Unable to remove student")}await g()}catch(t){q.value=[t.message||"Unable to remove student."]}}return(s,t)=>{var h,Z;return n(),a("div",rt,[e("section",dt,[e("header",it,[e("div",null,[e("h1",ut,i(u.name),1),e("p",ct,i(((h=u.gradeLevel)==null?void 0:h.name)??"Unassigned grade")+" â€¢ "+i(((Z=u.homeroomTeacher)==null?void 0:Z.name)??"No homeroom"),1)]),e("div",pt,[u.isArchived?(n(),a("span",mt,"Archived")):$("",!0)])]),e("form",{class:"form",onSubmit:K(y,["prevent"]),novalidate:""},[c.value.length?(n(),a("div",vt,[t[11]||(t[11]=e("p",null,"Unable to update class:",-1)),e("ul",null,[(n(!0),a(w,null,T(c.value,d=>(n(),a("li",{key:d},i(d),1))),128))])])):$("",!0),e("div",_t,[e("label",bt,[t[12]||(t[12]=e("span",null,"Name",-1)),f(e("input",{"onUpdate:modelValue":t[0]||(t[0]=d=>p.name=d),type:"text",required:""},null,512),[[D,p.name,void 0,{trim:!0}]])]),e("label",ht,[t[13]||(t[13]=e("span",null,"Code",-1)),f(e("input",{"onUpdate:modelValue":t[1]||(t[1]=d=>p.code=d),type:"text"},null,512),[[D,p.code,void 0,{trim:!0}]])])]),e("div",ft,[e("label",gt,[t[15]||(t[15]=e("span",null,"Grade level",-1)),f(e("select",{"onUpdate:modelValue":t[2]||(t[2]=d=>p.gradeLevelId=d)},[t[14]||(t[14]=e("option",{value:""},"Select grade",-1)),(n(!0),a(w,null,T(N.gradeLevels,d=>(n(),a("option",{key:d.id,value:String(d.id)},i(d.name),9,yt))),128))],512),[[H,p.gradeLevelId]])]),e("label",St,[t[17]||(t[17]=e("span",null,"Homeroom teacher",-1)),f(e("select",{"onUpdate:modelValue":t[3]||(t[3]=d=>p.homeroomTeacherId=d)},[t[16]||(t[16]=e("option",{value:""},"Unassigned",-1)),(n(!0),a(w,null,T(N.teachers,d=>(n(),a("option",{key:d.id,value:String(d.id)},i(d.name),9,$t))),128))],512),[[H,p.homeroomTeacherId]])])]),e("div",kt,[e("label",jt,[t[18]||(t[18]=e("span",null,"Start date",-1)),f(e("input",{"onUpdate:modelValue":t[4]||(t[4]=d=>p.startDate=d),type:"date"},null,512),[[D,p.startDate]])]),e("label",wt,[t[19]||(t[19]=e("span",null,"End date",-1)),f(e("input",{"onUpdate:modelValue":t[5]||(t[5]=d=>p.endDate=d),type:"date"},null,512),[[D,p.endDate]])])]),e("label",Tt,[t[20]||(t[20]=e("span",null,"Description",-1)),f(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=d=>p.description=d),rows:"2"},null,512),[[D,p.description,void 0,{trim:!0}]])]),e("div",Ct,[e("button",{type:"submit",class:"btn",disabled:L.value},"Save changes",8,It),u.isArchived?(n(),a("button",{key:0,type:"button",class:"btn",onClick:O}," Restore class ")):(n(),a("button",{key:1,type:"button",class:"btn btn--danger",onClick:x}," Archive class "))])],32)]),e("section",Ut,[t[29]||(t[29]=e("header",{class:"card__header"},[e("h2",{class:"card__title"},"Subject assignments")],-1)),e("form",{class:"form",onSubmit:K(J,["prevent"]),novalidate:""},[I.value.length?(n(),a("div",At,[t[21]||(t[21]=e("p",null,"Unable to assign subject:",-1)),e("ul",null,[(n(!0),a(w,null,T(I.value,d=>(n(),a("li",{key:d},i(d),1))),128))])])):$("",!0),e("div",xt,[e("label",Dt,[t[23]||(t[23]=e("span",null,"Subject",-1)),f(e("select",{"onUpdate:modelValue":t[7]||(t[7]=d=>U.subjectId=d),required:""},[t[22]||(t[22]=e("option",{value:""},"Select subject",-1)),(n(!0),a(w,null,T(j.value,d=>(n(),a("option",{key:d.id,value:String(d.id)},i(d.name),9,Nt))),128))],512),[[H,U.subjectId]])]),e("label",Lt,[t[25]||(t[25]=e("span",null,"Teacher",-1)),f(e("select",{"onUpdate:modelValue":t[8]||(t[8]=d=>U.teacherId=d)},[t[24]||(t[24]=e("option",{value:""},"Unassigned",-1)),(n(!0),a(w,null,T(N.teachers,d=>(n(),a("option",{key:d.id,value:String(d.id)},i(d.name),9,Vt))),128))],512),[[H,U.teacherId]])])]),e("label",Et,[t[26]||(t[26]=e("span",null,"Schedule notes",-1)),f(e("input",{"onUpdate:modelValue":t[9]||(t[9]=d=>U.schedule=d),type:"text"},null,512),[[D,U.schedule,void 0,{trim:!0}]])]),e("div",Ft,[e("button",{type:"submit",class:"btn",disabled:b.value}," Save assignment ",8,Ot)])],32),e("div",Gt,[e("table",Rt,[t[28]||(t[28]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"Subject"),e("th",{scope:"col"},"Teacher"),e("th",{scope:"col"},"Schedule"),e("th",{scope:"col"},"Actions")])],-1)),e("tbody",null,[(n(!0),a(w,null,T(u.subjects,d=>(n(),a("tr",{key:d.id},[e("td",Pt,i(d.subjectName),1),e("td",qt,i(d.teacherName??"Unassigned"),1),e("td",Mt,i(d.schedule??"â€”"),1),e("td",Xt,[e("a",{class:"btn btn--small",href:`/classes/${u.id}/subjects/${d.id}/grades`}," Grade entry ",8,Jt),e("button",{type:"button",class:"btn btn--small btn--danger",onClick:ee=>v(d)}," Remove ",8,Bt)])]))),128)),u.subjects.length===0?(n(),a("tr",Ht,[...t[27]||(t[27]=[e("td",{colspan:"4"},"No subjects assigned yet.",-1)])])):$("",!0)])])])]),e("section",zt,[t[34]||(t[34]=e("header",{class:"card__header"},[e("h2",{class:"card__title"},"Enrollments")],-1)),e("div",Kt,[e("label",Qt,[t[30]||(t[30]=e("span",null,"Search students",-1)),f(e("input",{"onUpdate:modelValue":t[10]||(t[10]=d=>C.value=d),type:"search",placeholder:"Name or student number",onInput:r},null,544),[[D,C.value,void 0,{trim:!0}]])]),q.value.length?(n(),a("div",Wt,[t[31]||(t[31]=e("p",null,"Unable to update enrollments:",-1)),e("ul",null,[(n(!0),a(w,null,T(q.value,d=>(n(),a("li",{key:d},i(d),1))),128))])])):$("",!0),C.value&&!P.value&&V.value.length===0?(n(),a("p",Yt," No students match your search or they are already enrolled. ")):$("",!0),V.value.length?(n(),a("ul",Zt,[(n(!0),a(w,null,T(V.value,d=>(n(),a("li",{key:d.id,class:"list__option"},[e("div",null,[e("strong",null,i(d.name),1),d.studentNumber?(n(),a("span",es,i(d.studentNumber),1)):$("",!0)]),e("button",{type:"button",class:"btn btn--small",onClick:ee=>S(d)}," Add to class ",8,ts)]))),128))])):$("",!0)]),e("div",ss,[e("table",as,[t[33]||(t[33]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"Student"),e("th",{scope:"col"},"Grade"),e("th",{scope:"col"},"Status"),e("th",{scope:"col"},"Actions")])],-1)),e("tbody",null,[(n(!0),a(w,null,T(u.enrollments,d=>(n(),a("tr",{key:d.id},[e("td",ns,[Y(i(d.name)+" ",1),d.studentNumber?(n(),a("span",os,i(d.studentNumber),1)):$("",!0)]),e("td",ls,i(d.gradeLevel??"â€”"),1),e("td",rs,i(d.status??"Active"),1),e("td",ds,[e("button",{type:"button",class:"btn btn--small btn--danger",onClick:ee=>F(d)}," Remove ",8,is)])]))),128)),u.enrollments.length===0?(n(),a("tr",us,[...t[32]||(t[32]=[e("td",{colspan:"4"},"No students enrolled yet.",-1)])])):$("",!0)])])])])])}}},ps={class:"stack"},ms={class:"card card--interactive"},vs={class:"card__header"},_s={class:"card__title"},bs={class:"card__subtitle"},hs={class:"card__body"},fs={class:"assessment-selector"},gs={class:"form__group"},ys={key:0,value:""},Ss=["value"],$s={key:0,class:"alert alert--danger"},ks={class:"grid grid--three-column"},js={class:"form__group"},ws={class:"form__group"},Ts=["value"],Cs={class:"form__group"},Is={class:"grid grid--two-column"},Us={class:"form__group"},As={class:"form__group"},xs={class:"form__actions"},Ds=["disabled"],Ns={class:"card card--interactive"},Ls={class:"card__body"},Vs={key:0,class:"alert alert--info"},Es={key:0,class:"alert alert--danger"},Fs={class:"table-responsive"},Os={class:"table"},Gs={"data-title":"Student"},Rs={key:0,class:"badge badge--neutral"},Ps={"data-title":"Score"},qs=["onUpdate:modelValue","onInput"],Ms={"data-title":"Max"},Xs=["onUpdate:modelValue","onInput"],Js={"data-title":"Percentage"},Bs={"data-title":"Letter"},Hs={"data-title":"Comments"},zs=["onUpdate:modelValue"],Ks={class:"form__actions"},Qs=["disabled"],Ws={__name:"GradeEntryApp",props:{classSubject:{type:Object,default:()=>({})},enrollments:{type:Array,default:()=>[]},assessmentTypes:{type:Array,default:()=>[]},csrfToken:{type:String,default:""}},setup(E){var R,J;const _=E,u=B({..._.classSubject??{}});Array.isArray(u.assessments)||(u.assessments=[]);const j=k([..._.enrollments??[]]),N=k([..._.assessmentTypes??[]]),M=k((J=(R=u.assessments)==null?void 0:R[0])!=null&&J.id?String(u.assessments[0].id):""),p=B({title:"",assessmentTypeId:"",dueDate:"",maxScore:"",description:""}),c=k([]),L=k(!1),I=k([]),U=k(!1),b=B({}),C=W(()=>{var v;return M.value&&((v=u.assessments)==null?void 0:v.find(r=>String(r.id)===String(M.value)))||null});function V(v){var r;return b[v]||(b[v]={score:"",maxScore:((r=C.value)==null?void 0:r.maxScore)??"",percentage:null,letter:null,comments:""}),b[v]}function P(){j.value.forEach(v=>{var S,F,G;const r=V(v.studentId),l=(F=(S=C.value)==null?void 0:S.grades)==null?void 0:F.find(z=>z.studentId===v.studentId);r.score=(l==null?void 0:l.score)??"",r.maxScore=(l==null?void 0:l.maxScore)??((G=C.value)==null?void 0:G.maxScore)??"",r.percentage=(l==null?void 0:l.percentage)??null,r.letter=(l==null?void 0:l.letterGrade)??null,r.comments=(l==null?void 0:l.comments)??""})}function q(v,r){if(v==null||v===""||r===null||r===void 0||r==="")return{percentage:null,letter:null};const l=Number(v),S=Number(r);if(!Number.isFinite(l)||!Number.isFinite(S)||S<=0)return{percentage:null,letter:null};const F=Number((Math.max(0,l)/S*100).toFixed(2));let G=null;return F>=90?G="A":F>=80?G="B":F>=70?G="C":F>=60?G="D":G="F",{percentage:F,letter:G}}function X(v){const r=V(v),l=q(r.score,r.maxScore);r.percentage=l.percentage,r.letter=l.letter}function A(v){return v==null?"â€”":`${v.toFixed(2)}%`}function g(){P()}P();async function y(){var v,r,l;if(c.value=[],p.title||c.value.push("Title is required."),p.assessmentTypeId||c.value.push("Assessment type is required."),!c.value.length){L.value=!0;try{const S=await fetch(`/classes/${u.classroomId}/subjects/${u.id}/assessments`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":_.csrfToken},body:JSON.stringify(p)}),F=await S.json().catch(()=>({}));if(!S.ok){c.value=F.errors||[F.message||"Unable to create assessment."];return}if(O(F.context),(l=(r=(v=F.context)==null?void 0:v.classSubject)==null?void 0:r.assessments)!=null&&l.length){const G=F.context.classSubject.assessments.at(-1);M.value=String(G.id),P()}p.title="",p.assessmentTypeId="",p.dueDate="",p.maxScore="",p.description=""}catch(S){c.value=[S.message||"Unable to create assessment."]}finally{L.value=!1}}}async function x(){if(I.value=[],!C.value){I.value.push("Select an assessment before saving.");return}U.value=!0;try{const v={assessmentId:C.value.id,entries:j.value.map(S=>({enrollmentId:S.id,studentId:S.studentId,score:b[S.studentId].score,maxScore:b[S.studentId].maxScore,comments:b[S.studentId].comments}))},r=await fetch(`/classes/${u.classroomId}/subjects/${u.id}/grades`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":_.csrfToken},body:JSON.stringify(v)}),l=await r.json().catch(()=>({}));if(!r.ok){I.value=l.errors||[l.message||"Unable to save grades."];return}O(l.context),P()}catch(v){I.value=[v.message||"Unable to save grades."]}finally{U.value=!1}}function O(v){v&&(Object.assign(u,v.classSubject??{}),j.value=v.enrollments??j.value,Array.isArray(v.assessmentTypes)&&(N.value=v.assessmentTypes))}return(v,r)=>(n(),a("div",ps,[e("section",ms,[e("header",vs,[e("div",null,[e("h1",_s,i(u.classroom.name)+" â€¢ "+i(u.subject.name),1),e("p",bs,i(j.value.length)+" student"+i(j.value.length===1?"":"s")+" enrolled ",1)])]),e("div",hs,[e("div",fs,[e("label",gs,[r[6]||(r[6]=e("span",null,"Assessment",-1)),f(e("select",{"onUpdate:modelValue":r[0]||(r[0]=l=>M.value=l),onChange:g},[u.assessments.length===0?(n(),a("option",ys,"Create an assessment to begin")):$("",!0),(n(!0),a(w,null,T(u.assessments,l=>(n(),a("option",{key:l.id,value:String(l.id)},i(l.title),9,Ss))),128))],544),[[H,M.value]])])])]),e("form",{class:"form form--inline",onSubmit:K(y,["prevent"]),novalidate:""},[e("fieldset",null,[r[14]||(r[14]=e("legend",null,"Add assessment",-1)),c.value.length?(n(),a("div",$s,[r[7]||(r[7]=e("p",null,"Unable to create assessment:",-1)),e("ul",null,[(n(!0),a(w,null,T(c.value,l=>(n(),a("li",{key:l},i(l),1))),128))])])):$("",!0),e("div",ks,[e("label",js,[r[8]||(r[8]=e("span",null,"Title",-1)),f(e("input",{"onUpdate:modelValue":r[1]||(r[1]=l=>p.title=l),type:"text",required:""},null,512),[[D,p.title,void 0,{trim:!0}]])]),e("label",ws,[r[10]||(r[10]=e("span",null,"Type",-1)),f(e("select",{"onUpdate:modelValue":r[2]||(r[2]=l=>p.assessmentTypeId=l),required:""},[r[9]||(r[9]=e("option",{value:""},"Select type",-1)),(n(!0),a(w,null,T(N.value,l=>(n(),a("option",{key:l.id,value:String(l.id)},i(l.name),9,Ts))),128))],512),[[H,p.assessmentTypeId]])]),e("label",Cs,[r[11]||(r[11]=e("span",null,"Due date",-1)),f(e("input",{"onUpdate:modelValue":r[3]||(r[3]=l=>p.dueDate=l),type:"date"},null,512),[[D,p.dueDate]])])]),e("div",Is,[e("label",Us,[r[12]||(r[12]=e("span",null,"Max score",-1)),f(e("input",{"onUpdate:modelValue":r[4]||(r[4]=l=>p.maxScore=l),type:"number",step:"0.01"},null,512),[[D,p.maxScore]])]),e("label",As,[r[13]||(r[13]=e("span",null,"Description",-1)),f(e("input",{"onUpdate:modelValue":r[5]||(r[5]=l=>p.description=l),type:"text"},null,512),[[D,p.description,void 0,{trim:!0}]])])]),e("div",xs,[e("button",{type:"submit",class:"btn",disabled:L.value},"Add assessment",8,Ds)])])],32)]),e("section",Ns,[r[17]||(r[17]=e("header",{class:"card__header"},[e("h2",{class:"card__title"},"Grade entry")],-1)),e("div",Ls,[C.value?(n(),a("form",{key:1,class:"stack",onSubmit:K(x,["prevent"]),novalidate:""},[I.value.length?(n(),a("div",Es,[r[15]||(r[15]=e("p",null,"Unable to save grades:",-1)),e("ul",null,[(n(!0),a(w,null,T(I.value,l=>(n(),a("li",{key:l},i(l),1))),128))])])):$("",!0),e("div",Fs,[e("table",Os,[r[16]||(r[16]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"Student"),e("th",{scope:"col"},"Score"),e("th",{scope:"col"},"Max"),e("th",{scope:"col"},"Percentage"),e("th",{scope:"col"},"Letter"),e("th",{scope:"col"},"Comments")])],-1)),e("tbody",null,[(n(!0),a(w,null,T(j.value,l=>(n(),a("tr",{key:l.id},[e("td",Gs,[e("strong",null,i(l.name),1),l.studentNumber?(n(),a("span",Rs,i(l.studentNumber),1)):$("",!0)]),e("td",Ps,[f(e("input",{"onUpdate:modelValue":S=>b[l.studentId].score=S,type:"number",step:"0.01",onInput:S=>X(l.studentId)},null,40,qs),[[D,b[l.studentId].score,void 0,{number:!0}]])]),e("td",Ms,[f(e("input",{"onUpdate:modelValue":S=>b[l.studentId].maxScore=S,type:"number",step:"0.01",onInput:S=>X(l.studentId)},null,40,Xs),[[D,b[l.studentId].maxScore,void 0,{number:!0}]])]),e("td",Js,i(A(b[l.studentId].percentage)),1),e("td",Bs,i(b[l.studentId].letter||"â€”"),1),e("td",Hs,[f(e("input",{"onUpdate:modelValue":S=>b[l.studentId].comments=S,type:"text"},null,8,zs),[[D,b[l.studentId].comments,void 0,{trim:!0}]])])]))),128))])])]),e("div",Ks,[e("button",{type:"submit",class:"btn",disabled:U.value},"Save grades",8,Qs)])],32)):(n(),a("div",Vs," Create an assessment above to start recording grades. "))])])]))}},Ys={class:"card card--interactive"},Zs={class:"grid grid--three-column"},ea={class:"form__group"},ta=["value"],sa={class:"form__group"},aa=["value"],na={class:"form__actions align-end"},oa=["disabled"],la={class:"card__body"},ra={key:0,class:"muted"},da={key:1,class:"muted"},ia={key:0,class:"stack"},ua={class:"report-section__header"},ca={key:0,class:"muted"},pa={class:"table-responsive"},ma={class:"table"},va={"data-title":"Student"},_a={key:0,class:"badge badge--neutral"},ba={key:0,class:"badge"},ha={"data-title":"Overall"},fa={key:0,class:"badge"},ga={__name:"GradeReportApp",props:{report:{type:Object,default:()=>({summaries:[],filters:{classes:[],students:[]}})}},setup(E){var L,I,U,b,C,V,P,q,X;const _=E,u=B({summaries:((L=_.report)==null?void 0:L.summaries)??[],filters:{classes:((U=(I=_.report)==null?void 0:I.filters)==null?void 0:U.classes)??[],students:((C=(b=_.report)==null?void 0:b.filters)==null?void 0:C.students)??[]}}),j=B({classId:(P=(V=_.report)==null?void 0:V.filters)!=null&&P.classId?String(_.report.filters.classId):"",studentId:(X=(q=_.report)==null?void 0:q.filters)!=null&&X.studentId?String(_.report.filters.studentId):""}),N=k(!1);function M(A){return A==null?"â€”":`${Number(A).toFixed(2)}%`}function p(){j.classId="",j.studentId="",c()}async function c(){var A,g,y,x,O;N.value=!0;try{const R=new URLSearchParams;j.classId&&R.set("classId",j.classId),j.studentId&&R.set("studentId",j.studentId);const J=await fetch(`/reports/grades/data?${R.toString()}`);if(!J.ok)throw new Error("Failed to load report");const v=await J.json();u.summaries=((A=v.report)==null?void 0:A.summaries)??[],u.filters.classes=((y=(g=v.report)==null?void 0:g.filters)==null?void 0:y.classes)??u.filters.classes,u.filters.students=((O=(x=v.report)==null?void 0:x.filters)==null?void 0:O.students)??u.filters.students}catch(R){console.error(R)}finally{N.value=!1}}return(A,g)=>(n(),a("section",Ys,[g[8]||(g[8]=e("header",{class:"card__header"},[e("div",null,[e("h1",{class:"card__title"},"Grade reports"),e("p",{class:"card__subtitle"}," Review class and student averages across recorded assessments. ")])],-1)),e("form",{class:"form",onSubmit:K(c,["prevent"])},[e("div",Zs,[e("label",ea,[g[3]||(g[3]=e("span",null,"Class",-1)),f(e("select",{"onUpdate:modelValue":g[0]||(g[0]=y=>j.classId=y)},[g[2]||(g[2]=e("option",{value:""},"All classes",-1)),(n(!0),a(w,null,T(u.filters.classes,y=>(n(),a("option",{key:y.id,value:String(y.id)},i(y.name),9,ta))),128))],512),[[H,j.classId]])]),e("label",sa,[g[5]||(g[5]=e("span",null,"Student",-1)),f(e("select",{"onUpdate:modelValue":g[1]||(g[1]=y=>j.studentId=y)},[g[4]||(g[4]=e("option",{value:""},"All students",-1)),(n(!0),a(w,null,T(u.filters.students,y=>(n(),a("option",{key:y.id,value:String(y.id)},i(y.name),9,aa))),128))],512),[[H,j.studentId]])]),e("div",na,[e("button",{type:"submit",class:"btn",disabled:N.value},"Apply filters",8,oa),e("button",{type:"button",class:"btn btn--ghost",onClick:p},"Reset")])])],32),e("div",la,[N.value?(n(),a("p",ra,"Loading reportâ€¦")):u.summaries.length?$("",!0):(n(),a("p",da,"No grade data is available for the selected filters."))]),N.value?$("",!0):(n(),a("div",ia,[(n(!0),a(w,null,T(u.summaries,y=>(n(),a("section",{key:y.classId,class:"report-section"},[e("header",ua,[e("h2",null,i(y.className),1),y.gradeLevel?(n(),a("p",ca,"Grade level: "+i(y.gradeLevel),1)):$("",!0)]),e("div",pa,[e("table",ma,[e("thead",null,[e("tr",null,[g[6]||(g[6]=e("th",{scope:"col"},"Student",-1)),(n(!0),a(w,null,T(y.subjects,x=>(n(),a("th",{key:x.classSubjectId,scope:"col"},i(x.name),1))),128)),g[7]||(g[7]=e("th",{scope:"col"},"Overall",-1))])]),e("tbody",null,[(n(!0),a(w,null,T(y.students,x=>(n(),a("tr",{key:x.studentId},[e("td",va,[e("strong",null,i(x.name),1),x.studentNumber?(n(),a("span",_a,i(x.studentNumber),1)):$("",!0)]),(n(!0),a(w,null,T(y.subjects,O=>{var R,J;return n(),a("td",{key:O.classSubjectId,"data-title":"Subject"},[Y(i(M((R=x.subjectGrades[String(O.classSubjectId)])==null?void 0:R.percentage))+" ",1),(J=x.subjectGrades[String(O.classSubjectId)])!=null&&J.letterGrade?(n(),a("span",ba,i(x.subjectGrades[String(O.classSubjectId)].letterGrade),1)):$("",!0)])}),128)),e("td",ha,[Y(i(M(x.overall.percentage))+" ",1),x.overall.letterGrade?(n(),a("span",fa,i(x.overall.letterGrade),1)):$("",!0)])]))),128))])])])]))),128))]))]))}},se={ClassManagementApp:lt,ClassDetailApp:cs,GradeEntryApp:Ws,GradeReportApp:ga};function ya(E){if(!E)return{};const _=document.getElementById(E);if(!_)return{};try{return JSON.parse(_.textContent||"{}")}catch(u){return console.warn(`Unable to parse state for ${E}`,u),{}}}function Sa(E){const _=E.dataset.vueApp,u=se[_];if(!u)return;const j=ya(E.dataset.stateId);ae(u,j).mount(E)}document.querySelectorAll("[data-vue-app]").forEach(E=>{se[E.dataset.vueApp]&&Sa(E)});
//# sourceMappingURL=academic.js.map
