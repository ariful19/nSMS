import{_ as J,c as a,o as n,a as t,f as B,j as M,w as f,v as S,d as Y,F as I,r as R,t as s,b as K,n as G,h as x,g as d,i as D,m as U,k as W,e as Z,p as $}from"./chunks/sq-avatar-badge-CzDjdsqk.js";const tt={__name:"LibraryDashboardApp",props:{categories:{type:Array,default:()=>[]},books:{type:Array,default:()=>[]},recentLoans:{type:Array,default:()=>[]},csrfToken:{type:String,default:""}},setup(g,{expose:o}){o();const c=g,e=x(()=>c.categories??[]),A=d(""),k=d(""),r=d(!1),u=d(""),_=d(!1),h=d([]),T=d([]),w=d(!1),L=d(""),C=d(!1),v=D({title:"",author:"",isbn:"",categoryId:"",publishedYear:"",summary:""});U(()=>c.books,i=>{h.value=Array.isArray(i)?i:[]},{immediate:!0}),U(()=>c.recentLoans,i=>{T.value=Array.isArray(i)?i:[]},{immediate:!0});function E(i){const p=new Date(i);return Number.isNaN(p.getTime())?"—":p.toLocaleDateString()}async function b(){r.value=!0,u.value="";try{const i=new URLSearchParams;A.value&&i.set("term",A.value),k.value&&i.set("categoryId",String(k.value));const p=await fetch(`/library/api/books?${i.toString()}`);if(!p.ok)throw new Error(`Request failed with status ${p.status}`);const P=await p.json();h.value=Array.isArray(P.results)?P.results:[]}catch(i){console.error(i),u.value="Unable to load books. Please try again."}finally{r.value=!1}}function j(){A.value="",k.value="",h.value=Array.isArray(c.books)?c.books:[],u.value=""}function F(){w.value=!w.value}function O(){v.title="",v.author="",v.isbn="",v.categoryId="",v.publishedYear="",v.summary="",L.value=""}async function q(){if(!v.title){L.value="Title is required.";return}C.value=!0,L.value="";try{const i=await fetch("/library/books",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":c.csrfToken},body:JSON.stringify(v)});if(!i.ok){const p=await i.json().catch(()=>({error:""}));throw new Error(p.error||`Request failed with status ${i.status}`)}O(),w.value=!1,await b(),await V()}catch(i){console.error(i),L.value=i.message||"Unable to save book."}finally{C.value=!1}}async function V(){_.value=!0;try{const i=await fetch("/library/api/loans/recent?limit=10");if(!i.ok)throw new Error(`Request failed with status ${i.status}`);const p=await i.json();T.value=Array.isArray(p.loans)?p.loans:[]}catch(i){console.error(i)}finally{_.value=!1}}const m={props:c,categories:e,searchTerm:A,selectedCategory:k,isSearching:r,searchError:u,refreshingLoans:_,bookResults:h,recentLoans:T,showCreateForm:w,createError:L,isCreating:C,newBook:v,formatDate:E,loadBooks:b,resetSearch:j,toggleCreate:F,resetForm:O,submitBook:q,loadRecentLoans:V,computed:x,reactive:D,ref:d,watch:U};return Object.defineProperty(m,"__isScriptSetup",{enumerable:!1,value:!0}),m}},et={class:"card card--interactive"},ot={class:"grid grid--two-column"},rt={class:"card"},st={class:"form__group"},at={class:"form__group"},nt=["value"],lt={class:"form__actions"},it=["disabled"],dt=["disabled"],ct={key:0,class:"alert alert--danger"},ut={key:1,class:"table-responsive"},mt={class:"table"},bt={scope:"row"},_t=["href"],yt={key:2,class:"empty-state__title"},ft={class:"card"},pt={class:"card__header"},ht=["disabled"],vt={key:0,class:"table-responsive"},gt={class:"table"},kt={key:1,class:"empty-state__title"},St={class:"card"},wt={class:"card__header"},At={class:"grid grid--two-column"},Lt={class:"form__group"},Ct={class:"form__group"},Tt={class:"form__group"},Bt={class:"form__group"},It=["value"],Rt={class:"form__group"},Ut={class:"form__group form__group--full"},Et={key:0,class:"alert alert--danger"},Nt={class:"form__actions"},Vt=["disabled"],Ft=["disabled"],Ot={key:1,class:"empty-state__title"};function Dt(g,o,c,e,A,k){return n(),a("section",et,[o[23]||(o[23]=t("header",{class:"card__header"},[t("div",null,[t("h1",{class:"card__title"},"Library workspace"),t("p",{class:"card__subtitle"},"Search the catalog, review activity, and add new titles.")])],-1)),t("div",ot,[t("article",rt,[o[12]||(o[12]=t("header",{class:"card__header"},[t("div",null,[t("h2",{class:"card__title"},"Catalog search"),t("p",{class:"card__hint"},"Filter by keyword or category.")])],-1)),t("form",{class:"form",onSubmit:M(e.loadBooks,["prevent"])},[t("label",st,[o[8]||(o[8]=t("span",null,"Keywords",-1)),f(t("input",{"onUpdate:modelValue":o[0]||(o[0]=r=>e.searchTerm=r),type:"search",name:"term",class:"form__control",placeholder:"Title, author, or ISBN"},null,512),[[S,e.searchTerm,void 0,{trim:!0}]])]),t("label",at,[o[10]||(o[10]=t("span",null,"Category",-1)),f(t("select",{"onUpdate:modelValue":o[1]||(o[1]=r=>e.selectedCategory=r),class:"form__control"},[o[9]||(o[9]=t("option",{value:""},"All categories",-1)),(n(!0),a(I,null,R(e.categories,r=>(n(),a("option",{key:r.id,value:r.id},s(r.name),9,nt))),128))],512),[[Y,e.selectedCategory]])]),t("div",lt,[t("button",{type:"submit",class:"btn btn--primary",disabled:e.isSearching},s(e.isSearching?"Searching…":"Search"),9,it),t("button",{type:"button",class:"btn btn--ghost",onClick:e.resetSearch,disabled:e.isSearching}," Clear ",8,dt)])],32),e.searchError?(n(),a("div",ct,s(e.searchError),1)):B("",!0),e.bookResults.length?(n(),a("div",ut,[t("table",mt,[o[11]||(o[11]=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"Title"),t("th",{scope:"col"},"Author"),t("th",{scope:"col"},"Category"),t("th",{scope:"col"},"Available")])],-1)),t("tbody",null,[(n(!0),a(I,null,R(e.bookResults,r=>{var u;return n(),a("tr",{key:r.id},[t("th",bt,[t("a",{href:`/library/books/${r.id}`},s(r.title),9,_t)]),t("td",null,s(r.author||"—"),1),t("td",null,s(((u=r.category)==null?void 0:u.name)??"Uncategorized"),1),t("td",null,[t("strong",null,s(r.copySummary.available),1),K(" of "+s(r.copySummary.total),1)])])}),128))])])])):e.isSearching?B("",!0):(n(),a("p",yt,"No books matched your filters."))]),t("article",ft,[t("header",pt,[o[13]||(o[13]=t("div",null,[t("h2",{class:"card__title"},"Recent loan activity"),t("p",{class:"card__hint"},"Latest 10 check-outs and returns.")],-1)),t("button",{type:"button",class:"btn btn--ghost btn--small",onClick:e.loadRecentLoans,disabled:e.refreshingLoans},s(e.refreshingLoans?"Refreshing…":"Refresh"),9,ht)]),e.recentLoans.length?(n(),a("div",vt,[t("table",gt,[o[14]||(o[14]=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"Title"),t("th",{scope:"col"},"Borrower"),t("th",{scope:"col"},"Issued"),t("th",{scope:"col"},"Status")])],-1)),t("tbody",null,[(n(!0),a(I,null,R(e.recentLoans,r=>{var u,_;return n(),a("tr",{key:r.id},[t("td",null,s(((u=r.book)==null?void 0:u.title)??"—"),1),t("td",null,s(((_=r.student)==null?void 0:_.name)??"—"),1),t("td",null,s(e.formatDate(r.issuedAt)),1),t("td",null,[t("span",{class:G(["badge",r.returnedAt?"badge--success":"badge--info"])},s(r.returnedAt?`Returned ${e.formatDate(r.returnedAt)}`:r.dueAt?`Due ${e.formatDate(r.dueAt)}`:"On loan"),3)])])}),128))])])])):(n(),a("p",kt,"No recent loan records."))])]),t("article",St,[t("header",wt,[o[15]||(o[15]=t("div",null,[t("h2",{class:"card__title"},"Add a new book"),t("p",{class:"card__hint"},"Capture core metadata to grow the catalog.")],-1)),t("button",{type:"button",class:"btn btn--ghost btn--small",onClick:e.toggleCreate},s(e.showCreateForm?"Hide form":"Add book"),1)]),e.showCreateForm?(n(),a("form",{key:0,class:"form",onSubmit:M(e.submitBook,["prevent"])},[t("div",At,[t("label",Lt,[o[16]||(o[16]=t("span",null,"Title",-1)),f(t("input",{"onUpdate:modelValue":o[2]||(o[2]=r=>e.newBook.title=r),type:"text",required:"",class:"form__control"},null,512),[[S,e.newBook.title,void 0,{trim:!0}]])]),t("label",Ct,[o[17]||(o[17]=t("span",null,"Author",-1)),f(t("input",{"onUpdate:modelValue":o[3]||(o[3]=r=>e.newBook.author=r),type:"text",class:"form__control"},null,512),[[S,e.newBook.author,void 0,{trim:!0}]])]),t("label",Tt,[o[18]||(o[18]=t("span",null,"ISBN",-1)),f(t("input",{"onUpdate:modelValue":o[4]||(o[4]=r=>e.newBook.isbn=r),type:"text",class:"form__control"},null,512),[[S,e.newBook.isbn,void 0,{trim:!0}]])]),t("label",Bt,[o[20]||(o[20]=t("span",null,"Category",-1)),f(t("select",{"onUpdate:modelValue":o[5]||(o[5]=r=>e.newBook.categoryId=r),class:"form__control"},[o[19]||(o[19]=t("option",{value:""},"Select category",-1)),(n(!0),a(I,null,R(e.categories,r=>(n(),a("option",{key:r.id,value:r.id},s(r.name),9,It))),128))],512),[[Y,e.newBook.categoryId]])]),t("label",Rt,[o[21]||(o[21]=t("span",null,"Published year",-1)),f(t("input",{"onUpdate:modelValue":o[6]||(o[6]=r=>e.newBook.publishedYear=r),type:"number",min:"0",class:"form__control"},null,512),[[S,e.newBook.publishedYear,void 0,{trim:!0}]])]),t("label",Ut,[o[22]||(o[22]=t("span",null,"Summary",-1)),f(t("textarea",{"onUpdate:modelValue":o[7]||(o[7]=r=>e.newBook.summary=r),rows:"3",class:"form__control"},null,512),[[S,e.newBook.summary,void 0,{trim:!0}]])])]),e.createError?(n(),a("div",Et,s(e.createError),1)):B("",!0),t("div",Nt,[t("button",{type:"submit",class:"btn btn--primary",disabled:e.isCreating},s(e.isCreating?"Saving…":"Save book"),9,Vt),t("button",{type:"button",class:"btn btn--ghost",onClick:e.resetForm,disabled:e.isCreating}," Reset ",8,Ft)])],32)):(n(),a("p",Ot,"Use the button above to capture a new title."))])])}const xt=J(tt,[["render",Dt],["__file","/workspace/nSMS/src/client/library/components/LibraryDashboardApp.vue"]]),jt={__name:"LibraryLoanApp",props:{copies:{type:Array,default:()=>[]},csrfToken:{type:String,default:""},bookId:{type:Number,default:null},studentSearchEndpoint:{type:String,default:"/library/api/students"}},emits:["loan-issued"],setup(g,{expose:o,emit:c}){o();const e=g,A=c,k=d(""),r=d(""),u=d(null),_=d([]),h=d(!1),T=d(!1),w=d(""),L=d(""),C=d("");let v=null;const E=x(()=>(e.copies??[]).filter(m=>m.status==="AVAILABLE"));U(()=>e.copies,()=>{E.value.find(m=>m.id===Number(r.value))||(r.value="")});function b(){k.value="",r.value="",u.value=null,_.value=[],L.value="",C.value="",w.value=""}function j(){if(v&&window.clearTimeout(v),!k.value){_.value=[],u.value=null;return}v=window.setTimeout(F,250)}async function F(){if(k.value){h.value=!0;try{const m=new URLSearchParams({term:k.value}),i=await fetch(`${e.studentSearchEndpoint}?${m.toString()}`);if(!i.ok)throw new Error(`Request failed with status ${i.status}`);const p=await i.json();_.value=Array.isArray(p.results)?p.results:[]}catch(m){console.error(m),w.value="Unable to search for students."}finally{h.value=!1}}}function O(m){u.value=m,_.value=[],k.value=m.label}async function q(){if(!r.value||!u.value){w.value="Select a copy and borrower before recording the loan.";return}T.value=!0,w.value="";try{const m=await fetch("/library/loans",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":e.csrfToken},body:JSON.stringify({copyId:r.value,studentId:u.value.id,dueAt:L.value||void 0,bookId:e.bookId,notes:C.value||void 0})});if(!m.ok){const p=await m.json().catch(()=>({error:""}));throw new Error(p.error||`Request failed with status ${m.status}`)}const i=await m.json();A("loan-issued",i.loan),b()}catch(m){console.error(m),w.value=m.message||"Unable to record loan."}finally{T.value=!1}}const V={props:e,emit:A,searchTerm:k,selectedCopyId:r,selectedStudent:u,searchResults:_,isSearching:h,isSubmitting:T,error:w,dueAt:L,notes:C,get searchTimeout(){return v},set searchTimeout(m){v=m},availableCopies:E,resetForm:b,handleSearchInput:j,runSearch:F,selectStudent:O,submitLoan:q,computed:x,ref:d,watch:U};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}},qt={class:"card"},Mt={class:"form__group"},Yt=["value"],Pt={class:"form__group"},Jt={key:0,class:"list list--compact"},Xt=["onClick"],zt={class:"list__heading"},Ht={class:"list__description"},Kt={key:1,class:"alert alert--info"},Gt={class:"form__group"},Qt={class:"form__group"},Wt={key:2,class:"alert alert--danger"},Zt={class:"form__actions"},$t=["disabled"],te=["disabled"];function ee(g,o,c,e,A,k){return n(),a("section",qt,[o[11]||(o[11]=t("header",{class:"card__header"},[t("div",null,[t("h2",{class:"card__title"},"Issue a loan"),t("p",{class:"card__hint"},"Choose an available copy and borrower.")])],-1)),t("form",{class:"form",onSubmit:M(e.submitLoan,["prevent"])},[t("label",Mt,[o[5]||(o[5]=t("span",null,"Available copy",-1)),f(t("select",{"onUpdate:modelValue":o[0]||(o[0]=r=>e.selectedCopyId=r),class:"form__control",required:""},[o[4]||(o[4]=t("option",{value:""},"Select copy",-1)),(n(!0),a(I,null,R(e.availableCopies,r=>(n(),a("option",{key:r.id,value:r.id},s(r.barcode||r.id)+" — "+s(r.location||"No location"),9,Yt))),128))],512),[[Y,e.selectedCopyId]])]),t("label",Pt,[o[6]||(o[6]=t("span",null,"Borrower",-1)),f(t("input",{"onUpdate:modelValue":o[1]||(o[1]=r=>e.searchTerm=r),type:"search",class:"form__control",placeholder:"Search students by name or number",onInput:e.handleSearchInput},null,544),[[S,e.searchTerm,void 0,{trim:!0}]])]),e.searchResults.length?(n(),a("ul",Jt,[(n(!0),a(I,null,R(e.searchResults,r=>(n(),a("li",{key:r.id,class:"list__option",onClick:u=>e.selectStudent(r)},[t("div",null,[t("div",zt,s(r.label),1),t("div",Ht,s(r.studentNumber||"No number"),1)]),o[7]||(o[7]=t("button",{type:"button",class:"btn btn--ghost btn--small"},"Select",-1))],8,Xt))),128))])):B("",!0),e.selectedStudent?(n(),a("p",Kt,[o[8]||(o[8]=K(" Selected: ",-1)),t("strong",null,s(e.selectedStudent.label),1)])):B("",!0),t("label",Gt,[o[9]||(o[9]=t("span",null,"Due date",-1)),f(t("input",{"onUpdate:modelValue":o[2]||(o[2]=r=>e.dueAt=r),type:"date",class:"form__control"},null,512),[[S,e.dueAt]])]),t("label",Qt,[o[10]||(o[10]=t("span",null,"Notes",-1)),f(t("textarea",{"onUpdate:modelValue":o[3]||(o[3]=r=>e.notes=r),rows:"2",class:"form__control",placeholder:"Optional"},null,512),[[S,e.notes,void 0,{trim:!0}]])]),e.error?(n(),a("div",Wt,s(e.error),1)):B("",!0),t("div",Zt,[t("button",{type:"submit",class:"btn btn--primary",disabled:e.isSubmitting},s(e.isSubmitting?"Saving…":"Record loan"),9,$t),t("button",{type:"button",class:"btn btn--ghost",onClick:e.resetForm,disabled:e.isSubmitting}," Clear ",8,te)])],32)])}const Q=J(jt,[["render",ee],["__file","/workspace/nSMS/src/client/library/components/LibraryLoanApp.vue"]]),oe={__name:"LibraryBookApp",props:{book:{type:Object,default:()=>({})},activeLoans:{type:Array,default:()=>[]},recentLoans:{type:Array,default:()=>[]},categories:{type:Array,default:()=>[]},csrfToken:{type:String,default:""}},setup(g,{expose:o}){var z,H;o();const c=g,e=D({...c.book,copies:((z=c.book)==null?void 0:z.copies)??[]}),A=d([...c.activeLoans]),k=d([...c.recentLoans]),r=d(!1),u=d(""),_=d(""),h=D({barcode:"",location:"",status:"AVAILABLE",acquiredAt:""}),T=d(!1),w=d(""),L=d(""),C=d(""),v=d(null),E=d(!1),b=D({id:e.id,title:e.title||"",author:e.author||"",isbn:e.isbn||"",categoryId:((H=e.category)==null?void 0:H.id)||"",publishedYear:e.publishedYear?String(e.publishedYear):"",summary:e.summary||"",isArchived:!!e.isArchived});U(()=>c.book,l=>{var y;Object.assign(e,l||{}),l!=null&&l.copies&&(e.copies=l.copies),b.id=e.id,b.title=e.title||"",b.author=e.author||"",b.isbn=e.isbn||"",b.categoryId=((y=e.category)==null?void 0:y.id)||"",b.publishedYear=e.publishedYear?String(e.publishedYear):"",b.summary=e.summary||"",b.isArchived=!!e.isArchived}),U(()=>c.activeLoans,l=>{A.value=Array.isArray(l)?[...l]:[]}),U(()=>c.recentLoans,l=>{k.value=Array.isArray(l)?[...l]:[]});const j=x(()=>c.categories??[]);function F(){var l;b.title=e.title||"",b.author=e.author||"",b.isbn=e.isbn||"",b.categoryId=((l=e.category)==null?void 0:l.id)||"",b.publishedYear=e.publishedYear?String(e.publishedYear):"",b.summary=e.summary||"",b.isArchived=!!e.isArchived,u.value="",_.value=""}function O(l){if(!l)return"—";const y=new Date(l);return Number.isNaN(y.getTime())?"—":y.toLocaleDateString()}async function q(){if(!b.title){u.value="Title is required.";return}r.value=!0,u.value="",_.value="";try{const l=await fetch(`/library/books/${e.id}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":c.csrfToken},body:JSON.stringify(b)});if(!l.ok){const y=await l.json().catch(()=>({error:""}));throw new Error(y.error||`Request failed with status ${l.status}`)}_.value="Book updated successfully.",await p()}catch(l){console.error(l),u.value=l.message||"Unable to update book."}finally{r.value=!1}}async function V(){T.value=!0,w.value="",L.value="";try{const l=await fetch(`/library/books/${e.id}/copies`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":c.csrfToken},body:JSON.stringify(h)});if(!l.ok){const y=await l.json().catch(()=>({error:""}));throw new Error(y.error||`Request failed with status ${l.status}`)}L.value="Copy added successfully.",m(),await p()}catch(l){console.error(l),w.value=l.message||"Unable to add copy."}finally{T.value=!1}}function m(){h.barcode="",h.location="",h.status="AVAILABLE",h.acquiredAt=""}async function i(l){v.value=l.id,C.value="";try{const y=await fetch(`/library/loans/${l.id}/return`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":c.csrfToken},body:JSON.stringify({returnedAt:new Date().toISOString()})});if(!y.ok){const N=await y.json().catch(()=>({error:""}));throw new Error(N.error||`Request failed with status ${y.status}`)}await p()}catch(y){console.error(y),C.value=y.message||"Unable to mark loan as returned."}finally{v.value=null}}async function p(){var l;E.value=!0,C.value="";try{const y=await fetch(`/library/books/${e.id}`,{headers:{Accept:"application/json"}});if(!y.ok)throw new Error(`Request failed with status ${y.status}`);const N=await y.json();Object.assign(e,N.book||{}),e.copies=((l=N.book)==null?void 0:l.copies)??[],A.value=Array.isArray(N.activeLoans)?N.activeLoans:[],k.value=Array.isArray(N.recentLoans)?N.recentLoans:[]}catch(y){console.error(y),C.value=y.message||"Unable to refresh book details."}finally{E.value=!1}}async function P(){await p()}const X={props:c,bookState:e,activeLoanList:A,recentLoanList:k,isSaving:r,formError:u,formMessage:_,copyForm:h,copySubmitting:T,copyError:w,copyMessage:L,loanError:C,returningLoanId:v,isRefreshing:E,form:b,categories:j,resetForm:F,formatDate:O,saveBook:q,addCopy:V,resetCopyForm:m,returnLoan:i,refreshState:p,handleLoanIssued:P,computed:x,reactive:D,ref:d,watch:U,LibraryLoanApp:Q};return Object.defineProperty(X,"__isScriptSetup",{enumerable:!1,value:!0}),X}},re={class:"grid grid--two-column"},se={class:"card card--interactive"},ae={class:"card__header"},ne={class:"card__title"},le={class:"grid grid--two-column"},ie={class:"form__group"},de={class:"form__group"},ce={class:"form__group"},ue={class:"form__group"},me=["value"],be={class:"form__group"},_e={class:"form__group form__group--full"},ye={class:"form__group form__group--checkbox"},fe={key:0,class:"alert alert--danger"},pe={key:1,class:"alert alert--success"},he={class:"form__actions"},ve=["disabled"],ge=["disabled"],ke={class:"card"},Se={key:0,class:"table-responsive"},we={class:"table"},Ae={key:1,class:"empty-state__title"},Le={class:"card"},Ce={class:"grid grid--two-column"},Te={class:"form__group"},Be={class:"form__group"},Ie={class:"form__group"},Re={class:"form__group"},Ue={key:0,class:"alert alert--danger"},Ee={key:1,class:"alert alert--success"},Ne={class:"form__actions"},Ve=["disabled"],Fe=["disabled"],Oe={class:"card"},De={key:0,class:"table-responsive"},xe={class:"table"},je=["onClick","disabled"],qe={key:1,class:"empty-state__title"},Me={key:2,class:"alert alert--danger"},Ye={class:"card"},Pe={class:"card__header"},Je=["disabled"],Xe={key:0,class:"table-responsive"},ze={class:"table"},He={key:1,class:"empty-state__title"};function Ke(g,o,c,e,A,k){return n(),a("section",re,[t("article",se,[t("header",ae,[t("div",null,[t("h1",ne,s(e.form.title||"Untitled book"),1),o[11]||(o[11]=t("p",{class:"card__hint"},"Update book metadata to keep the catalog current.",-1))])]),t("form",{class:"form",onSubmit:M(e.saveBook,["prevent"])},[t("div",le,[t("label",ie,[o[12]||(o[12]=t("span",null,"Title",-1)),f(t("input",{"onUpdate:modelValue":o[0]||(o[0]=r=>e.form.title=r),type:"text",required:"",class:"form__control"},null,512),[[S,e.form.title,void 0,{trim:!0}]])]),t("label",de,[o[13]||(o[13]=t("span",null,"Author",-1)),f(t("input",{"onUpdate:modelValue":o[1]||(o[1]=r=>e.form.author=r),type:"text",class:"form__control"},null,512),[[S,e.form.author,void 0,{trim:!0}]])]),t("label",ce,[o[14]||(o[14]=t("span",null,"ISBN",-1)),f(t("input",{"onUpdate:modelValue":o[2]||(o[2]=r=>e.form.isbn=r),type:"text",class:"form__control"},null,512),[[S,e.form.isbn,void 0,{trim:!0}]])]),t("label",ue,[o[16]||(o[16]=t("span",null,"Category",-1)),f(t("select",{"onUpdate:modelValue":o[3]||(o[3]=r=>e.form.categoryId=r),class:"form__control"},[o[15]||(o[15]=t("option",{value:""},"Uncategorized",-1)),(n(!0),a(I,null,R(e.categories,r=>(n(),a("option",{key:r.id,value:r.id},s(r.name),9,me))),128))],512),[[Y,e.form.categoryId]])]),t("label",be,[o[17]||(o[17]=t("span",null,"Published year",-1)),f(t("input",{"onUpdate:modelValue":o[4]||(o[4]=r=>e.form.publishedYear=r),type:"number",min:"0",class:"form__control"},null,512),[[S,e.form.publishedYear,void 0,{trim:!0}]])]),t("label",_e,[o[18]||(o[18]=t("span",null,"Summary",-1)),f(t("textarea",{"onUpdate:modelValue":o[5]||(o[5]=r=>e.form.summary=r),rows:"3",class:"form__control"},null,512),[[S,e.form.summary,void 0,{trim:!0}]])])]),t("label",ye,[f(t("input",{"onUpdate:modelValue":o[6]||(o[6]=r=>e.form.isArchived=r),type:"checkbox"},null,512),[[Z,e.form.isArchived]]),o[19]||(o[19]=t("span",null,"Archive this title",-1))]),e.formError?(n(),a("div",fe,s(e.formError),1)):B("",!0),e.formMessage?(n(),a("div",pe,s(e.formMessage),1)):B("",!0),t("div",he,[t("button",{type:"submit",class:"btn btn--primary",disabled:e.isSaving},s(e.isSaving?"Saving…":"Save changes"),9,ve),t("button",{type:"button",class:"btn btn--ghost",onClick:e.resetForm,disabled:e.isSaving}," Reset ",8,ge)])],32)]),W(e.LibraryLoanApp,{copies:e.bookState.copies,"csrf-token":c.csrfToken,"book-id":e.bookState.id,onLoanIssued:e.handleLoanIssued},null,8,["copies","csrf-token","book-id"]),t("article",ke,[o[21]||(o[21]=t("header",{class:"card__header"},[t("div",null,[t("h2",{class:"card__title"},"Copy inventory"),t("p",{class:"card__hint"},"Track each barcode assigned to this title.")])],-1)),e.bookState.copies.length?(n(),a("div",Se,[t("table",we,[o[20]||(o[20]=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"Barcode"),t("th",{scope:"col"},"Location"),t("th",{scope:"col"},"Status")])],-1)),t("tbody",null,[(n(!0),a(I,null,R(e.bookState.copies,r=>(n(),a("tr",{key:r.id},[t("td",null,s(r.barcode||r.id),1),t("td",null,s(r.location||"—"),1),t("td",null,s(r.status),1)]))),128))])])])):(n(),a("p",Ae,"No copies recorded."))]),t("article",Le,[o[27]||(o[27]=t("header",{class:"card__header"},[t("div",null,[t("h2",{class:"card__title"},"Add a copy"),t("p",{class:"card__hint"},"Register additional barcodes for circulation.")])],-1)),t("form",{class:"form",onSubmit:M(e.addCopy,["prevent"])},[t("div",Ce,[t("label",Te,[o[22]||(o[22]=t("span",null,"Barcode",-1)),f(t("input",{"onUpdate:modelValue":o[7]||(o[7]=r=>e.copyForm.barcode=r),type:"text",class:"form__control",placeholder:"Optional"},null,512),[[S,e.copyForm.barcode,void 0,{trim:!0}]])]),t("label",Be,[o[23]||(o[23]=t("span",null,"Location",-1)),f(t("input",{"onUpdate:modelValue":o[8]||(o[8]=r=>e.copyForm.location=r),type:"text",class:"form__control"},null,512),[[S,e.copyForm.location,void 0,{trim:!0}]])]),t("label",Ie,[o[25]||(o[25]=t("span",null,"Status",-1)),f(t("select",{"onUpdate:modelValue":o[9]||(o[9]=r=>e.copyForm.status=r),class:"form__control"},[...o[24]||(o[24]=[t("option",{value:"AVAILABLE"},"Available",-1),t("option",{value:"LOANED"},"On loan",-1),t("option",{value:"MAINTENANCE"},"Maintenance",-1),t("option",{value:"LOST"},"Lost",-1)])],512),[[Y,e.copyForm.status]])]),t("label",Re,[o[26]||(o[26]=t("span",null,"Acquired date",-1)),f(t("input",{"onUpdate:modelValue":o[10]||(o[10]=r=>e.copyForm.acquiredAt=r),type:"date",class:"form__control"},null,512),[[S,e.copyForm.acquiredAt]])])]),e.copyError?(n(),a("div",Ue,s(e.copyError),1)):B("",!0),e.copyMessage?(n(),a("div",Ee,s(e.copyMessage),1)):B("",!0),t("div",Ne,[t("button",{type:"submit",class:"btn btn--primary",disabled:e.copySubmitting},s(e.copySubmitting?"Saving…":"Add copy"),9,Ve),t("button",{type:"button",class:"btn btn--ghost",onClick:e.resetCopyForm,disabled:e.copySubmitting}," Reset ",8,Fe)])],32)]),t("article",Oe,[o[29]||(o[29]=t("header",{class:"card__header"},[t("div",null,[t("h2",{class:"card__title"},"Active loans"),t("p",{class:"card__hint"},"Close out loans when items are returned.")])],-1)),e.activeLoanList.length?(n(),a("div",De,[t("table",xe,[o[28]||(o[28]=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"Copy"),t("th",{scope:"col"},"Borrower"),t("th",{scope:"col"},"Issued"),t("th",{scope:"col"},"Due"),t("th",{scope:"col"},"Action")])],-1)),t("tbody",null,[(n(!0),a(I,null,R(e.activeLoanList,r=>{var u,_,h;return n(),a("tr",{key:r.id},[t("td",null,s(((u=r.copy)==null?void 0:u.barcode)||((_=r.copy)==null?void 0:_.id)||"—"),1),t("td",null,s(((h=r.student)==null?void 0:h.name)||"—"),1),t("td",null,s(e.formatDate(r.issuedAt)),1),t("td",null,s(e.formatDate(r.dueAt)),1),t("td",null,[t("button",{type:"button",class:"btn btn--ghost btn--small",onClick:T=>e.returnLoan(r),disabled:e.returningLoanId===r.id},s(e.returningLoanId===r.id?"Saving…":"Mark returned"),9,je)])])}),128))])])])):(n(),a("p",qe,"No active loans recorded.")),e.loanError?(n(),a("div",Me,s(e.loanError),1)):B("",!0)]),t("article",Ye,[t("header",Pe,[o[30]||(o[30]=t("div",null,[t("h2",{class:"card__title"},"Recent activity"),t("p",{class:"card__hint"},"Chronological list of loan events for this title.")],-1)),t("button",{type:"button",class:"btn btn--ghost btn--small",onClick:e.refreshState,disabled:e.isRefreshing},s(e.isRefreshing?"Refreshing…":"Refresh"),9,Je)]),e.recentLoanList.length?(n(),a("div",Xe,[t("table",ze,[o[31]||(o[31]=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"Copy"),t("th",{scope:"col"},"Borrower"),t("th",{scope:"col"},"Issued"),t("th",{scope:"col"},"Status")])],-1)),t("tbody",null,[(n(!0),a(I,null,R(e.recentLoanList,r=>{var u,_,h;return n(),a("tr",{key:r.id},[t("td",null,s(((u=r.copy)==null?void 0:u.barcode)||((_=r.copy)==null?void 0:_.id)||"—"),1),t("td",null,s(((h=r.student)==null?void 0:h.name)||"—"),1),t("td",null,s(e.formatDate(r.issuedAt)),1),t("td",null,[t("span",{class:G(["badge",r.returnedAt?"badge--success":"badge--info"])},s(r.returnedAt?`Returned ${e.formatDate(r.returnedAt)}`:r.dueAt?`Due ${e.formatDate(r.dueAt)}`:"On loan"),3)])])}),128))])])])):(n(),a("p",He,"No historical activity yet."))])])}const Ge=J(oe,[["render",Ke],["__file","/workspace/nSMS/src/client/library/components/LibraryBookApp.vue"]]),Qe={LibraryDashboardApp:xt,LibraryBookApp:Ge,LibraryLoanApp:Q};function We(g){if(!g)return{};const o=document.getElementById(g);if(!o)return{};try{return JSON.parse(o.textContent||"{}")}catch(c){return console.warn(`Unable to parse state for ${g}`,c),{}}}function Ze(g){const o=g.dataset.vueApp,c=Qe[o];if(!c)return;const e=We(g.dataset.stateId);$(c,e).mount(g)}Array.from(document.querySelectorAll('[data-vue-app^="Library"]')).forEach(g=>Ze(g));
//# sourceMappingURL=library.js.map
