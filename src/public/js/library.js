import{c as X,r as p,j as J,k as B,a as i,o as u,b as t,h as N,i as M,w as _,v as S,e as P,F as R,f as V,t as n,d as H,n as K,l as Q,g as W,p as Z}from"./chunks/sq-avatar-badge-iwxELXVT.js";const tt={class:"card card--interactive"},et={class:"grid grid--two-column"},st={class:"card"},ot={class:"form__group"},at={class:"form__group"},lt=["value"],rt={class:"form__actions"},nt=["disabled"],it=["disabled"],ut={key:0,class:"alert alert--danger"},dt={key:1,class:"table-responsive"},ct={class:"table"},pt={scope:"row"},bt=["href"],vt={key:2,class:"empty-state__title"},mt={class:"card"},_t={class:"card__header"},yt=["disabled"],ft={key:0,class:"table-responsive"},ht={class:"table"},gt={key:1,class:"empty-state__title"},kt={class:"card"},At={class:"card__header"},wt={class:"grid grid--two-column"},St={class:"form__group"},$t={class:"form__group"},Ct={class:"form__group"},Lt={class:"form__group"},Tt=["value"],Ut={class:"form__group"},Nt={class:"form__group form__group--full"},It={key:0,class:"alert alert--danger"},Rt={class:"form__actions"},Vt=["disabled"],Et=["disabled"],Bt={key:1,class:"empty-state__title"},Ot={__name:"LibraryDashboardApp",props:{categories:{type:Array,default:()=>[]},books:{type:Array,default:()=>[]},recentLoans:{type:Array,default:()=>[]},csrfToken:{type:String,default:""}},setup($){const v=$,l=X(()=>v.categories??[]),T=p(""),g=p(""),f=p(!1),h=p(""),A=p(!1),y=p([]),C=p([]),k=p(!1),L=p(""),w=p(!1),b=J({title:"",author:"",isbn:"",categoryId:"",publishedYear:"",summary:""});B(()=>v.books,o=>{y.value=Array.isArray(o)?o:[]},{immediate:!0}),B(()=>v.recentLoans,o=>{C.value=Array.isArray(o)?o:[]},{immediate:!0});function U(o){const s=new Date(o);return Number.isNaN(s.getTime())?"—":s.toLocaleDateString()}async function d(){f.value=!0,h.value="";try{const o=new URLSearchParams;T.value&&o.set("term",T.value),g.value&&o.set("categoryId",String(g.value));const s=await fetch(`/library/api/books?${o.toString()}`);if(!s.ok)throw new Error(`Request failed with status ${s.status}`);const r=await s.json();y.value=Array.isArray(r.results)?r.results:[]}catch(o){console.error(o),h.value="Unable to load books. Please try again."}finally{f.value=!1}}function O(){T.value="",g.value="",y.value=Array.isArray(v.books)?v.books:[],h.value=""}function j(){k.value=!k.value}function I(){b.title="",b.author="",b.isbn="",b.categoryId="",b.publishedYear="",b.summary="",L.value=""}async function q(){if(!b.title){L.value="Title is required.";return}w.value=!0,L.value="";try{const o=await fetch("/library/books",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":v.csrfToken},body:JSON.stringify(b)});if(!o.ok){const s=await o.json().catch(()=>({error:""}));throw new Error(s.error||`Request failed with status ${o.status}`)}I(),k.value=!1,await d(),await m()}catch(o){console.error(o),L.value=o.message||"Unable to save book."}finally{w.value=!1}}async function m(){A.value=!0;try{const o=await fetch("/library/api/loans/recent?limit=10");if(!o.ok)throw new Error(`Request failed with status ${o.status}`);const s=await o.json();C.value=Array.isArray(s.loans)?s.loans:[]}catch(o){console.error(o)}finally{A.value=!1}}return(o,s)=>(u(),i("section",tt,[s[23]||(s[23]=t("header",{class:"card__header"},[t("div",null,[t("h1",{class:"card__title"},"Library workspace"),t("p",{class:"card__subtitle"},"Search the catalog, review activity, and add new titles.")])],-1)),t("div",et,[t("article",st,[s[12]||(s[12]=t("header",{class:"card__header"},[t("div",null,[t("h2",{class:"card__title"},"Catalog search"),t("p",{class:"card__hint"},"Filter by keyword or category.")])],-1)),t("form",{class:"form",onSubmit:M(d,["prevent"])},[t("label",ot,[s[8]||(s[8]=t("span",null,"Keywords",-1)),_(t("input",{"onUpdate:modelValue":s[0]||(s[0]=r=>T.value=r),type:"search",name:"term",class:"form__control",placeholder:"Title, author, or ISBN"},null,512),[[S,T.value,void 0,{trim:!0}]])]),t("label",at,[s[10]||(s[10]=t("span",null,"Category",-1)),_(t("select",{"onUpdate:modelValue":s[1]||(s[1]=r=>g.value=r),class:"form__control"},[s[9]||(s[9]=t("option",{value:""},"All categories",-1)),(u(!0),i(R,null,V(l.value,r=>(u(),i("option",{key:r.id,value:r.id},n(r.name),9,lt))),128))],512),[[P,g.value]])]),t("div",rt,[t("button",{type:"submit",class:"btn btn--primary",disabled:f.value},n(f.value?"Searching…":"Search"),9,nt),t("button",{type:"button",class:"btn btn--ghost",onClick:O,disabled:f.value}," Clear ",8,it)])],32),h.value?(u(),i("div",ut,n(h.value),1)):N("",!0),y.value.length?(u(),i("div",dt,[t("table",ct,[s[11]||(s[11]=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"Title"),t("th",{scope:"col"},"Author"),t("th",{scope:"col"},"Category"),t("th",{scope:"col"},"Available")])],-1)),t("tbody",null,[(u(!0),i(R,null,V(y.value,r=>{var E;return u(),i("tr",{key:r.id},[t("th",pt,[t("a",{href:`/library/books/${r.id}`},n(r.title),9,bt)]),t("td",null,n(r.author||"—"),1),t("td",null,n(((E=r.category)==null?void 0:E.name)??"Uncategorized"),1),t("td",null,[t("strong",null,n(r.copySummary.available),1),H(" of "+n(r.copySummary.total),1)])])}),128))])])])):f.value?N("",!0):(u(),i("p",vt,"No books matched your filters."))]),t("article",mt,[t("header",_t,[s[13]||(s[13]=t("div",null,[t("h2",{class:"card__title"},"Recent loan activity"),t("p",{class:"card__hint"},"Latest 10 check-outs and returns.")],-1)),t("button",{type:"button",class:"btn btn--ghost btn--small",onClick:m,disabled:A.value},n(A.value?"Refreshing…":"Refresh"),9,yt)]),C.value.length?(u(),i("div",ft,[t("table",ht,[s[14]||(s[14]=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"Title"),t("th",{scope:"col"},"Borrower"),t("th",{scope:"col"},"Issued"),t("th",{scope:"col"},"Status")])],-1)),t("tbody",null,[(u(!0),i(R,null,V(C.value,r=>{var E,x;return u(),i("tr",{key:r.id},[t("td",null,n(((E=r.book)==null?void 0:E.title)??"—"),1),t("td",null,n(((x=r.student)==null?void 0:x.name)??"—"),1),t("td",null,n(U(r.issuedAt)),1),t("td",null,[t("span",{class:K(["badge",r.returnedAt?"badge--success":"badge--info"])},n(r.returnedAt?`Returned ${U(r.returnedAt)}`:r.dueAt?`Due ${U(r.dueAt)}`:"On loan"),3)])])}),128))])])])):(u(),i("p",gt,"No recent loan records."))])]),t("article",kt,[t("header",At,[s[15]||(s[15]=t("div",null,[t("h2",{class:"card__title"},"Add a new book"),t("p",{class:"card__hint"},"Capture core metadata to grow the catalog.")],-1)),t("button",{type:"button",class:"btn btn--ghost btn--small",onClick:j},n(k.value?"Hide form":"Add book"),1)]),k.value?(u(),i("form",{key:0,class:"form",onSubmit:M(q,["prevent"])},[t("div",wt,[t("label",St,[s[16]||(s[16]=t("span",null,"Title",-1)),_(t("input",{"onUpdate:modelValue":s[2]||(s[2]=r=>b.title=r),type:"text",required:"",class:"form__control"},null,512),[[S,b.title,void 0,{trim:!0}]])]),t("label",$t,[s[17]||(s[17]=t("span",null,"Author",-1)),_(t("input",{"onUpdate:modelValue":s[3]||(s[3]=r=>b.author=r),type:"text",class:"form__control"},null,512),[[S,b.author,void 0,{trim:!0}]])]),t("label",Ct,[s[18]||(s[18]=t("span",null,"ISBN",-1)),_(t("input",{"onUpdate:modelValue":s[4]||(s[4]=r=>b.isbn=r),type:"text",class:"form__control"},null,512),[[S,b.isbn,void 0,{trim:!0}]])]),t("label",Lt,[s[20]||(s[20]=t("span",null,"Category",-1)),_(t("select",{"onUpdate:modelValue":s[5]||(s[5]=r=>b.categoryId=r),class:"form__control"},[s[19]||(s[19]=t("option",{value:""},"Select category",-1)),(u(!0),i(R,null,V(l.value,r=>(u(),i("option",{key:r.id,value:r.id},n(r.name),9,Tt))),128))],512),[[P,b.categoryId]])]),t("label",Ut,[s[21]||(s[21]=t("span",null,"Published year",-1)),_(t("input",{"onUpdate:modelValue":s[6]||(s[6]=r=>b.publishedYear=r),type:"number",min:"0",class:"form__control"},null,512),[[S,b.publishedYear,void 0,{trim:!0}]])]),t("label",Nt,[s[22]||(s[22]=t("span",null,"Summary",-1)),_(t("textarea",{"onUpdate:modelValue":s[7]||(s[7]=r=>b.summary=r),rows:"3",class:"form__control"},null,512),[[S,b.summary,void 0,{trim:!0}]])])]),L.value?(u(),i("div",It,n(L.value),1)):N("",!0),t("div",Rt,[t("button",{type:"submit",class:"btn btn--primary",disabled:w.value},n(w.value?"Saving…":"Save book"),9,Vt),t("button",{type:"button",class:"btn btn--ghost",onClick:I,disabled:w.value}," Reset ",8,Et)])],32)):(u(),i("p",Bt,"Use the button above to capture a new title."))])]))}},jt={class:"card"},qt={class:"form__group"},xt=["value"],Dt={class:"form__group"},Yt={key:0,class:"list list--compact"},Ft=["onClick"],Mt={class:"list__heading"},Pt={class:"list__description"},Jt={key:1,class:"alert alert--info"},Xt={class:"form__group"},zt={class:"form__group"},Ht={key:2,class:"alert alert--danger"},Kt={class:"form__actions"},Gt=["disabled"],Qt=["disabled"],G={__name:"LibraryLoanApp",props:{copies:{type:Array,default:()=>[]},csrfToken:{type:String,default:""},bookId:{type:Number,default:null},studentSearchEndpoint:{type:String,default:"/library/api/students"}},emits:["loan-issued"],setup($,{emit:v}){const l=$,T=v,g=p(""),f=p(""),h=p(null),A=p([]),y=p(!1),C=p(!1),k=p(""),L=p(""),w=p("");let b=null;const U=X(()=>(l.copies??[]).filter(m=>m.status==="AVAILABLE"));B(()=>l.copies,()=>{U.value.find(m=>m.id===Number(f.value))||(f.value="")});function d(){g.value="",f.value="",h.value=null,A.value=[],L.value="",w.value="",k.value=""}function O(){if(b&&window.clearTimeout(b),!g.value){A.value=[],h.value=null;return}b=window.setTimeout(j,250)}async function j(){if(g.value){y.value=!0;try{const m=new URLSearchParams({term:g.value}),o=await fetch(`${l.studentSearchEndpoint}?${m.toString()}`);if(!o.ok)throw new Error(`Request failed with status ${o.status}`);const s=await o.json();A.value=Array.isArray(s.results)?s.results:[]}catch(m){console.error(m),k.value="Unable to search for students."}finally{y.value=!1}}}function I(m){h.value=m,A.value=[],g.value=m.label}async function q(){if(!f.value||!h.value){k.value="Select a copy and borrower before recording the loan.";return}C.value=!0,k.value="";try{const m=await fetch("/library/loans",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-CSRF-Token":l.csrfToken},body:JSON.stringify({copyId:f.value,studentId:h.value.id,dueAt:L.value||void 0,bookId:l.bookId,notes:w.value||void 0})});let o=null;try{o=await m.json()}catch{o=null}if(!m.ok){const s=(o==null?void 0:o.error)||`Request failed with status ${m.status}`;throw new Error(s)}if(!o||typeof o!="object")throw new Error("Invalid response received from server.");T("loan-issued",o.loan),d()}catch(m){console.error(m),k.value=m.message||"Unable to record loan."}finally{C.value=!1}}return(m,o)=>(u(),i("section",jt,[o[11]||(o[11]=t("header",{class:"card__header"},[t("div",null,[t("h2",{class:"card__title"},"Issue a loan"),t("p",{class:"card__hint"},"Choose an available copy and borrower.")])],-1)),t("form",{class:"form",onSubmit:M(q,["prevent"])},[t("label",qt,[o[5]||(o[5]=t("span",null,"Available copy",-1)),_(t("select",{"onUpdate:modelValue":o[0]||(o[0]=s=>f.value=s),class:"form__control",required:""},[o[4]||(o[4]=t("option",{value:""},"Select copy",-1)),(u(!0),i(R,null,V(U.value,s=>(u(),i("option",{key:s.id,value:s.id},n(s.barcode||s.id)+" — "+n(s.location||"No location"),9,xt))),128))],512),[[P,f.value]])]),t("label",Dt,[o[6]||(o[6]=t("span",null,"Borrower",-1)),_(t("input",{"onUpdate:modelValue":o[1]||(o[1]=s=>g.value=s),type:"search",class:"form__control",placeholder:"Search students by name or number",onInput:O},null,544),[[S,g.value,void 0,{trim:!0}]])]),A.value.length?(u(),i("ul",Yt,[(u(!0),i(R,null,V(A.value,s=>(u(),i("li",{key:s.id,class:"list__option",onClick:r=>I(s)},[t("div",null,[t("div",Mt,n(s.label),1),t("div",Pt,n(s.studentNumber||"No number"),1)]),o[7]||(o[7]=t("button",{type:"button",class:"btn btn--ghost btn--small"},"Select",-1))],8,Ft))),128))])):N("",!0),h.value?(u(),i("p",Jt,[o[8]||(o[8]=H(" Selected: ",-1)),t("strong",null,n(h.value.label),1)])):N("",!0),t("label",Xt,[o[9]||(o[9]=t("span",null,"Due date",-1)),_(t("input",{"onUpdate:modelValue":o[2]||(o[2]=s=>L.value=s),type:"date",class:"form__control"},null,512),[[S,L.value]])]),t("label",zt,[o[10]||(o[10]=t("span",null,"Notes",-1)),_(t("textarea",{"onUpdate:modelValue":o[3]||(o[3]=s=>w.value=s),rows:"2",class:"form__control",placeholder:"Optional"},null,512),[[S,w.value,void 0,{trim:!0}]])]),k.value?(u(),i("div",Ht,n(k.value),1)):N("",!0),t("div",Kt,[t("button",{type:"submit",class:"btn btn--primary",disabled:C.value},n(C.value?"Saving…":"Record loan"),9,Gt),t("button",{type:"button",class:"btn btn--ghost",onClick:d,disabled:C.value}," Clear ",8,Qt)])],32)]))}},Wt={class:"grid grid--two-column"},Zt={class:"card card--interactive"},te={class:"card__header"},ee={class:"card__title"},se={class:"grid grid--two-column"},oe={class:"form__group"},ae={class:"form__group"},le={class:"form__group"},re={class:"form__group"},ne=["value"],ie={class:"form__group"},ue={class:"form__group form__group--full"},de={class:"form__group form__group--checkbox"},ce={key:0,class:"alert alert--danger"},pe={key:1,class:"alert alert--success"},be={class:"form__actions"},ve=["disabled"],me=["disabled"],_e={class:"card"},ye={key:0,class:"table-responsive"},fe={class:"table"},he={key:1,class:"empty-state__title"},ge={class:"card"},ke={class:"grid grid--two-column"},Ae={class:"form__group"},we={class:"form__group"},Se={class:"form__group"},$e={class:"form__group"},Ce={key:0,class:"alert alert--danger"},Le={key:1,class:"alert alert--success"},Te={class:"form__actions"},Ue=["disabled"],Ne=["disabled"],Ie={class:"card"},Re={key:0,class:"table-responsive"},Ve={class:"table"},Ee=["onClick","disabled"],Be={key:1,class:"empty-state__title"},Oe={key:2,class:"alert alert--danger"},je={class:"card"},qe={class:"card__header"},xe=["disabled"],De={key:0,class:"table-responsive"},Ye={class:"table"},Fe={key:1,class:"empty-state__title"},Me={__name:"LibraryBookApp",props:{book:{type:Object,default:()=>({})},activeLoans:{type:Array,default:()=>[]},recentLoans:{type:Array,default:()=>[]},categories:{type:Array,default:()=>[]},csrfToken:{type:String,default:""}},setup($){var x,z;const v=$,l=J({...v.book,copies:((x=v.book)==null?void 0:x.copies)??[]}),T=p([...v.activeLoans]),g=p([...v.recentLoans]),f=p(!1),h=p(""),A=p(""),y=J({barcode:"",location:"",status:"AVAILABLE",acquiredAt:""}),C=p(!1),k=p(""),L=p(""),w=p(""),b=p(null),U=p(!1),d=J({id:l.id,title:l.title||"",author:l.author||"",isbn:l.isbn||"",categoryId:((z=l.category)==null?void 0:z.id)||"",publishedYear:l.publishedYear?String(l.publishedYear):"",summary:l.summary||"",isArchived:!!l.isArchived});B(()=>v.book,c=>{var e;Object.assign(l,c||{}),c!=null&&c.copies&&(l.copies=c.copies),d.id=l.id,d.title=l.title||"",d.author=l.author||"",d.isbn=l.isbn||"",d.categoryId=((e=l.category)==null?void 0:e.id)||"",d.publishedYear=l.publishedYear?String(l.publishedYear):"",d.summary=l.summary||"",d.isArchived=!!l.isArchived}),B(()=>v.activeLoans,c=>{T.value=Array.isArray(c)?[...c]:[]}),B(()=>v.recentLoans,c=>{g.value=Array.isArray(c)?[...c]:[]});const O=X(()=>v.categories??[]);function j(){var c;d.title=l.title||"",d.author=l.author||"",d.isbn=l.isbn||"",d.categoryId=((c=l.category)==null?void 0:c.id)||"",d.publishedYear=l.publishedYear?String(l.publishedYear):"",d.summary=l.summary||"",d.isArchived=!!l.isArchived,h.value="",A.value=""}function I(c){if(!c)return"—";const e=new Date(c);return Number.isNaN(e.getTime())?"—":e.toLocaleDateString()}async function q(){if(!d.title){h.value="Title is required.";return}f.value=!0,h.value="",A.value="";try{const c=await fetch(`/library/books/${l.id}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":v.csrfToken},body:JSON.stringify(d)});if(!c.ok){const e=await c.json().catch(()=>({error:""}));throw new Error(e.error||`Request failed with status ${c.status}`)}A.value="Book updated successfully.",await r()}catch(c){console.error(c),h.value=c.message||"Unable to update book."}finally{f.value=!1}}async function m(){C.value=!0,k.value="",L.value="";try{const c=await fetch(`/library/books/${l.id}/copies`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":v.csrfToken},body:JSON.stringify(y)});if(!c.ok){const e=await c.json().catch(()=>({error:""}));throw new Error(e.error||`Request failed with status ${c.status}`)}L.value="Copy added successfully.",o(),await r()}catch(c){console.error(c),k.value=c.message||"Unable to add copy."}finally{C.value=!1}}function o(){y.barcode="",y.location="",y.status="AVAILABLE",y.acquiredAt=""}async function s(c){b.value=c.id,w.value="";try{const e=await fetch(`/library/loans/${c.id}/return`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":v.csrfToken},body:JSON.stringify({returnedAt:new Date().toISOString()})});if(!e.ok){const a=await e.json().catch(()=>({error:""}));throw new Error(a.error||`Request failed with status ${e.status}`)}await r()}catch(e){console.error(e),w.value=e.message||"Unable to mark loan as returned."}finally{b.value=null}}async function r(){var c;U.value=!0,w.value="";try{const e=await fetch(`/library/books/${l.id}`,{headers:{Accept:"application/json"}});if(!e.ok)throw new Error(`Request failed with status ${e.status}`);const a=await e.json();Object.assign(l,a.book||{}),l.copies=((c=a.book)==null?void 0:c.copies)??[],T.value=Array.isArray(a.activeLoans)?a.activeLoans:[],g.value=Array.isArray(a.recentLoans)?a.recentLoans:[]}catch(e){console.error(e),w.value=e.message||"Unable to refresh book details."}finally{U.value=!1}}async function E(){await r()}return(c,e)=>(u(),i("section",Wt,[t("article",Zt,[t("header",te,[t("div",null,[t("h1",ee,n(d.title||"Untitled book"),1),e[11]||(e[11]=t("p",{class:"card__hint"},"Update book metadata to keep the catalog current.",-1))])]),t("form",{class:"form",onSubmit:M(q,["prevent"])},[t("div",se,[t("label",oe,[e[12]||(e[12]=t("span",null,"Title",-1)),_(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>d.title=a),type:"text",required:"",class:"form__control"},null,512),[[S,d.title,void 0,{trim:!0}]])]),t("label",ae,[e[13]||(e[13]=t("span",null,"Author",-1)),_(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>d.author=a),type:"text",class:"form__control"},null,512),[[S,d.author,void 0,{trim:!0}]])]),t("label",le,[e[14]||(e[14]=t("span",null,"ISBN",-1)),_(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>d.isbn=a),type:"text",class:"form__control"},null,512),[[S,d.isbn,void 0,{trim:!0}]])]),t("label",re,[e[16]||(e[16]=t("span",null,"Category",-1)),_(t("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>d.categoryId=a),class:"form__control"},[e[15]||(e[15]=t("option",{value:""},"Uncategorized",-1)),(u(!0),i(R,null,V(O.value,a=>(u(),i("option",{key:a.id,value:a.id},n(a.name),9,ne))),128))],512),[[P,d.categoryId]])]),t("label",ie,[e[17]||(e[17]=t("span",null,"Published year",-1)),_(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>d.publishedYear=a),type:"number",min:"0",class:"form__control"},null,512),[[S,d.publishedYear,void 0,{trim:!0}]])]),t("label",ue,[e[18]||(e[18]=t("span",null,"Summary",-1)),_(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=a=>d.summary=a),rows:"3",class:"form__control"},null,512),[[S,d.summary,void 0,{trim:!0}]])])]),t("label",de,[_(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>d.isArchived=a),type:"checkbox"},null,512),[[W,d.isArchived]]),e[19]||(e[19]=t("span",null,"Archive this title",-1))]),h.value?(u(),i("div",ce,n(h.value),1)):N("",!0),A.value?(u(),i("div",pe,n(A.value),1)):N("",!0),t("div",be,[t("button",{type:"submit",class:"btn btn--primary",disabled:f.value},n(f.value?"Saving…":"Save changes"),9,ve),t("button",{type:"button",class:"btn btn--ghost",onClick:j,disabled:f.value}," Reset ",8,me)])],32)]),Q(G,{copies:l.copies,"csrf-token":$.csrfToken,"book-id":l.id,onLoanIssued:E},null,8,["copies","csrf-token","book-id"]),t("article",_e,[e[21]||(e[21]=t("header",{class:"card__header"},[t("div",null,[t("h2",{class:"card__title"},"Copy inventory"),t("p",{class:"card__hint"},"Track each barcode assigned to this title.")])],-1)),l.copies.length?(u(),i("div",ye,[t("table",fe,[e[20]||(e[20]=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"Barcode"),t("th",{scope:"col"},"Location"),t("th",{scope:"col"},"Status")])],-1)),t("tbody",null,[(u(!0),i(R,null,V(l.copies,a=>(u(),i("tr",{key:a.id},[t("td",null,n(a.barcode||a.id),1),t("td",null,n(a.location||"—"),1),t("td",null,n(a.status),1)]))),128))])])])):(u(),i("p",he,"No copies recorded."))]),t("article",ge,[e[27]||(e[27]=t("header",{class:"card__header"},[t("div",null,[t("h2",{class:"card__title"},"Add a copy"),t("p",{class:"card__hint"},"Register additional barcodes for circulation.")])],-1)),t("form",{class:"form",onSubmit:M(m,["prevent"])},[t("div",ke,[t("label",Ae,[e[22]||(e[22]=t("span",null,"Barcode",-1)),_(t("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>y.barcode=a),type:"text",class:"form__control",placeholder:"Optional"},null,512),[[S,y.barcode,void 0,{trim:!0}]])]),t("label",we,[e[23]||(e[23]=t("span",null,"Location",-1)),_(t("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>y.location=a),type:"text",class:"form__control"},null,512),[[S,y.location,void 0,{trim:!0}]])]),t("label",Se,[e[25]||(e[25]=t("span",null,"Status",-1)),_(t("select",{"onUpdate:modelValue":e[9]||(e[9]=a=>y.status=a),class:"form__control"},[...e[24]||(e[24]=[t("option",{value:"AVAILABLE"},"Available",-1),t("option",{value:"LOANED"},"On loan",-1),t("option",{value:"MAINTENANCE"},"Maintenance",-1),t("option",{value:"LOST"},"Lost",-1)])],512),[[P,y.status]])]),t("label",$e,[e[26]||(e[26]=t("span",null,"Acquired date",-1)),_(t("input",{"onUpdate:modelValue":e[10]||(e[10]=a=>y.acquiredAt=a),type:"date",class:"form__control"},null,512),[[S,y.acquiredAt]])])]),k.value?(u(),i("div",Ce,n(k.value),1)):N("",!0),L.value?(u(),i("div",Le,n(L.value),1)):N("",!0),t("div",Te,[t("button",{type:"submit",class:"btn btn--primary",disabled:C.value},n(C.value?"Saving…":"Add copy"),9,Ue),t("button",{type:"button",class:"btn btn--ghost",onClick:o,disabled:C.value}," Reset ",8,Ne)])],32)]),t("article",Ie,[e[29]||(e[29]=t("header",{class:"card__header"},[t("div",null,[t("h2",{class:"card__title"},"Active loans"),t("p",{class:"card__hint"},"Close out loans when items are returned.")])],-1)),T.value.length?(u(),i("div",Re,[t("table",Ve,[e[28]||(e[28]=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"Copy"),t("th",{scope:"col"},"Borrower"),t("th",{scope:"col"},"Issued"),t("th",{scope:"col"},"Due"),t("th",{scope:"col"},"Action")])],-1)),t("tbody",null,[(u(!0),i(R,null,V(T.value,a=>{var D,Y,F;return u(),i("tr",{key:a.id},[t("td",null,n(((D=a.copy)==null?void 0:D.barcode)||((Y=a.copy)==null?void 0:Y.id)||"—"),1),t("td",null,n(((F=a.student)==null?void 0:F.name)||"—"),1),t("td",null,n(I(a.issuedAt)),1),t("td",null,n(I(a.dueAt)),1),t("td",null,[t("button",{type:"button",class:"btn btn--ghost btn--small",onClick:ze=>s(a),disabled:b.value===a.id},n(b.value===a.id?"Saving…":"Mark returned"),9,Ee)])])}),128))])])])):(u(),i("p",Be,"No active loans recorded.")),w.value?(u(),i("div",Oe,n(w.value),1)):N("",!0)]),t("article",je,[t("header",qe,[e[30]||(e[30]=t("div",null,[t("h2",{class:"card__title"},"Recent activity"),t("p",{class:"card__hint"},"Chronological list of loan events for this title.")],-1)),t("button",{type:"button",class:"btn btn--ghost btn--small",onClick:r,disabled:U.value},n(U.value?"Refreshing…":"Refresh"),9,xe)]),g.value.length?(u(),i("div",De,[t("table",Ye,[e[31]||(e[31]=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"Copy"),t("th",{scope:"col"},"Borrower"),t("th",{scope:"col"},"Issued"),t("th",{scope:"col"},"Status")])],-1)),t("tbody",null,[(u(!0),i(R,null,V(g.value,a=>{var D,Y,F;return u(),i("tr",{key:a.id},[t("td",null,n(((D=a.copy)==null?void 0:D.barcode)||((Y=a.copy)==null?void 0:Y.id)||"—"),1),t("td",null,n(((F=a.student)==null?void 0:F.name)||"—"),1),t("td",null,n(I(a.issuedAt)),1),t("td",null,[t("span",{class:K(["badge",a.returnedAt?"badge--success":"badge--info"])},n(a.returnedAt?`Returned ${I(a.returnedAt)}`:a.dueAt?`Due ${I(a.dueAt)}`:"On loan"),3)])])}),128))])])])):(u(),i("p",Fe,"No historical activity yet."))])]))}},Pe={LibraryDashboardApp:Ot,LibraryBookApp:Me,LibraryLoanApp:G};function Je($){if(!$)return{};const v=document.getElementById($);if(!v)return{};try{return JSON.parse(v.textContent||"{}")}catch(l){return console.warn(`Unable to parse state for ${$}`,l),{}}}function Xe($){const v=$.dataset.vueApp,l=Pe[v];if(!l)return;const T=Je($.dataset.stateId);Z(l,T).mount($)}Array.from(document.querySelectorAll('[data-vue-app^="Library"]')).forEach($=>Xe($));
//# sourceMappingURL=library.js.map
