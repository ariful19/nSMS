import{r as S,c as V,a,o,b as e,h as U,i as q,w as A,v as I,t as n,F as g,f as N,n as E,j as Y,d as B,e as x,q as se,p as ne}from"./chunks/sq-avatar-badge-iwxELXVT.js";import{_ as ae}from"./chunks/_plugin-vue_export-helper-DlAUqK2U.js";const oe={class:"card card--interactive"},le={class:"grid grid--two-column"},re={class:"card"},ie={class:"form__group"},ce={class:"form__actions"},de=["disabled"],ue=["disabled"],pe={key:0,class:"alert alert--danger"},_e={key:1,class:"list list--compact"},me={class:"list__heading"},fe={class:"badge badge--info"},he=["href"],be={key:2,class:"empty-state__title"},ve={class:"card"},ye={key:0,class:"table-responsive"},ge={class:"table"},Se={class:"table__cell--numeric"},ke={key:1,class:"empty-state__title"},De={class:"card"},$e={key:0,class:"table-responsive"},Ne={class:"table"},we={class:"table__cell--numeric"},Ae={key:1,class:"empty-state__title"},Ce={__name:"FeeDashboardApp",props:{categories:{type:Array,default:()=>[]},recentEntries:{type:Array,default:()=>[]}},setup(p){const _=p,u=S(""),b=S(!1),c=S(!1),d=S([]),m=S(""),k=V(()=>_.recentEntries??[]),y=V(()=>_.categories??[]);function f($){return Number.parseFloat($??0).toLocaleString(void 0,{style:"currency",currency:"USD"})}function D($){const r=new Date($);return Number.isNaN(r.getTime())?"—":r.toLocaleDateString()}async function C(){if(!u.value){d.value=[],c.value=!0;return}b.value=!0,m.value="";try{const $=new URLSearchParams({term:u.value}),r=await fetch(`/fees/api/students?${$.toString()}`);if(!r.ok)throw new Error(`Request failed with status ${r.status}`);const i=await r.json();d.value=Array.isArray(i.results)?i.results:[]}catch($){console.error($),m.value="Unable to complete search. Please try again."}finally{b.value=!1,c.value=!0}}function M(){u.value="",d.value=[],c.value=!1,m.value=""}return($,r)=>(o(),a("section",oe,[r[7]||(r[7]=e("header",{class:"card__header"},[e("div",null,[e("h1",{class:"card__title"},"Fees workspace"),e("p",{class:"card__subtitle"}," Manage fee categories, review activity, and locate student ledgers. ")])],-1)),e("div",le,[e("article",re,[r[2]||(r[2]=e("header",{class:"card__header"},[e("div",null,[e("h2",{class:"card__title"},"Student search"),e("p",{class:"card__hint"},"Search by name or student number.")])],-1)),e("form",{class:"form",onSubmit:q(C,["prevent"])},[e("label",ie,[r[1]||(r[1]=e("span",null,"Student",-1)),A(e("input",{"onUpdate:modelValue":r[0]||(r[0]=i=>u.value=i),type:"search",name:"term",class:"form__control",placeholder:"Start typing to search"},null,512),[[I,u.value,void 0,{trim:!0}]])]),e("div",ce,[e("button",{type:"submit",class:"btn btn--primary",disabled:b.value},n(b.value?"Searching…":"Search"),9,de),e("button",{type:"button",class:"btn btn--ghost",onClick:M,disabled:b.value}," Clear ",8,ue)])],32),m.value?(o(),a("div",pe,n(m.value),1)):U("",!0),d.value.length?(o(),a("ul",_e,[(o(!0),a(g,null,N(d.value,i=>(o(),a("li",{key:i.id,class:"list__option"},[e("div",null,[e("div",me,[e("strong",null,n(i.label),1),e("span",fe,n(i.studentNumber||"No number"),1)])]),e("a",{href:`/fees/ledger/${i.id}`,class:"btn btn--ghost btn--small"},"Open ledger",8,he)]))),128))])):c.value&&!b.value?(o(),a("p",be," No students found. Try another search term. ")):U("",!0)]),e("article",ve,[r[4]||(r[4]=e("header",{class:"card__header"},[e("div",null,[e("h2",{class:"card__title"},"Recent ledger activity"),e("p",{class:"card__hint"},"Latest 10 entries across all students.")])],-1)),k.value.length?(o(),a("div",ye,[e("table",ge,[r[3]||(r[3]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"Date"),e("th",{scope:"col"},"Student"),e("th",{scope:"col"},"Type"),e("th",{scope:"col"},"Description"),e("th",{scope:"col",class:"table__cell--numeric"},"Amount")])],-1)),e("tbody",null,[(o(!0),a(g,null,N(k.value,i=>{var T;return o(),a("tr",{key:i.id},[e("td",null,n(D(i.entryDate)),1),e("td",null,n(((T=i.student)==null?void 0:T.name)??"—"),1),e("td",null,n(i.entryType),1),e("td",null,n(i.description||"—"),1),e("td",Se,n(f(i.amount)),1)])}),128))])])])):(o(),a("p",ke,"No ledger entries recorded yet."))])]),e("article",De,[r[6]||(r[6]=e("header",{class:"card__header"},[e("div",null,[e("h2",{class:"card__title"},"Fee categories"),e("p",{class:"card__hint"},"Active and archived billing categories.")])],-1)),y.value.length?(o(),a("div",$e,[e("table",Ne,[r[5]||(r[5]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"Name"),e("th",{scope:"col"},"Code"),e("th",{scope:"col",class:"table__cell--numeric"},"Default amount"),e("th",{scope:"col"},"Status")])],-1)),e("tbody",null,[(o(!0),a(g,null,N(y.value,i=>(o(),a("tr",{key:i.id},[e("td",null,n(i.name),1),e("td",null,n(i.code||"—"),1),e("td",we,n(i.defaultAmount?f(i.defaultAmount):"—"),1),e("td",null,[e("span",{class:E(["badge",i.isActive?"badge--success":"badge--neutral"])},n(i.isActive?"Active":"Archived"),3)])]))),128))])])])):(o(),a("p",Ae,"No categories configured."))])]))}},Te={class:"stack"},Ie={class:"card card--interactive"},Ue={class:"card__header"},je={class:"card__title"},Le={class:"card__subtitle"},Fe={class:"grid grid--three-column"},Oe={class:"summary"},Re={class:"summary"},Ve={class:"summary"},Ee={class:"summary summary--balance"},Me={class:"form__row"},Pe={class:"form__group"},Be={class:"form__group"},xe={class:"form__group"},qe=["value"],Je={class:"form__actions"},ze=["disabled"],He=["disabled"],Ke={class:"card"},Xe={class:"transaction-tabs"},Ye=["onClick"],Ge={class:"transaction-items"},Qe={class:"form__row"},We={class:"form__group"},Ze=["onUpdate:modelValue"],et=["value"],tt={class:"form__group"},st=["onUpdate:modelValue","min"],nt={class:"form__group"},at=["onUpdate:modelValue"],ot={class:"form__group"},lt=["onUpdate:modelValue"],rt={class:"transaction-item__actions"},it=["onClick"],ct={key:0,class:"form__group"},dt={class:"form__actions"},ut=["disabled"],pt=["disabled"],_t={key:0,class:"alerts"},mt=["href"],ft={class:"card"},ht={key:0,class:"table-responsive"},bt={class:"table"},vt={class:"table__cell--numeric"},yt={class:"table__cell--numeric"},gt=["href"],St={key:1},kt={key:1,class:"empty-state__title"},Dt={__name:"FeeLedgerApp",props:{ledger:{type:Object,default:()=>({entries:[],totals:{},student:null})},categories:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})},endpoints:{type:Object,default:()=>({})},csrfToken:{type:String,default:""}},setup(p){var H,K,X;const _=p,u=Y(JSON.parse(JSON.stringify(_.ledger??{}))),b=V(()=>_.categories??[]),c=Y({startDate:((H=_.filters)==null?void 0:H.startDate)||"",endDate:((K=_.filters)==null?void 0:K.endDate)||"",categoryId:((X=_.filters)==null?void 0:X.categoryId)||""}),d=S("charge"),m=S([T()]),k=S(""),y=S([]),f=S(!1),D=S(!1),C=[{id:"charge",label:"Charge"},{id:"payment",label:"Payment"},{id:"adjustment",label:"Adjustment"}],M=V(()=>{var t;const l=(t=u.student)==null?void 0:t.person;return l?`${l.firstName??""} ${l.lastName??""}`.trim():"Student ledger"}),$=V(()=>f.value?"Saving…":d.value==="payment"?"Record payment":d.value==="adjustment"?"Record adjustment":"Record charge");function r(l){return Number.parseFloat(l??0).toLocaleString(void 0,{style:"currency",currency:"USD"})}function i(l){const t=new Date(l);return Number.isNaN(t.getTime())?"—":t.toLocaleDateString()}function T(){return{categoryId:"",amount:"",entryDate:new Date().toISOString().slice(0,10),description:""}}function G(){m.value.push(T())}function Q(l){m.value.length!==1&&m.value.splice(l,1)}function P(){m.value=[T()],k.value=""}function W(){c.startDate="",c.endDate="",c.categoryId="",z()}function Z(l){d.value=l,P()}function j(l,t,w={}){y.value.unshift({type:l,message:t,...w}),y.value.length>5&&y.value.pop()}async function J(){D.value=!0;try{const l=new URLSearchParams;c.startDate&&l.set("startDate",c.startDate),c.endDate&&l.set("endDate",c.endDate),c.categoryId&&l.set("categoryId",c.categoryId);const t=await fetch(`${window.location.pathname}?${l.toString()}`,{headers:{Accept:"application/json"}});if(!t.ok)throw new Error("Unable to refresh ledger");const w=await t.json();Object.assign(u,w.ledger??{})}catch(l){console.error(l),j("danger","Failed to refresh ledger. Please reload the page.")}finally{D.value=!1}}function z(){J()}function ee(){return m.value.filter(l=>l.amount).map(l=>({categoryId:l.categoryId||null,amount:l.amount,entryDate:l.entryDate,description:l.description}))}async function te(){var F,O,R;const l=ee();if(!l.length){j("warning","Add at least one line with an amount before submitting.");return}const w={charge:(F=_.endpoints)==null?void 0:F.createCharge,payment:(O=_.endpoints)==null?void 0:O.createPayment,adjustment:(R=_.endpoints)==null?void 0:R.createAdjustment}[d.value];if(!w){j("danger","Missing endpoint configuration.");return}const L={lineItems:l};d.value==="payment"&&(L.paymentMethod=k.value||void 0),f.value=!0;try{const s=await fetch(w,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":_.csrfToken},body:JSON.stringify(L)}),h=await s.json();if(!s.ok)throw new Error((h==null?void 0:h.error)||"Unable to record transaction");j("success",h.message||"Transaction recorded.",{receiptNumber:h.receiptNumber}),P(),await J()}catch(s){console.error(s),j("danger",s.message||"Unable to record transaction.")}finally{f.value=!1}}return(l,t)=>{var w,L,F,O,R;return o(),a("section",Te,[e("article",Ie,[e("header",Ue,[e("div",null,[e("h1",je,n(M.value),1),e("p",Le,[t[4]||(t[4]=B(" Student number: ",-1)),e("strong",null,n(((w=u.student)==null?void 0:w.studentNumber)||"—"),1)])]),t[5]||(t[5]=e("div",{class:"card__actions"},[e("a",{class:"btn btn--ghost",href:"/fees"},"Back to fees")],-1))]),e("div",Fe,[e("div",Oe,[t[6]||(t[6]=e("h3",null,"Charges",-1)),e("p",null,n(r(((L=u.totals)==null?void 0:L.charges)||0)),1)]),e("div",Re,[t[7]||(t[7]=e("h3",null,"Payments",-1)),e("p",null,n(r(((F=u.totals)==null?void 0:F.payments)||0)),1)]),e("div",Ve,[t[8]||(t[8]=e("h3",null,"Adjustments",-1)),e("p",null,n(r(((O=u.totals)==null?void 0:O.adjustments)||0)),1)])]),e("div",Ee,[t[9]||(t[9]=e("h3",null,"Balance",-1)),e("p",null,n(r(u.balance||0)),1)]),e("form",{class:"form filters",onSubmit:q(z,["prevent"])},[e("div",Me,[e("label",Pe,[t[10]||(t[10]=e("span",null,"Start date",-1)),A(e("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=s=>c.startDate=s),class:"form__control"},null,512),[[I,c.startDate]])]),e("label",Be,[t[11]||(t[11]=e("span",null,"End date",-1)),A(e("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=s=>c.endDate=s),class:"form__control"},null,512),[[I,c.endDate]])]),e("label",xe,[t[13]||(t[13]=e("span",null,"Category",-1)),A(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>c.categoryId=s),class:"form__control"},[t[12]||(t[12]=e("option",{value:""},"All categories",-1)),(o(!0),a(g,null,N(b.value,s=>(o(),a("option",{key:s.id,value:String(s.id)},n(s.name),9,qe))),128))],512),[[x,c.categoryId]])])]),e("div",Je,[e("button",{type:"submit",class:"btn btn--primary",disabled:D.value},n(D.value?"Updating…":"Apply filters"),9,ze),e("button",{type:"button",class:"btn btn--ghost",onClick:W,disabled:D.value}," Reset ",8,He)])],32)]),e("article",Ke,[t[22]||(t[22]=e("header",{class:"card__header"},[e("div",null,[e("h2",{class:"card__title"},"Record transaction"),e("p",{class:"card__hint"},"Capture new charges, payments, or adjustments.")])],-1)),e("div",Xe,[(o(),a(g,null,N(C,s=>e("button",{key:s.id,type:"button",class:E(["transaction-tabs__tab",{"transaction-tabs__tab--active":d.value===s.id}]),onClick:h=>Z(s.id)},n(s.label),11,Ye)),64))]),e("form",{class:"form",onSubmit:q(te,["prevent"])},[e("div",Ge,[(o(!0),a(g,null,N(m.value,(s,h)=>(o(),a("div",{key:h,class:"transaction-item"},[e("div",Qe,[e("label",We,[t[15]||(t[15]=e("span",null,"Category",-1)),A(e("select",{"onUpdate:modelValue":v=>s.categoryId=v,class:"form__control"},[t[14]||(t[14]=e("option",{value:""},"Uncategorized",-1)),(o(!0),a(g,null,N(b.value,v=>(o(),a("option",{key:v.id,value:String(v.id)},n(v.name),9,et))),128))],8,Ze),[[x,s.categoryId]])]),e("label",tt,[t[16]||(t[16]=e("span",null,"Amount",-1)),A(e("input",{"onUpdate:modelValue":v=>s.amount=v,type:"number",step:"0.01",min:d.value==="adjustment"?null:0,class:"form__control",required:""},null,8,st),[[I,s.amount]])]),e("label",nt,[t[17]||(t[17]=e("span",null,"Date",-1)),A(e("input",{"onUpdate:modelValue":v=>s.entryDate=v,type:"date",class:"form__control",required:""},null,8,at),[[I,s.entryDate]])])]),e("label",ot,[t[18]||(t[18]=e("span",null,"Description",-1)),A(e("input",{"onUpdate:modelValue":v=>s.description=v,type:"text",class:"form__control",placeholder:"Optional"},null,8,lt),[[I,s.description]])]),e("div",rt,[m.value.length>1?(o(),a("button",{key:0,type:"button",class:"btn btn--link",onClick:v=>Q(h)}," Remove ",8,it)):U("",!0)])]))),128))]),e("div",{class:"form__actions"},[e("button",{type:"button",class:"btn btn--ghost",onClick:G}," Add another line ")]),d.value==="payment"?(o(),a("label",ct,[t[20]||(t[20]=e("span",null,"Payment method",-1)),A(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>k.value=s),class:"form__control"},[...t[19]||(t[19]=[se('<option value="" data-v-c4f9cdd0>Select method</option><option value="CASH" data-v-c4f9cdd0>Cash</option><option value="CHECK" data-v-c4f9cdd0>Check</option><option value="TRANSFER" data-v-c4f9cdd0>Bank transfer</option><option value="MOBILE" data-v-c4f9cdd0>Mobile payment</option><option value="OTHER" data-v-c4f9cdd0>Other</option>',6)])],512),[[x,k.value]])])):U("",!0),e("div",dt,[e("button",{type:"submit",class:"btn btn--primary",disabled:f.value},n($.value),9,ut),e("button",{type:"button",class:"btn btn--ghost",onClick:P,disabled:f.value}," Clear form ",8,pt)])],32),y.value.length?(o(),a("div",_t,[(o(!0),a(g,null,N(y.value,(s,h)=>(o(),a("div",{key:h,class:E(["alert",`alert--${s.type}`])},[B(n(s.message)+" ",1),s.receiptNumber?(o(),a(g,{key:0},[t[21]||(t[21]=B(" – ",-1)),e("a",{href:`/fees/receipt/${s.receiptNumber}`,class:"alert__link"},"View receipt",8,mt)],64)):U("",!0)],2))),128))])):U("",!0)]),e("article",ft,[t[24]||(t[24]=e("header",{class:"card__header"},[e("div",null,[e("h2",{class:"card__title"},"Ledger entries"),e("p",{class:"card__hint"},"Ordered chronologically with running balance.")])],-1)),(R=u.entries)!=null&&R.length?(o(),a("div",ht,[e("table",bt,[t[23]||(t[23]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"Date"),e("th",{scope:"col"},"Type"),e("th",{scope:"col"},"Category"),e("th",{scope:"col"},"Description"),e("th",{scope:"col",class:"table__cell--numeric"},"Amount"),e("th",{scope:"col",class:"table__cell--numeric"},"Balance"),e("th",{scope:"col"},"Receipt")])],-1)),e("tbody",null,[(o(!0),a(g,null,N(u.entries,s=>{var h;return o(),a("tr",{key:s.id},[e("td",null,n(i(s.entryDate)),1),e("td",null,n(s.entryType),1),e("td",null,n(((h=s.category)==null?void 0:h.name)??"—"),1),e("td",null,n(s.description||"—"),1),e("td",vt,[e("span",{class:E(s.entryType==="PAYMENT"?"text--success":"")},n(r(s.amount)),3)]),e("td",yt,n(r(s.runningBalance)),1),e("td",null,[s.receiptNumber?(o(),a("a",{key:0,href:`/fees/receipt/${s.receiptNumber}`,class:"btn btn--link"},n(s.receiptNumber),9,gt)):(o(),a("span",St,"—"))])])}),128))])])])):(o(),a("p",kt,"No ledger entries for the selected filters."))])])}}},$t=ae(Dt,[["__scopeId","data-v-c4f9cdd0"]]),Nt={class:"card card--interactive"},wt={class:"card__header"},At={class:"card__title"},Ct={class:"card__hint"},Tt={key:0,class:"table-responsive"},It={class:"table"},Ut={class:"table__cell--numeric"},jt={class:"table__cell--numeric"},Lt={key:1,class:"empty-state__title"},Ft={__name:"FeeReceiptApp",props:{receipt:{type:Object,default:()=>({lineItems:[]})}},setup(p){function _(c){return Number.parseFloat(c??0).toLocaleString(void 0,{style:"currency",currency:"USD"})}function u(c){const d=new Date(c);return Number.isNaN(d.getTime())?"—":d.toLocaleDateString()}function b(){window.print()}return(c,d)=>{var m,k,y;return o(),a("section",Nt,[e("header",wt,[e("div",null,[e("h1",At,"Receipt "+n(p.receipt.receiptNumber),1),e("p",Ct,n(((m=p.receipt.student)==null?void 0:m.name)??"")+" • "+n(((k=p.receipt.student)==null?void 0:k.studentNumber)??"—"),1)]),e("div",{class:"card__actions"},[e("button",{type:"button",class:"btn btn--ghost",onClick:b},"Print"),d[0]||(d[0]=e("a",{class:"btn",href:"/fees"},"Back to fees",-1))])]),(y=p.receipt.lineItems)!=null&&y.length?(o(),a("div",Tt,[e("table",It,[d[2]||(d[2]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"Line"),e("th",{scope:"col"},"Description"),e("th",{scope:"col"},"Category"),e("th",{scope:"col"},"Method"),e("th",{scope:"col"},"Date"),e("th",{scope:"col",class:"table__cell--numeric"},"Amount")])],-1)),e("tbody",null,[(o(!0),a(g,null,N(p.receipt.lineItems,(f,D)=>{var C;return o(),a("tr",{key:f.id??D},[e("td",null,n(D+1),1),e("td",null,n(f.description||"—"),1),e("td",null,n(((C=f.category)==null?void 0:C.name)??"—"),1),e("td",null,n(f.paymentMethod||"—"),1),e("td",null,n(u(f.entryDate)),1),e("td",Ut,n(_(f.amount)),1)])}),128))]),e("tfoot",null,[e("tr",null,[d[1]||(d[1]=e("th",{scope:"row",colspan:"5",class:"table__cell--numeric"},"Total",-1)),e("td",jt,n(_(p.receipt.total)),1)])])])])):(o(),a("p",Lt,"No line items available for this receipt."))])}}},Ot={FeeDashboardApp:Ce,FeeLedgerApp:$t,FeeReceiptApp:Ft};function Rt(p){if(!p)return{};const _=document.getElementById(p);if(!_)return{};try{return JSON.parse(_.textContent||"{}")}catch(u){return console.warn(`Unable to parse state for ${p}`,u),{}}}function Vt(p){const _=p.dataset.vueApp,u=Ot[_];if(!u)return;const b=Rt(p.dataset.stateId);ne(u,b).mount(p)}Array.from(document.querySelectorAll('[data-vue-app^="Fee"]')).forEach(p=>Vt(p));
//# sourceMappingURL=fees.js.map
