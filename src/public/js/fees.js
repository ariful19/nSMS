import{_ as q,c as o,o as l,a as e,f as F,j as x,w as C,v as L,t as r,F as v,r as k,n as R,g as h,h as A,b as V,d as P,q as ae,i as B,p as re}from"./chunks/sq-avatar-badge-CzDjdsqk.js";const oe={__name:"FeeDashboardApp",props:{categories:{type:Array,default:()=>[]},recentEntries:{type:Array,default:()=>[]}},setup(_,{expose:t}){t();const c=_,n=h(""),S=h(!1),u=h(!1),a=h([]),d=h(""),f=A(()=>c.recentEntries??[]),m=A(()=>c.categories??[]);function b(D){return Number.parseFloat(D??0).toLocaleString(void 0,{style:"currency",currency:"USD"})}function s(D){const N=new Date(D);return Number.isNaN(N.getTime())?"—":N.toLocaleDateString()}async function y(){if(!n.value){a.value=[],u.value=!0;return}S.value=!0,d.value="";try{const D=new URLSearchParams({term:n.value}),N=await fetch(`/fees/api/students?${D.toString()}`);if(!N.ok)throw new Error(`Request failed with status ${N.status}`);const w=await N.json();a.value=Array.isArray(w.results)?w.results:[]}catch(D){console.error(D),d.value="Unable to complete search. Please try again."}finally{S.value=!1,u.value=!0}}function p(){n.value="",a.value=[],u.value=!1,d.value=""}const O={props:c,searchTerm:n,isSearching:S,hasSearched:u,searchResults:a,searchError:d,recentEntries:f,categories:m,formatCurrency:b,formatDate:s,runSearch:y,resetSearch:p,computed:A,ref:h};return Object.defineProperty(O,"__isScriptSetup",{enumerable:!1,value:!0}),O}},le={class:"card card--interactive"},ie={class:"grid grid--two-column"},ce={class:"card"},de={class:"form__group"},ue={class:"form__actions"},_e=["disabled"],me=["disabled"],pe={key:0,class:"alert alert--danger"},fe={key:1,class:"list list--compact"},he={class:"list__heading"},be={class:"badge badge--info"},ye=["href"],ge={key:2,class:"empty-state__title"},ve={class:"card"},Se={key:0,class:"table-responsive"},ke={class:"table"},De={class:"table__cell--numeric"},Ne={key:1,class:"empty-state__title"},Ce={class:"card"},we={key:0,class:"table-responsive"},Ae={class:"table"},Te={class:"table__cell--numeric"},Ie={key:1,class:"empty-state__title"};function Le(_,t,c,n,S,u){return l(),o("section",le,[t[7]||(t[7]=e("header",{class:"card__header"},[e("div",null,[e("h1",{class:"card__title"},"Fees workspace"),e("p",{class:"card__subtitle"}," Manage fee categories, review activity, and locate student ledgers. ")])],-1)),e("div",ie,[e("article",ce,[t[2]||(t[2]=e("header",{class:"card__header"},[e("div",null,[e("h2",{class:"card__title"},"Student search"),e("p",{class:"card__hint"},"Search by name or student number.")])],-1)),e("form",{class:"form",onSubmit:x(n.runSearch,["prevent"])},[e("label",de,[t[1]||(t[1]=e("span",null,"Student",-1)),C(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>n.searchTerm=a),type:"search",name:"term",class:"form__control",placeholder:"Start typing to search"},null,512),[[L,n.searchTerm,void 0,{trim:!0}]])]),e("div",ue,[e("button",{type:"submit",class:"btn btn--primary",disabled:n.isSearching},r(n.isSearching?"Searching…":"Search"),9,_e),e("button",{type:"button",class:"btn btn--ghost",onClick:n.resetSearch,disabled:n.isSearching}," Clear ",8,me)])],32),n.searchError?(l(),o("div",pe,r(n.searchError),1)):F("",!0),n.searchResults.length?(l(),o("ul",fe,[(l(!0),o(v,null,k(n.searchResults,a=>(l(),o("li",{key:a.id,class:"list__option"},[e("div",null,[e("div",he,[e("strong",null,r(a.label),1),e("span",be,r(a.studentNumber||"No number"),1)])]),e("a",{href:`/fees/ledger/${a.id}`,class:"btn btn--ghost btn--small"},"Open ledger",8,ye)]))),128))])):n.hasSearched&&!n.isSearching?(l(),o("p",ge," No students found. Try another search term. ")):F("",!0)]),e("article",ve,[t[4]||(t[4]=e("header",{class:"card__header"},[e("div",null,[e("h2",{class:"card__title"},"Recent ledger activity"),e("p",{class:"card__hint"},"Latest 10 entries across all students.")])],-1)),n.recentEntries.length?(l(),o("div",Se,[e("table",ke,[t[3]||(t[3]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"Date"),e("th",{scope:"col"},"Student"),e("th",{scope:"col"},"Type"),e("th",{scope:"col"},"Description"),e("th",{scope:"col",class:"table__cell--numeric"},"Amount")])],-1)),e("tbody",null,[(l(!0),o(v,null,k(n.recentEntries,a=>{var d;return l(),o("tr",{key:a.id},[e("td",null,r(n.formatDate(a.entryDate)),1),e("td",null,r(((d=a.student)==null?void 0:d.name)??"—"),1),e("td",null,r(a.entryType),1),e("td",null,r(a.description||"—"),1),e("td",De,r(n.formatCurrency(a.amount)),1)])}),128))])])])):(l(),o("p",Ne,"No ledger entries recorded yet."))])]),e("article",Ce,[t[6]||(t[6]=e("header",{class:"card__header"},[e("div",null,[e("h2",{class:"card__title"},"Fee categories"),e("p",{class:"card__hint"},"Active and archived billing categories.")])],-1)),n.categories.length?(l(),o("div",we,[e("table",Ae,[t[5]||(t[5]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"Name"),e("th",{scope:"col"},"Code"),e("th",{scope:"col",class:"table__cell--numeric"},"Default amount"),e("th",{scope:"col"},"Status")])],-1)),e("tbody",null,[(l(!0),o(v,null,k(n.categories,a=>(l(),o("tr",{key:a.id},[e("td",null,r(a.name),1),e("td",null,r(a.code||"—"),1),e("td",Te,r(a.defaultAmount?n.formatCurrency(a.defaultAmount):"—"),1),e("td",null,[e("span",{class:R(["badge",a.isActive?"badge--success":"badge--neutral"])},r(a.isActive?"Active":"Archived"),3)])]))),128))])])])):(l(),o("p",Ie,"No categories configured."))])])}const Fe=q(oe,[["render",Le],["__file","/workspace/nSMS/src/client/fees/components/FeeDashboardApp.vue"]]),je={__name:"FeeLedgerApp",props:{ledger:{type:Object,default:()=>({entries:[],totals:{},student:null})},categories:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})},endpoints:{type:Object,default:()=>({})},csrfToken:{type:String,default:""}},setup(_,{expose:t}){var K,X,Y;t();const c=_,n=B(JSON.parse(JSON.stringify(c.ledger??{}))),S=A(()=>c.categories??[]),u=B({startDate:((K=c.filters)==null?void 0:K.startDate)||"",endDate:((X=c.filters)==null?void 0:X.endDate)||"",categoryId:((Y=c.filters)==null?void 0:Y.categoryId)||""}),a=h("charge"),d=h([w()]),f=h(""),m=h([]),b=h(!1),s=h(!1),y=[{id:"charge",label:"Charge"},{id:"payment",label:"Payment"},{id:"adjustment",label:"Adjustment"}],p=A(()=>{var g;const i=(g=n.student)==null?void 0:g.person;return i?`${i.firstName??""} ${i.lastName??""}`.trim():"Student ledger"}),O=A(()=>b.value?"Saving…":a.value==="payment"?"Record payment":a.value==="adjustment"?"Record adjustment":"Record charge");function D(i){return Number.parseFloat(i??0).toLocaleString(void 0,{style:"currency",currency:"USD"})}function N(i){const g=new Date(i);return Number.isNaN(g.getTime())?"—":g.toLocaleDateString()}function w(){return{categoryId:"",amount:"",entryDate:new Date().toISOString().slice(0,10),description:""}}function $(){d.value.push(w())}function ee(i){d.value.length!==1&&d.value.splice(i,1)}function E(){d.value=[w()],f.value=""}function te(){u.startDate="",u.endDate="",u.categoryId="",J()}function ne(i){a.value=i,E()}function T(i,g,I={}){m.value.unshift({type:i,message:g,...I}),m.value.length>5&&m.value.pop()}async function M(){s.value=!0;try{const i=new URLSearchParams;u.startDate&&i.set("startDate",u.startDate),u.endDate&&i.set("endDate",u.endDate),u.categoryId&&i.set("categoryId",u.categoryId);const g=await fetch(`${window.location.pathname}?${i.toString()}`,{headers:{Accept:"application/json"}});if(!g.ok)throw new Error("Unable to refresh ledger");const I=await g.json();Object.assign(n,I.ledger??{})}catch(i){console.error(i),T("danger","Failed to refresh ledger. Please reload the page.")}finally{s.value=!1}}function J(){M()}function z(){return d.value.filter(i=>i.amount).map(i=>({categoryId:i.categoryId||null,amount:i.amount,entryDate:i.entryDate,description:i.description}))}async function se(){var Q,W,Z;const i=z();if(!i.length){T("warning","Add at least one line with an amount before submitting.");return}const I={charge:(Q=c.endpoints)==null?void 0:Q.createCharge,payment:(W=c.endpoints)==null?void 0:W.createPayment,adjustment:(Z=c.endpoints)==null?void 0:Z.createAdjustment}[a.value];if(!I){T("danger","Missing endpoint configuration.");return}const G={lineItems:i};a.value==="payment"&&(G.paymentMethod=f.value||void 0),b.value=!0;try{const j=await fetch(I,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":c.csrfToken},body:JSON.stringify(G)}),U=await j.json();if(!j.ok)throw new Error((U==null?void 0:U.error)||"Unable to record transaction");T("success",U.message||"Transaction recorded.",{receiptNumber:U.receiptNumber}),E(),await M()}catch(j){console.error(j),T("danger",j.message||"Unable to record transaction.")}finally{b.value=!1}}const H={props:c,ledgerState:n,categories:S,filterState:u,activeTab:a,lineItems:d,paymentMethod:f,alerts:m,isSubmitting:b,isLoading:s,tabs:y,studentName:p,submitLabel:O,formatCurrency:D,formatDate:N,createLineItem:w,addLineItem:$,removeLineItem:ee,resetForm:E,resetFilters:te,switchTab:ne,addAlert:T,refreshLedger:M,applyFilters:J,serializeLineItems:z,submitTransaction:se,computed:A,reactive:B,ref:h};return Object.defineProperty(H,"__isScriptSetup",{enumerable:!1,value:!0}),H}},Ue={class:"stack"},Oe={class:"card card--interactive"},Re={class:"card__header"},Ee={class:"card__title"},Me={class:"card__subtitle"},Ve={class:"grid grid--three-column"},Pe={class:"summary"},Be={class:"summary"},xe={class:"summary"},qe={class:"summary summary--balance"},Je={class:"form__row"},ze={class:"form__group"},He={class:"form__group"},Ke={class:"form__group"},Xe=["value"],Ye={class:"form__actions"},Ge=["disabled"],Qe=["disabled"],We={class:"card"},Ze={class:"transaction-tabs"},$e=["onClick"],et={class:"transaction-items"},tt={class:"form__row"},nt={class:"form__group"},st=["onUpdate:modelValue"],at=["value"],rt={class:"form__group"},ot=["onUpdate:modelValue","min"],lt={class:"form__group"},it=["onUpdate:modelValue"],ct={class:"form__group"},dt=["onUpdate:modelValue"],ut={class:"transaction-item__actions"},_t=["onClick"],mt={key:0,class:"form__group"},pt={class:"form__actions"},ft=["disabled"],ht=["disabled"],bt={key:0,class:"alerts"},yt=["href"],gt={class:"card"},vt={key:0,class:"table-responsive"},St={class:"table"},kt={class:"table__cell--numeric"},Dt={class:"table__cell--numeric"},Nt=["href"],Ct={key:1},wt={key:1,class:"empty-state__title"};function At(_,t,c,n,S,u){var a,d,f,m,b;return l(),o("section",Ue,[e("article",Oe,[e("header",Re,[e("div",null,[e("h1",Ee,r(n.studentName),1),e("p",Me,[t[4]||(t[4]=V(" Student number: ",-1)),e("strong",null,r(((a=n.ledgerState.student)==null?void 0:a.studentNumber)||"—"),1)])]),t[5]||(t[5]=e("div",{class:"card__actions"},[e("a",{class:"btn btn--ghost",href:"/fees"},"Back to fees")],-1))]),e("div",Ve,[e("div",Pe,[t[6]||(t[6]=e("h3",null,"Charges",-1)),e("p",null,r(n.formatCurrency(((d=n.ledgerState.totals)==null?void 0:d.charges)||0)),1)]),e("div",Be,[t[7]||(t[7]=e("h3",null,"Payments",-1)),e("p",null,r(n.formatCurrency(((f=n.ledgerState.totals)==null?void 0:f.payments)||0)),1)]),e("div",xe,[t[8]||(t[8]=e("h3",null,"Adjustments",-1)),e("p",null,r(n.formatCurrency(((m=n.ledgerState.totals)==null?void 0:m.adjustments)||0)),1)])]),e("div",qe,[t[9]||(t[9]=e("h3",null,"Balance",-1)),e("p",null,r(n.formatCurrency(n.ledgerState.balance||0)),1)]),e("form",{class:"form filters",onSubmit:x(n.applyFilters,["prevent"])},[e("div",Je,[e("label",ze,[t[10]||(t[10]=e("span",null,"Start date",-1)),C(e("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=s=>n.filterState.startDate=s),class:"form__control"},null,512),[[L,n.filterState.startDate]])]),e("label",He,[t[11]||(t[11]=e("span",null,"End date",-1)),C(e("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=s=>n.filterState.endDate=s),class:"form__control"},null,512),[[L,n.filterState.endDate]])]),e("label",Ke,[t[13]||(t[13]=e("span",null,"Category",-1)),C(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>n.filterState.categoryId=s),class:"form__control"},[t[12]||(t[12]=e("option",{value:""},"All categories",-1)),(l(!0),o(v,null,k(n.categories,s=>(l(),o("option",{key:s.id,value:String(s.id)},r(s.name),9,Xe))),128))],512),[[P,n.filterState.categoryId]])])]),e("div",Ye,[e("button",{type:"submit",class:"btn btn--primary",disabled:n.isLoading},r(n.isLoading?"Updating…":"Apply filters"),9,Ge),e("button",{type:"button",class:"btn btn--ghost",onClick:n.resetFilters,disabled:n.isLoading}," Reset ",8,Qe)])],32)]),e("article",We,[t[22]||(t[22]=e("header",{class:"card__header"},[e("div",null,[e("h2",{class:"card__title"},"Record transaction"),e("p",{class:"card__hint"},"Capture new charges, payments, or adjustments.")])],-1)),e("div",Ze,[(l(),o(v,null,k(n.tabs,s=>e("button",{key:s.id,type:"button",class:R(["transaction-tabs__tab",{"transaction-tabs__tab--active":n.activeTab===s.id}]),onClick:y=>n.switchTab(s.id)},r(s.label),11,$e)),64))]),e("form",{class:"form",onSubmit:x(n.submitTransaction,["prevent"])},[e("div",et,[(l(!0),o(v,null,k(n.lineItems,(s,y)=>(l(),o("div",{key:y,class:"transaction-item"},[e("div",tt,[e("label",nt,[t[15]||(t[15]=e("span",null,"Category",-1)),C(e("select",{"onUpdate:modelValue":p=>s.categoryId=p,class:"form__control"},[t[14]||(t[14]=e("option",{value:""},"Uncategorized",-1)),(l(!0),o(v,null,k(n.categories,p=>(l(),o("option",{key:p.id,value:String(p.id)},r(p.name),9,at))),128))],8,st),[[P,s.categoryId]])]),e("label",rt,[t[16]||(t[16]=e("span",null,"Amount",-1)),C(e("input",{"onUpdate:modelValue":p=>s.amount=p,type:"number",step:"0.01",min:n.activeTab==="adjustment"?null:0,class:"form__control",required:""},null,8,ot),[[L,s.amount]])]),e("label",lt,[t[17]||(t[17]=e("span",null,"Date",-1)),C(e("input",{"onUpdate:modelValue":p=>s.entryDate=p,type:"date",class:"form__control",required:""},null,8,it),[[L,s.entryDate]])])]),e("label",ct,[t[18]||(t[18]=e("span",null,"Description",-1)),C(e("input",{"onUpdate:modelValue":p=>s.description=p,type:"text",class:"form__control",placeholder:"Optional"},null,8,dt),[[L,s.description]])]),e("div",ut,[n.lineItems.length>1?(l(),o("button",{key:0,type:"button",class:"btn btn--link",onClick:p=>n.removeLineItem(y)}," Remove ",8,_t)):F("",!0)])]))),128))]),e("div",{class:"form__actions"},[e("button",{type:"button",class:"btn btn--ghost",onClick:n.addLineItem}," Add another line ")]),n.activeTab==="payment"?(l(),o("label",mt,[t[20]||(t[20]=e("span",null,"Payment method",-1)),C(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>n.paymentMethod=s),class:"form__control"},[...t[19]||(t[19]=[ae('<option value="" data-v-a567eabf>Select method</option><option value="CASH" data-v-a567eabf>Cash</option><option value="CHECK" data-v-a567eabf>Check</option><option value="TRANSFER" data-v-a567eabf>Bank transfer</option><option value="MOBILE" data-v-a567eabf>Mobile payment</option><option value="OTHER" data-v-a567eabf>Other</option>',6)])],512),[[P,n.paymentMethod]])])):F("",!0),e("div",pt,[e("button",{type:"submit",class:"btn btn--primary",disabled:n.isSubmitting},r(n.submitLabel),9,ft),e("button",{type:"button",class:"btn btn--ghost",onClick:n.resetForm,disabled:n.isSubmitting}," Clear form ",8,ht)])],32),n.alerts.length?(l(),o("div",bt,[(l(!0),o(v,null,k(n.alerts,(s,y)=>(l(),o("div",{key:y,class:R(["alert",`alert--${s.type}`])},[V(r(s.message)+" ",1),s.receiptNumber?(l(),o(v,{key:0},[t[21]||(t[21]=V(" – ",-1)),e("a",{href:`/fees/receipt/${s.receiptNumber}`,class:"alert__link"},"View receipt",8,yt)],64)):F("",!0)],2))),128))])):F("",!0)]),e("article",gt,[t[24]||(t[24]=e("header",{class:"card__header"},[e("div",null,[e("h2",{class:"card__title"},"Ledger entries"),e("p",{class:"card__hint"},"Ordered chronologically with running balance.")])],-1)),(b=n.ledgerState.entries)!=null&&b.length?(l(),o("div",vt,[e("table",St,[t[23]||(t[23]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"Date"),e("th",{scope:"col"},"Type"),e("th",{scope:"col"},"Category"),e("th",{scope:"col"},"Description"),e("th",{scope:"col",class:"table__cell--numeric"},"Amount"),e("th",{scope:"col",class:"table__cell--numeric"},"Balance"),e("th",{scope:"col"},"Receipt")])],-1)),e("tbody",null,[(l(!0),o(v,null,k(n.ledgerState.entries,s=>{var y;return l(),o("tr",{key:s.id},[e("td",null,r(n.formatDate(s.entryDate)),1),e("td",null,r(s.entryType),1),e("td",null,r(((y=s.category)==null?void 0:y.name)??"—"),1),e("td",null,r(s.description||"—"),1),e("td",kt,[e("span",{class:R(s.entryType==="PAYMENT"?"text--success":"")},r(n.formatCurrency(s.amount)),3)]),e("td",Dt,r(n.formatCurrency(s.runningBalance)),1),e("td",null,[s.receiptNumber?(l(),o("a",{key:0,href:`/fees/receipt/${s.receiptNumber}`,class:"btn btn--link"},r(s.receiptNumber),9,Nt)):(l(),o("span",Ct,"—"))])])}),128))])])])):(l(),o("p",wt,"No ledger entries for the selected filters."))])])}const Tt=q(je,[["render",At],["__scopeId","data-v-a567eabf"],["__file","/workspace/nSMS/src/client/fees/components/FeeLedgerApp.vue"]]),It={__name:"FeeReceiptApp",props:{receipt:{type:Object,default:()=>({lineItems:[]})}},setup(_,{expose:t}){t();const c=_;function n(d){return Number.parseFloat(d??0).toLocaleString(void 0,{style:"currency",currency:"USD"})}function S(d){const f=new Date(d);return Number.isNaN(f.getTime())?"—":f.toLocaleDateString()}function u(){window.print()}const a={props:c,formatCurrency:n,formatDate:S,print:u};return Object.defineProperty(a,"__isScriptSetup",{enumerable:!1,value:!0}),a}},Lt={class:"card card--interactive"},Ft={class:"card__header"},jt={class:"card__title"},Ut={class:"card__hint"},Ot={key:0,class:"table-responsive"},Rt={class:"table"},Et={class:"table__cell--numeric"},Mt={class:"table__cell--numeric"},Vt={key:1,class:"empty-state__title"};function Pt(_,t,c,n,S,u){var a,d,f;return l(),o("section",Lt,[e("header",Ft,[e("div",null,[e("h1",jt,"Receipt "+r(c.receipt.receiptNumber),1),e("p",Ut,r(((a=c.receipt.student)==null?void 0:a.name)??"")+" • "+r(((d=c.receipt.student)==null?void 0:d.studentNumber)??"—"),1)]),e("div",{class:"card__actions"},[e("button",{type:"button",class:"btn btn--ghost",onClick:n.print},"Print"),t[0]||(t[0]=e("a",{class:"btn",href:"/fees"},"Back to fees",-1))])]),(f=c.receipt.lineItems)!=null&&f.length?(l(),o("div",Ot,[e("table",Rt,[t[2]||(t[2]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"Line"),e("th",{scope:"col"},"Description"),e("th",{scope:"col"},"Category"),e("th",{scope:"col"},"Method"),e("th",{scope:"col"},"Date"),e("th",{scope:"col",class:"table__cell--numeric"},"Amount")])],-1)),e("tbody",null,[(l(!0),o(v,null,k(c.receipt.lineItems,(m,b)=>{var s;return l(),o("tr",{key:m.id??b},[e("td",null,r(b+1),1),e("td",null,r(m.description||"—"),1),e("td",null,r(((s=m.category)==null?void 0:s.name)??"—"),1),e("td",null,r(m.paymentMethod||"—"),1),e("td",null,r(n.formatDate(m.entryDate)),1),e("td",Et,r(n.formatCurrency(m.amount)),1)])}),128))]),e("tfoot",null,[e("tr",null,[t[1]||(t[1]=e("th",{scope:"row",colspan:"5",class:"table__cell--numeric"},"Total",-1)),e("td",Mt,r(n.formatCurrency(c.receipt.total)),1)])])])])):(l(),o("p",Vt,"No line items available for this receipt."))])}const Bt=q(It,[["render",Pt],["__file","/workspace/nSMS/src/client/fees/components/FeeReceiptApp.vue"]]),xt={FeeDashboardApp:Fe,FeeLedgerApp:Tt,FeeReceiptApp:Bt};function qt(_){if(!_)return{};const t=document.getElementById(_);if(!t)return{};try{return JSON.parse(t.textContent||"{}")}catch(c){return console.warn(`Unable to parse state for ${_}`,c),{}}}function Jt(_){const t=_.dataset.vueApp,c=xt[t];if(!c)return;const n=qt(_.dataset.stateId);re(c,n).mount(_)}Array.from(document.querySelectorAll('[data-vue-app^="Fee"]')).forEach(_=>Jt(_));
//# sourceMappingURL=fees.js.map
